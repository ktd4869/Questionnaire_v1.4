<p id=p0><span class='token pointer' id='tok-63-0'>In</span><span class='token pointer' id='tok-63-1'>this</span><span class='token pointer' id='tok-63-2'>article,</span><span class='token pointer' id='tok-63-3'>we</span><span class='token pointer' id='tok-63-4'>will</span><span class='token pointer' id='tok-63-5'>be</span><span class='token pointer' id='tok-63-6'>solving</span><span class='token pointer' id='tok-63-7'>all</span><span class='token pointer' id='tok-63-8'>networking</span><span class='token pointer' id='tok-63-9'>challenges</span><span class='token pointer' id='tok-63-10'>and</span><span class='token pointer' id='tok-63-11'>one</span><span class='token pointer' id='tok-63-12'>remote</span><span class='token pointer' id='tok-63-13'>buffer</span><span class='token pointer' id='tok-63-14'>overflow</span><span class='token pointer' id='tok-63-15'>challenge</span><span class='token pointer' id='tok-63-16'>of</span><span class='token pointer' id='tok-63-17'>Protostar.</span></p>
<p id=p18><span class='token pointer' id='tok-63-18'>IntroductionThese</span><span class='token pointer' id='tok-63-19'>levels</span><span class='token pointer' id='tok-63-20'>introduce</span><span class='token pointer' id='tok-63-21'>us</span><span class='token pointer' id='tok-63-22'>to</span><span class='token pointer' id='tok-63-23'>the</span><span class='token pointer' id='tok-63-24'>fundamental</span><span class='token pointer' id='tok-63-25'>concept</span><span class='token pointer' id='tok-63-26'>of</span><span class='token pointer' id='tok-63-27'>sending</span><span class='token pointer' id='tok-63-28'>and</span><span class='token pointer' id='tok-63-29'>receiving</span><span class='token pointer' id='tok-63-30'>data</span><span class='token pointer' id='tok-63-31'>over</span><span class='token pointer' id='tok-63-32'>a</span><span class='token pointer' id='tok-63-33'>network</span><span class='token pointer' id='tok-63-34'>in</span><span class='token pointer' id='tok-63-35'>a</span><span class='token pointer' id='tok-63-36'>different</span><span class='token pointer' id='tok-63-37'>format,</span><span class='token pointer' id='tok-63-38'>and</span><span class='token pointer' id='tok-63-39'>the</span><span class='token pointer' id='tok-63-40'>hurdles</span><span class='token pointer' id='tok-63-41'>of</span><span class='token pointer' id='tok-63-42'>debugging</span><span class='token pointer' id='tok-63-43'>and</span><span class='token pointer' id='tok-63-44'>developing</span><span class='token pointer' id='tok-63-45'>an</span><span class='token pointer' id='tok-63-46'>exploit</span><span class='token pointer' id='tok-63-47'>for</span><span class='token pointer' id='tok-63-48'>remote</span><span class='token pointer' id='tok-63-49'>stack</span><span class='token pointer' id='tok-63-50'>overflows.</span><span class='token pointer' id='tok-63-51'>We</span><span class='token pointer' id='tok-63-52'>will</span><span class='token pointer' id='tok-63-53'>have</span><span class='token pointer' id='tok-63-54'>a</span><span class='token pointer' id='tok-63-55'>look</span><span class='token pointer' id='tok-63-56'>at</span><span class='token pointer' id='tok-63-57'>how</span><span class='token pointer' id='tok-63-58'>we</span><span class='token pointer' id='tok-63-59'>can</span><span class='token pointer' id='tok-63-60'>debug</span><span class='token pointer' id='tok-63-61'>and</span><span class='token pointer' id='tok-63-62'>understand</span><span class='token pointer' id='tok-63-63'>what</span><span class='token pointer' id='tok-63-64'>inputs</span><span class='token pointer' id='tok-63-65'>the</span><span class='token pointer' id='tok-63-66'>program</span><span class='token pointer' id='tok-63-67'>expects</span><span class='token pointer' id='tok-63-68'>from</span><span class='token pointer' id='tok-63-69'>us.</span></p>
<p id=p70><span class='token pointer' id='tok-63-70'>The</span><span class='token pointer' id='tok-63-71'>following</span><span class='token pointer' id='tok-63-72'>assembly</span><span class='token pointer' id='tok-63-73'>code</span><span class='token pointer' id='tok-63-74'>is</span><span class='token pointer' id='tok-63-75'>obtained</span><span class='token pointer' id='tok-63-76'>after</span><span class='token pointer' id='tok-63-77'>disassembling</span><span class='token pointer' id='tok-63-78'>the</span><span class='token pointer' id='tok-63-79'>Net0</span><span class='token pointer' id='tok-63-80'>binary.</span><span class='token pointer' id='tok-63-81'>As</span><span class='token pointer' id='tok-63-82'>we</span><span class='token pointer' id='tok-63-83'>can</span><span class='token pointer' id='tok-63-84'>see,</span><span class='token pointer' id='tok-63-85'>the</span><span class='token pointer' id='tok-63-86'>application</span><span class='token pointer' id='tok-63-87'>executes</span><span class='token pointer' id='tok-63-88'>run</span><span class='token pointer' id='tok-63-89'>function</span><span class='token pointer' id='tok-63-90'>from</span><span class='token pointer' id='tok-63-91'>the</span><span class='token pointer' id='tok-63-92'>main</span><span class='token pointer' id='tok-63-93'>function.</span><span class='token pointer' id='tok-63-94'>The</span><span class='token pointer' id='tok-63-95'>run</span><span class='token pointer' id='tok-63-96'>function</span><span class='token pointer' id='tok-63-97'>generates</span><span class='token pointer' id='tok-63-98'>a</span><span class='token pointer' id='tok-63-99'>random</span><span class='token pointer' id='tok-63-100'>number</span><span class='token pointer' id='tok-63-101'>and</span><span class='token pointer' id='tok-63-102'>uses</span><span class='token pointer' id='tok-63-103'>printf</span><span class='token pointer' id='tok-63-104'>function</span><span class='token pointer' id='tok-63-105'>call</span><span class='token pointer' id='tok-63-106'>to</span><span class='token pointer' id='tok-63-107'>print</span><span class='token pointer' id='tok-63-108'>it</span><span class='token pointer' id='tok-63-109'>on</span><span class='token pointer' id='tok-63-110'>the</span><span class='token pointer' id='tok-63-111'>screen.</span><span class='token pointer' id='tok-63-112'>It</span><span class='token pointer' id='tok-63-113'>further</span><span class='token pointer' id='tok-63-114'>checks</span><span class='token pointer' id='tok-63-115'>whether</span><span class='token pointer' id='tok-63-116'>our</span><span class='token pointer' id='tok-63-117'>input</span><span class='token pointer' id='tok-63-118'>matches</span><span class='token pointer' id='tok-63-119'>to</span><span class='token pointer' id='tok-63-120'>the</span><span class='token pointer' id='tok-63-121'>random()</span><span class='token pointer' id='tok-63-122'>number</span><span class='token pointer' id='tok-63-123'>generated</span><span class='token pointer' id='tok-63-124'>by</span><span class='token pointer' id='tok-63-125'>comparing</span><span class='token pointer' id='tok-63-126'>our</span><span class='token pointer' id='tok-63-127'>raw</span><span class='token pointer' id='tok-63-128'>input</span><span class='token pointer' id='tok-63-129'>and</span><span class='token pointer' id='tok-63-130'>random</span><span class='token pointer' id='tok-63-131'>number</span><span class='token pointer' id='tok-63-132'>generated</span><span class='token pointer' id='tok-63-133'>previously.</span></p>
<p id=p134><span class='token pointer' id='tok-63-134'>Our</span><span class='token pointer' id='tok-63-135'>logic</span><span class='token pointer' id='tok-63-136'>for</span><span class='token pointer' id='tok-63-137'>solving</span><span class='token pointer' id='tok-63-138'>this</span><span class='token pointer' id='tok-63-139'>challenge</span><span class='token pointer' id='tok-63-140'>will</span><span class='token pointer' id='tok-63-141'>be</span><span class='token pointer' id='tok-63-142'>composed</span><span class='token pointer' id='tok-63-143'>of</span><span class='token pointer' id='tok-63-144'>following</span><span class='token pointer' id='tok-63-145'>steps:</span></p>
<p id=p146><span class='token pointer' id='tok-63-146'>Connect</span><span class='token pointer' id='tok-63-147'>to</span><span class='token pointer' id='tok-63-148'>serverRecv()</span><span class='token pointer' id='tok-63-149'>some</span><span class='token pointer' id='tok-63-150'>dataParse</span><span class='token pointer' id='tok-63-151'>the</span><span class='token pointer' id='tok-63-152'>data</span><span class='token pointer' id='tok-63-153'>and</span><span class='token pointer' id='tok-63-154'>take</span><span class='token pointer' id='tok-63-155'>out</span><span class='token pointer' id='tok-63-156'>the</span><span class='token pointer' id='tok-63-157'>random</span><span class='token pointer' id='tok-63-158'>number</span><span class='token pointer' id='tok-63-159'>ask</span><span class='token pointer' id='tok-63-160'>by</span><span class='token pointer' id='tok-63-161'>the</span><span class='token pointer' id='tok-63-162'>applicationPack</span><span class='token pointer' id='tok-63-163'>the</span><span class='token pointer' id='tok-63-164'>random</span><span class='token pointer' id='tok-63-165'>number</span><span class='token pointer' id='tok-63-166'>in</span><span class='token pointer' id='tok-63-167'>little-endian</span><span class='token pointer' id='tok-63-168'>format</span><span class='token pointer' id='tok-63-169'>and</span><span class='token pointer' id='tok-63-170'>send</span><span class='token pointer' id='tok-63-171'>it</span><span class='token pointer' id='tok-63-172'>back.Using</span><span class='token pointer' id='tok-63-173'>the</span><span class='token pointer' id='tok-63-174'>logic</span><span class='token pointer' id='tok-63-175'>listed</span><span class='token pointer' id='tok-63-176'>above,</span><span class='token pointer' id='tok-63-177'>we</span><span class='token pointer' id='tok-63-178'>came</span><span class='token pointer' id='tok-63-179'>up</span><span class='token pointer' id='tok-63-180'>with</span><span class='token pointer' id='tok-63-181'>the</span><span class='token pointer' id='tok-63-182'>following</span><span class='token pointer' id='tok-63-183'>piece</span><span class='token pointer' id='tok-63-184'>of</span><span class='token pointer' id='tok-63-185'>code</span><span class='token pointer' id='tok-63-186'>and</span><span class='token pointer' id='tok-63-187'>successfully</span><span class='token pointer' id='tok-63-188'>passed</span><span class='token pointer' id='tok-63-189'>this</span><span class='token pointer' id='tok-63-190'>challenge.</span></p>
<p id=p191><span class='token pointer' id='tok-63-191'>Net</span><span class='token pointer' id='tok-63-192'>1By</span><span class='token pointer' id='tok-63-193'>looking</span><span class='token pointer' id='tok-63-194'>at</span><span class='token pointer' id='tok-63-195'>the</span><span class='token pointer' id='tok-63-196'>disassembled</span><span class='token pointer' id='tok-63-197'>code</span><span class='token pointer' id='tok-63-198'>of</span><span class='token pointer' id='tok-63-199'>binary</span><span class='token pointer' id='tok-63-200'>Net1,</span><span class='token pointer' id='tok-63-201'>we</span><span class='token pointer' id='tok-63-202'>can</span><span class='token pointer' id='tok-63-203'>understand</span><span class='token pointer' id='tok-63-204'>following</span><span class='token pointer' id='tok-63-205'>things:</span></p>
<p id=p206><span class='token pointer' id='tok-63-206'>The</span><span class='token pointer' id='tok-63-207'>program</span><span class='token pointer' id='tok-63-208'>generates</span><span class='token pointer' id='tok-63-209'>a</span><span class='token pointer' id='tok-63-210'>random</span><span class='token pointer' id='tok-63-211'>number</span><span class='token pointer' id='tok-63-212'>and</span><span class='token pointer' id='tok-63-213'>stores</span><span class='token pointer' id='tok-63-214'>the</span><span class='token pointer' id='tok-63-215'>integer</span><span class='token pointer' id='tok-63-216'>as</span><span class='token pointer' id='tok-63-217'>a</span><span class='token pointer' id='tok-63-218'>string</span><span class='token pointer' id='tok-63-219'>at</span><span class='token pointer' id='tok-63-220'>ebp-0x24.It</span><span class='token pointer' id='tok-63-221'>then</span><span class='token pointer' id='tok-63-222'>writes</span><span class='token pointer' id='tok-63-223'>the</span><span class='token pointer' id='tok-63-224'>content</span><span class='token pointer' id='tok-63-225'>of</span><span class='token pointer' id='tok-63-226'>number</span><span class='token pointer' id='tok-63-227'>generated</span><span class='token pointer' id='tok-63-228'>to</span><span class='token pointer' id='tok-63-229'>stdout.It</span><span class='token pointer' id='tok-63-230'>then</span><span class='token pointer' id='tok-63-231'>takes</span><span class='token pointer' id='tok-63-232'>input</span><span class='token pointer' id='tok-63-233'>from</span><span class='token pointer' id='tok-63-234'>user</span><span class='token pointer' id='tok-63-235'>removes</span><span class='token pointer' id='tok-63-236'>CRLF</span><span class='token pointer' id='tok-63-237'>characters</span><span class='token pointer' id='tok-63-238'>and</span><span class='token pointer' id='tok-63-239'>compare</span><span class='token pointer' id='tok-63-240'>the</span><span class='token pointer' id='tok-63-241'>input</span><span class='token pointer' id='tok-63-242'>with</span><span class='token pointer' id='tok-63-243'>the</span><span class='token pointer' id='tok-63-244'>contents</span><span class='token pointer' id='tok-63-245'>of</span><span class='token pointer' id='tok-63-246'>ebp-0x24</span><span class='token pointer' id='tok-63-247'>variable</span><span class='token pointer' id='tok-63-248'>saved</span><span class='token pointer' id='tok-63-249'>earlier.As</span><span class='token pointer' id='tok-63-250'>in</span><span class='token pointer' id='tok-63-251'>this</span><span class='token pointer' id='tok-63-252'>case,</span><span class='token pointer' id='tok-63-253'>the</span><span class='token pointer' id='tok-63-254'>data</span><span class='token pointer' id='tok-63-255'>is</span><span class='token pointer' id='tok-63-256'>already</span><span class='token pointer' id='tok-63-257'>packed</span><span class='token pointer' id='tok-63-258'>in</span><span class='token pointer' id='tok-63-259'>32-bit</span><span class='token pointer' id='tok-63-260'>integers.</span><span class='token pointer' id='tok-63-261'>We</span><span class='token pointer' id='tok-63-262'>will</span><span class='token pointer' id='tok-63-263'>be</span><span class='token pointer' id='tok-63-264'>using</span><span class='token pointer' id='tok-63-265'>similar</span><span class='token pointer' id='tok-63-266'>logic</span><span class='token pointer' id='tok-63-267'>from</span><span class='token pointer' id='tok-63-268'>the</span><span class='token pointer' id='tok-63-269'>NET0</span><span class='token pointer' id='tok-63-270'>level</span><span class='token pointer' id='tok-63-271'>and</span><span class='token pointer' id='tok-63-272'>after</span><span class='token pointer' id='tok-63-273'>receiving</span><span class='token pointer' id='tok-63-274'>the</span><span class='token pointer' id='tok-63-275'>data</span><span class='token pointer' id='tok-63-276'>we</span><span class='token pointer' id='tok-63-277'>will</span><span class='token pointer' id='tok-63-278'>be</span><span class='token pointer' id='tok-63-279'>unpacking</span><span class='token pointer' id='tok-63-280'>it</span><span class='token pointer' id='tok-63-281'>to</span><span class='token pointer' id='tok-63-282'>32-bit</span><span class='token pointer' id='tok-63-283'>integer</span><span class='token pointer' id='tok-63-284'>and</span><span class='token pointer' id='tok-63-285'>send</span><span class='token pointer' id='tok-63-286'>the</span><span class='token pointer' id='tok-63-287'>unpacked</span><span class='token pointer' id='tok-63-288'>value</span><span class='token pointer' id='tok-63-289'>back</span><span class='token pointer' id='tok-63-290'>as</span><span class='token pointer' id='tok-63-291'>it</span><span class='token pointer' id='tok-63-292'>is.</span></p>
<p id=p293><span class='token pointer' id='tok-63-293'>Finally,</span><span class='token pointer' id='tok-63-294'>we</span><span class='token pointer' id='tok-63-295'>came</span><span class='token pointer' id='tok-63-296'>up</span><span class='token pointer' id='tok-63-297'>with</span><span class='token pointer' id='tok-63-298'>following</span><span class='token pointer' id='tok-63-299'>piece</span><span class='token pointer' id='tok-63-300'>of</span><span class='token pointer' id='tok-63-301'>code</span><span class='token pointer' id='tok-63-302'>that</span><span class='token pointer' id='tok-63-303'>will</span><span class='token pointer' id='tok-63-304'>solve</span><span class='token pointer' id='tok-63-305'>this</span><span class='token pointer' id='tok-63-306'>challenge.</span></p>
<p id=p307><span class='token pointer' id='tok-63-307'>Net</span><span class='token pointer' id='tok-63-308'>2By</span><span class='token pointer' id='tok-63-309'>looking</span><span class='token pointer' id='tok-63-310'>at</span><span class='token pointer' id='tok-63-311'>the</span><span class='token pointer' id='tok-63-312'>disassembled</span><span class='token pointer' id='tok-63-313'>code</span><span class='token pointer' id='tok-63-314'>of</span><span class='token pointer' id='tok-63-315'>binary</span><span class='token pointer' id='tok-63-316'>Net2,</span><span class='token pointer' id='tok-63-317'>we</span><span class='token pointer' id='tok-63-318'>can</span><span class='token pointer' id='tok-63-319'>understand</span><span class='token pointer' id='tok-63-320'>following</span><span class='token pointer' id='tok-63-321'>things:</span></p>
<p id=p322><span class='token pointer' id='tok-63-322'>The</span><span class='token pointer' id='tok-63-323'>application</span><span class='token pointer' id='tok-63-324'>generates</span><span class='token pointer' id='tok-63-325'>four</span><span class='token pointer' id='tok-63-326'>random</span><span class='token pointer' id='tok-63-327'>numbers</span><span class='token pointer' id='tok-63-328'>and</span><span class='token pointer' id='tok-63-329'>sends</span><span class='token pointer' id='tok-63-330'>in</span><span class='token pointer' id='tok-63-331'>four</span><span class='token pointer' id='tok-63-332'>iterations</span><span class='token pointer' id='tok-63-333'>using</span><span class='token pointer' id='tok-63-334'>write</span><span class='token pointer' id='tok-63-335'>().</span><span class='token pointer' id='tok-63-336'>It</span><span class='token pointer' id='tok-63-337'>also</span><span class='token pointer' id='tok-63-338'>keeps</span><span class='token pointer' id='tok-63-339'>on</span><span class='token pointer' id='tok-63-340'>adding</span><span class='token pointer' id='tok-63-341'>them</span><span class='token pointer' id='tok-63-342'>and</span><span class='token pointer' id='tok-63-343'>stores</span><span class='token pointer' id='tok-63-344'>the</span><span class='token pointer' id='tok-63-345'>overall</span><span class='token pointer' id='tok-63-346'>result</span><span class='token pointer' id='tok-63-347'>at</span><span class='token pointer' id='tok-63-348'>ebp-0xc.</span><span class='token pointer' id='tok-63-349'>As</span><span class='token pointer' id='tok-63-350'>a</span><span class='token pointer' id='tok-63-351'>result</span><span class='token pointer' id='tok-63-352'>might</span><span class='token pointer' id='tok-63-353'>overflow</span><span class='token pointer' id='tok-63-354'>its</span><span class='token pointer' id='tok-63-355'>limit,</span><span class='token pointer' id='tok-63-356'>it</span><span class='token pointer' id='tok-63-357'>will</span><span class='token pointer' id='tok-63-358'>wrap,</span><span class='token pointer' id='tok-63-359'>so</span><span class='token pointer' id='tok-63-360'>we</span><span class='token pointer' id='tok-63-361'>need</span><span class='token pointer' id='tok-63-362'>to</span><span class='token pointer' id='tok-63-363'>take</span><span class='token pointer' id='tok-63-364'>care</span><span class='token pointer' id='tok-63-365'>of</span><span class='token pointer' id='tok-63-366'>that</span><span class='token pointer' id='tok-63-367'>in</span><span class='token pointer' id='tok-63-368'>our</span><span class='token pointer' id='tok-63-369'>code</span><span class='token pointer' id='tok-63-370'>too.</span><span class='token pointer' id='tok-63-371'>Finally,</span><span class='token pointer' id='tok-63-372'>it</span><span class='token pointer' id='tok-63-373'>checks</span><span class='token pointer' id='tok-63-374'>the</span><span class='token pointer' id='tok-63-375'>input</span><span class='token pointer' id='tok-63-376'>provided</span><span class='token pointer' id='tok-63-377'>by</span><span class='token pointer' id='tok-63-378'>the</span><span class='token pointer' id='tok-63-379'>user</span><span class='token pointer' id='tok-63-380'>matches</span><span class='token pointer' id='tok-63-381'>the</span><span class='token pointer' id='tok-63-382'>added</span><span class='token pointer' id='tok-63-383'>numbers,</span><span class='token pointer' id='tok-63-384'>so</span><span class='token pointer' id='tok-63-385'>we</span><span class='token pointer' id='tok-63-386'>need</span><span class='token pointer' id='tok-63-387'>to</span><span class='token pointer' id='tok-63-388'>pack</span><span class='token pointer' id='tok-63-389'>our</span><span class='token pointer' id='tok-63-390'>input</span><span class='token pointer' id='tok-63-391'>to</span><span class='token pointer' id='tok-63-392'>an</span><span class='token pointer' id='tok-63-393'>unsigned</span><span class='token pointer' id='tok-63-394'>int</span><span class='token pointer' id='tok-63-395'>to</span><span class='token pointer' id='tok-63-396'>take</span><span class='token pointer' id='tok-63-397'>care</span><span class='token pointer' id='tok-63-398'>of</span><span class='token pointer' id='tok-63-399'>that.</span></p>
<p id=p400><span class='token pointer' id='tok-63-400'>We</span><span class='token pointer' id='tok-63-401'>came</span><span class='token pointer' id='tok-63-402'>up</span><span class='token pointer' id='tok-63-403'>with</span><span class='token pointer' id='tok-63-404'>the</span><span class='token pointer' id='tok-63-405'>following</span><span class='token pointer' id='tok-63-406'>piece</span><span class='token pointer' id='tok-63-407'>of</span><span class='token pointer' id='tok-63-408'>code</span><span class='token pointer' id='tok-63-409'>to</span><span class='token pointer' id='tok-63-410'>solve</span><span class='token pointer' id='tok-63-411'>this</span><span class='token pointer' id='tok-63-412'>challenge</span><span class='token pointer' id='tok-63-413'>using</span><span class='token pointer' id='tok-63-414'>the</span><span class='token pointer' id='tok-63-415'>following</span><span class='token pointer' id='tok-63-416'>algorithm:</span></p>
<p id=p417><span class='token pointer' id='tok-63-417'>Connect</span><span class='token pointer' id='tok-63-418'>to</span><span class='token pointer' id='tok-63-419'>the</span><span class='token pointer' id='tok-63-420'>server.recv</span><span class='token pointer' id='tok-63-421'>()</span><span class='token pointer' id='tok-63-422'>four</span><span class='token pointer' id='tok-63-423'>bytes</span><span class='token pointer' id='tok-63-424'>of</span><span class='token pointer' id='tok-63-425'>data</span><span class='token pointer' id='tok-63-426'>from</span><span class='token pointer' id='tok-63-427'>the</span><span class='token pointer' id='tok-63-428'>server</span><span class='token pointer' id='tok-63-429'>iteratively</span><span class='token pointer' id='tok-63-430'>four</span><span class='token pointer' id='tok-63-431'>times</span><span class='token pointer' id='tok-63-432'>and</span><span class='token pointer' id='tok-63-433'>add</span><span class='token pointer' id='tok-63-434'>them.DO</span><span class='token pointer' id='tok-63-435'>an</span><span class='token pointer' id='tok-63-436'>AND</span><span class='token pointer' id='tok-63-437'>operation</span><span class='token pointer' id='tok-63-438'>with</span><span class='token pointer' id='tok-63-439'>the</span><span class='token pointer' id='tok-63-440'>final</span><span class='token pointer' id='tok-63-441'>sum,</span><span class='token pointer' id='tok-63-442'>so</span><span class='token pointer' id='tok-63-443'>the</span><span class='token pointer' id='tok-63-444'>result</span><span class='token pointer' id='tok-63-445'>stays</span><span class='token pointer' id='tok-63-446'>in</span><span class='token pointer' id='tok-63-447'>32</span><span class='token pointer' id='tok-63-448'>unsigned</span><span class='token pointer' id='tok-63-449'>int's</span><span class='token pointer' id='tok-63-450'>range.Pack</span><span class='token pointer' id='tok-63-451'>the</span><span class='token pointer' id='tok-63-452'>result</span><span class='token pointer' id='tok-63-453'>and</span><span class='token pointer' id='tok-63-454'>send</span><span class='token pointer' id='tok-63-455'>it</span><span class='token pointer' id='tok-63-456'>back</span><span class='token pointer' id='tok-63-457'>to</span><span class='token pointer' id='tok-63-458'>the</span><span class='token pointer' id='tok-63-459'>server.</span></p>
<p id=p460><span class='token pointer' id='tok-63-460'>This</span><span class='token pointer' id='tok-63-461'>level</span><span class='token pointer' id='tok-63-462'>takes</span><span class='token pointer' id='tok-63-463'>us</span><span class='token pointer' id='tok-63-464'>back</span><span class='token pointer' id='tok-63-465'>to</span><span class='token pointer' id='tok-63-466'>simple</span><span class='token pointer' id='tok-63-467'>stack</span><span class='token pointer' id='tok-63-468'>based</span><span class='token pointer' id='tok-63-469'>buffer</span><span class='token pointer' id='tok-63-470'>overflows</span><span class='token pointer' id='tok-63-471'>with</span><span class='token pointer' id='tok-63-472'>little</span><span class='token pointer' id='tok-63-473'>restrictions</span><span class='token pointer' id='tok-63-474'>added</span><span class='token pointer' id='tok-63-475'>here</span><span class='token pointer' id='tok-63-476'>and</span><span class='token pointer' id='tok-63-477'>there.</span><span class='token pointer' id='tok-63-478'>Let's</span><span class='token pointer' id='tok-63-479'>have</span><span class='token pointer' id='tok-63-480'>a</span><span class='token pointer' id='tok-63-481'>look</span><span class='token pointer' id='tok-63-482'>at</span><span class='token pointer' id='tok-63-483'>the</span><span class='token pointer' id='tok-63-484'>disassembled</span><span class='token pointer' id='tok-63-485'>code</span><span class='token pointer' id='tok-63-486'>for</span><span class='token pointer' id='tok-63-487'>this</span><span class='token pointer' id='tok-63-488'>level.</span><span class='token pointer' id='tok-63-489'>By</span><span class='token pointer' id='tok-63-490'>looking</span><span class='token pointer' id='tok-63-491'>at</span><span class='token pointer' id='tok-63-492'>the</span><span class='token pointer' id='tok-63-493'>code</span><span class='token pointer' id='tok-63-494'>we</span><span class='token pointer' id='tok-63-495'>can</span><span class='token pointer' id='tok-63-496'>quickly</span><span class='token pointer' id='tok-63-497'>figure</span><span class='token pointer' id='tok-63-498'>out</span><span class='token pointer' id='tok-63-499'>the</span><span class='token pointer' id='tok-63-500'>vulnerable</span><span class='token pointer' id='tok-63-501'>function</span><span class='token pointer' id='tok-63-502'>gets()</span><span class='token pointer' id='tok-63-503'>is</span><span class='token pointer' id='tok-63-504'>used</span><span class='token pointer' id='tok-63-505'>but</span><span class='token pointer' id='tok-63-506'>the</span><span class='token pointer' id='tok-63-507'>problem</span><span class='token pointer' id='tok-63-508'>is</span><span class='token pointer' id='tok-63-509'>our</span><span class='token pointer' id='tok-63-510'>input</span><span class='token pointer' id='tok-63-511'>gets</span><span class='token pointer' id='tok-63-512'>passed</span><span class='token pointer' id='tok-63-513'>through</span><span class='token pointer' id='tok-63-514'>the</span><span class='token pointer' id='tok-63-515'>for</span><span class='token pointer' id='tok-63-516'>loop</span><span class='token pointer' id='tok-63-517'>which</span><span class='token pointer' id='tok-63-518'>iterates</span><span class='token pointer' id='tok-63-519'>each</span><span class='token pointer' id='tok-63-520'>of</span><span class='token pointer' id='tok-63-521'>our</span><span class='token pointer' id='tok-63-522'>provided</span><span class='token pointer' id='tok-63-523'>bytes</span><span class='token pointer' id='tok-63-524'>thus</span><span class='token pointer' id='tok-63-525'>it</span><span class='token pointer' id='tok-63-526'>will</span><span class='token pointer' id='tok-63-527'>corrupt</span><span class='token pointer' id='tok-63-528'>any</span><span class='token pointer' id='tok-63-529'>non-alpha</span><span class='token pointer' id='tok-63-530'>uppercase</span><span class='token pointer' id='tok-63-531'>shellcode.</span></p>
<p id=p532><span class='token pointer' id='tok-63-532'>So,</span><span class='token pointer' id='tok-63-533'>let's</span><span class='token pointer' id='tok-63-534'>start</span><span class='token pointer' id='tok-63-535'>with</span><span class='token pointer' id='tok-63-536'>fuzzing</span><span class='token pointer' id='tok-63-537'>the</span><span class='token pointer' id='tok-63-538'>application</span><span class='token pointer' id='tok-63-539'>and</span><span class='token pointer' id='tok-63-540'>figuring</span><span class='token pointer' id='tok-63-541'>out</span><span class='token pointer' id='tok-63-542'>the</span><span class='token pointer' id='tok-63-543'>offset</span><span class='token pointer' id='tok-63-544'>to</span><span class='token pointer' id='tok-63-545'>EIP.</span><span class='token pointer' id='tok-63-546'>First,</span><span class='token pointer' id='tok-63-547'>we</span><span class='token pointer' id='tok-63-548'>use</span><span class='token pointer' id='tok-63-549'>Python's</span><span class='token pointer' id='tok-63-550'>pwntools</span><span class='token pointer' id='tok-63-551'>library</span><span class='token pointer' id='tok-63-552'>for</span><span class='token pointer' id='tok-63-553'>generating</span><span class='token pointer' id='tok-63-554'>a</span><span class='token pointer' id='tok-63-555'>cyclic</span><span class='token pointer' id='tok-63-556'>pattern</span><span class='token pointer' id='tok-63-557'>and</span><span class='token pointer' id='tok-63-558'>end</span><span class='token pointer' id='tok-63-559'>up</span><span class='token pointer' id='tok-63-560'>with</span><span class='token pointer' id='tok-63-561'>following</span><span class='token pointer' id='tok-63-562'>snippet</span><span class='token pointer' id='tok-63-563'>of</span><span class='token pointer' id='tok-63-564'>code.</span></p>
<p id=p565><span class='token pointer' id='tok-63-565'>An</span><span class='token pointer' id='tok-63-566'>observant</span><span class='token pointer' id='tok-63-567'>user</span><span class='token pointer' id='tok-63-568'>must</span><span class='token pointer' id='tok-63-569'>have</span><span class='token pointer' id='tok-63-570'>noticed</span><span class='token pointer' id='tok-63-571'>that</span><span class='token pointer' id='tok-63-572'>application</span><span class='token pointer' id='tok-63-573'>is</span><span class='token pointer' id='tok-63-574'>using</span><span class='token pointer' id='tok-63-575'>forking</span><span class='token pointer' id='tok-63-576'>technique</span><span class='token pointer' id='tok-63-577'>to</span><span class='token pointer' id='tok-63-578'>serve</span><span class='token pointer' id='tok-63-579'>connections</span><span class='token pointer' id='tok-63-580'>thus</span><span class='token pointer' id='tok-63-581'>debugging</span><span class='token pointer' id='tok-63-582'>using</span><span class='token pointer' id='tok-63-583'>process</span><span class='token pointer' id='tok-63-584'>id</span><span class='token pointer' id='tok-63-585'>will</span><span class='token pointer' id='tok-63-586'>not</span><span class='token pointer' id='tok-63-587'>work</span><span class='token pointer' id='tok-63-588'>for</span><span class='token pointer' id='tok-63-589'>runtime</span><span class='token pointer' id='tok-63-590'>analysis.</span><span class='token pointer' id='tok-63-591'>Therefore,</span><span class='token pointer' id='tok-63-592'>we</span><span class='token pointer' id='tok-63-593'>need</span><span class='token pointer' id='tok-63-594'>to</span><span class='token pointer' id='tok-63-595'>debug</span><span class='token pointer' id='tok-63-596'>child</span><span class='token pointer' id='tok-63-597'>process.</span><span class='token pointer' id='tok-63-598'>We</span><span class='token pointer' id='tok-63-599'>placed</span><span class='token pointer' id='tok-63-600'>a</span><span class='token pointer' id='tok-63-601'>breakpoint</span><span class='token pointer' id='tok-63-602'>after</span><span class='token pointer' id='tok-63-603'>strdup</span><span class='token pointer' id='tok-63-604'>(0x0804982a)</span><span class='token pointer' id='tok-63-605'>and</span><span class='token pointer' id='tok-63-606'>started</span><span class='token pointer' id='tok-63-607'>analyzing</span><span class='token pointer' id='tok-63-608'>the</span><span class='token pointer' id='tok-63-609'>state</span><span class='token pointer' id='tok-63-610'>of</span><span class='token pointer' id='tok-63-611'>the</span><span class='token pointer' id='tok-63-612'>process.</span></p>
<p id=p613><span class='token pointer' id='tok-63-613'>As</span><span class='token pointer' id='tok-63-614'>we</span><span class='token pointer' id='tok-63-615'>will</span><span class='token pointer' id='tok-63-616'>need</span><span class='token pointer' id='tok-63-617'>to</span><span class='token pointer' id='tok-63-618'>debug</span><span class='token pointer' id='tok-63-619'>the</span><span class='token pointer' id='tok-63-620'>same</span><span class='token pointer' id='tok-63-621'>process</span><span class='token pointer' id='tok-63-622'>multiple</span><span class='token pointer' id='tok-63-623'>times</span><span class='token pointer' id='tok-63-624'>so</span><span class='token pointer' id='tok-63-625'>it</span><span class='token pointer' id='tok-63-626'>will</span><span class='token pointer' id='tok-63-627'>be</span><span class='token pointer' id='tok-63-628'>a</span><span class='token pointer' id='tok-63-629'>bit</span><span class='token pointer' id='tok-63-630'>painful</span><span class='token pointer' id='tok-63-631'>to</span><span class='token pointer' id='tok-63-632'>set</span><span class='token pointer' id='tok-63-633'>gdb</span><span class='token pointer' id='tok-63-634'>commands</span><span class='token pointer' id='tok-63-635'>every</span><span class='token pointer' id='tok-63-636'>time,</span><span class='token pointer' id='tok-63-637'>therefore</span><span class='token pointer' id='tok-63-638'>we</span><span class='token pointer' id='tok-63-639'>will</span><span class='token pointer' id='tok-63-640'>be</span><span class='token pointer' id='tok-63-641'>using</span><span class='token pointer' id='tok-63-642'>the</span><span class='token pointer' id='tok-63-643'>.gdbinit</span><span class='token pointer' id='tok-63-644'>file</span><span class='token pointer' id='tok-63-645'>for</span><span class='token pointer' id='tok-63-646'>the</span><span class='token pointer' id='tok-63-647'>sake</span><span class='token pointer' id='tok-63-648'>of</span><span class='token pointer' id='tok-63-649'>automation.</span></p>
<p id=p650><span class='token pointer' id='tok-63-650'>After</span><span class='token pointer' id='tok-63-651'>editing</span><span class='token pointer' id='tok-63-652'>the</span><span class='token pointer' id='tok-63-653'>.gdbinit</span><span class='token pointer' id='tok-63-654'>file</span><span class='token pointer' id='tok-63-655'>and</span><span class='token pointer' id='tok-63-656'>sending</span><span class='token pointer' id='tok-63-657'>our</span><span class='token pointer' id='tok-63-658'>fuzz</span><span class='token pointer' id='tok-63-659'>string</span><span class='token pointer' id='tok-63-660'>we</span><span class='token pointer' id='tok-63-661'>got</span><span class='token pointer' id='tok-63-662'>an</span><span class='token pointer' id='tok-63-663'>$eip</span><span class='token pointer' id='tok-63-664'>overwrite</span><span class='token pointer' id='tok-63-665'>at</span><span class='token pointer' id='tok-63-666'>0x46414149,</span><span class='token pointer' id='tok-63-667'>our</span><span class='token pointer' id='tok-63-668'>input</span><span class='token pointer' id='tok-63-669'>is</span><span class='token pointer' id='tok-63-670'>placed</span><span class='token pointer' id='tok-63-671'>on</span><span class='token pointer' id='tok-63-672'>the</span><span class='token pointer' id='tok-63-673'>stack</span><span class='token pointer' id='tok-63-674'>and</span><span class='token pointer' id='tok-63-675'>$eax</span><span class='token pointer' id='tok-63-676'>points</span><span class='token pointer' id='tok-63-677'>to</span><span class='token pointer' id='tok-63-678'>some</span><span class='token pointer' id='tok-63-679'>part</span><span class='token pointer' id='tok-63-680'>of</span><span class='token pointer' id='tok-63-681'>our</span><span class='token pointer' id='tok-63-682'>shellcode</span><span class='token pointer' id='tok-63-683'>mainly</span><span class='token pointer' id='tok-63-684'>from</span><span class='token pointer' id='tok-63-685'>the</span><span class='token pointer' id='tok-63-686'>start</span><span class='token pointer' id='tok-63-687'>because</span><span class='token pointer' id='tok-63-688'>of</span><span class='token pointer' id='tok-63-689'>strdup()</span><span class='token pointer' id='tok-63-690'>function</span><span class='token pointer' id='tok-63-691'>which</span><span class='token pointer' id='tok-63-692'>returns</span><span class='token pointer' id='tok-63-693'>in</span><span class='token pointer' id='tok-63-694'>$eax.</span><span class='token pointer' id='tok-63-695'>We</span><span class='token pointer' id='tok-63-696'>further</span><span class='token pointer' id='tok-63-697'>used</span><span class='token pointer' id='tok-63-698'>cyclic_find</span><span class='token pointer' id='tok-63-699'>function</span><span class='token pointer' id='tok-63-700'>from</span><span class='token pointer' id='tok-63-701'>pwntools</span><span class='token pointer' id='tok-63-702'>to</span><span class='token pointer' id='tok-63-703'>get</span><span class='token pointer' id='tok-63-704'>offset</span><span class='token pointer' id='tok-63-705'>to</span><span class='token pointer' id='tok-63-706'>$eip</span><span class='token pointer' id='tok-63-707'>at</span><span class='token pointer' id='tok-63-708'>532.</span></p>
<p id=p709><span class='token pointer' id='tok-63-709'>Ethical</span><span class='token pointer' id='tok-63-710'>Hacking</span><span class='token pointer' id='tok-63-711'>Training</span><span class='token pointer' id='tok-63-712'>–</span><span class='token pointer' id='tok-63-713'>Resources</span><span class='token pointer' id='tok-63-714'>(InfoSec)</span></p>
<p id=p715><span class='token pointer' id='tok-63-715'>Now</span><span class='token pointer' id='tok-63-716'>there</span><span class='token pointer' id='tok-63-717'>are</span><span class='token pointer' id='tok-63-718'>multiple</span><span class='token pointer' id='tok-63-719'>options</span><span class='token pointer' id='tok-63-720'>for</span><span class='token pointer' id='tok-63-721'>writing</span><span class='token pointer' id='tok-63-722'>exploit</span><span class='token pointer' id='tok-63-723'>for</span><span class='token pointer' id='tok-63-724'>this</span><span class='token pointer' id='tok-63-725'>program:</span></p>
<p id=p726><span class='token pointer' id='tok-63-726'>Return</span><span class='token pointer' id='tok-63-727'>to</span><span class='token pointer' id='tok-63-728'>register:</span><span class='token pointer' id='tok-63-729'>call</span><span class='token pointer' id='tok-63-730'>eax</span><span class='token pointer' id='tok-63-731'>(required</span><span class='token pointer' id='tok-63-732'>Alpha</span><span class='token pointer' id='tok-63-733'>upper</span><span class='token pointer' id='tok-63-734'>shellcode)Jump</span><span class='token pointer' id='tok-63-735'>to</span><span class='token pointer' id='tok-63-736'>stack:</span><span class='token pointer' id='tok-63-737'>At</span><span class='token pointer' id='tok-63-738'>the</span><span class='token pointer' id='tok-63-739'>time</span><span class='token pointer' id='tok-63-740'>of</span><span class='token pointer' id='tok-63-741'>the</span><span class='token pointer' id='tok-63-742'>crash,</span><span class='token pointer' id='tok-63-743'>no</span><span class='token pointer' id='tok-63-744'>pointers</span><span class='token pointer' id='tok-63-745'>to</span><span class='token pointer' id='tok-63-746'>our</span><span class='token pointer' id='tok-63-747'>shellcode</span><span class='token pointer' id='tok-63-748'>were</span><span class='token pointer' id='tok-63-749'>present</span><span class='token pointer' id='tok-63-750'>on</span><span class='token pointer' id='tok-63-751'>the</span><span class='token pointer' id='tok-63-752'>stack</span><span class='token pointer' id='tok-63-753'>we</span><span class='token pointer' id='tok-63-754'>need</span><span class='token pointer' id='tok-63-755'>to</span><span class='token pointer' id='tok-63-756'>rely</span><span class='token pointer' id='tok-63-757'>on</span><span class='token pointer' id='tok-63-758'>the</span><span class='token pointer' id='tok-63-759'>hardcoded</span><span class='token pointer' id='tok-63-760'>address</span><span class='token pointer' id='tok-63-761'>(Not</span><span class='token pointer' id='tok-63-762'>a</span><span class='token pointer' id='tok-63-763'>reliable</span><span class='token pointer' id='tok-63-764'>way).</span><span class='token pointer' id='tok-63-765'>Also,</span><span class='token pointer' id='tok-63-766'>we</span><span class='token pointer' id='tok-63-767'>do</span><span class='token pointer' id='tok-63-768'>not</span><span class='token pointer' id='tok-63-769'>need</span><span class='token pointer' id='tok-63-770'>alphanumeric</span><span class='token pointer' id='tok-63-771'>shellcode</span><span class='token pointer' id='tok-63-772'>in</span><span class='token pointer' id='tok-63-773'>this</span><span class='token pointer' id='tok-63-774'>case</span><span class='token pointer' id='tok-63-775'>as</span><span class='token pointer' id='tok-63-776'>gets</span><span class='token pointer' id='tok-63-777'>will</span><span class='token pointer' id='tok-63-778'>copying</span><span class='token pointer' id='tok-63-779'>our</span><span class='token pointer' id='tok-63-780'>input</span><span class='token pointer' id='tok-63-781'>into</span><span class='token pointer' id='tok-63-782'>buffer</span><span class='token pointer' id='tok-63-783'>after</span><span class='token pointer' id='tok-63-784'>it</span><span class='token pointer' id='tok-63-785'>meets</span><span class='token pointer' id='tok-63-786'>a</span><span class='token pointer' id='tok-63-787'>null</span><span class='token pointer' id='tok-63-788'>bytes</span><span class='token pointer' id='tok-63-789'>(\x00).ROP</span><span class='token pointer' id='tok-63-790'>Chain</span><span class='token pointer' id='tok-63-791'>via</span><span class='token pointer' id='tok-63-792'>ret2libc:</span><span class='token pointer' id='tok-63-793'>As</span><span class='token pointer' id='tok-63-794'>there</span><span class='token pointer' id='tok-63-795'>is</span><span class='token pointer' id='tok-63-796'>no</span><span class='token pointer' id='tok-63-797'>ASLR</span><span class='token pointer' id='tok-63-798'>enabled</span><span class='token pointer' id='tok-63-799'>on</span><span class='token pointer' id='tok-63-800'>the</span><span class='token pointer' id='tok-63-801'>system</span><span class='token pointer' id='tok-63-802'>we</span><span class='token pointer' id='tok-63-803'>can</span><span class='token pointer' id='tok-63-804'>rely</span><span class='token pointer' id='tok-63-805'>on</span><span class='token pointer' id='tok-63-806'>the</span><span class='token pointer' id='tok-63-807'>PLT</span><span class='token pointer' id='tok-63-808'>address</span><span class='token pointer' id='tok-63-809'>from</span><span class='token pointer' id='tok-63-810'>the</span><span class='token pointer' id='tok-63-811'>executable</span><span class='token pointer' id='tok-63-812'>itself</span><span class='token pointer' id='tok-63-813'>construct</span><span class='token pointer' id='tok-63-814'>a</span><span class='token pointer' id='tok-63-815'>simple</span><span class='token pointer' id='tok-63-816'>ROP</span><span class='token pointer' id='tok-63-817'>chain.</span><span class='token pointer' id='tok-63-818'>(Reliable</span><span class='token pointer' id='tok-63-819'>unless</span><span class='token pointer' id='tok-63-820'>ASLR</span><span class='token pointer' id='tok-63-821'>is</span><span class='token pointer' id='tok-63-822'>enabled</span><span class='token pointer' id='tok-63-823'>even</span><span class='token pointer' id='tok-63-824'>in</span><span class='token pointer' id='tok-63-825'>that</span><span class='token pointer' id='tok-63-826'>case</span><span class='token pointer' id='tok-63-827'>we</span><span class='token pointer' id='tok-63-828'>need</span><span class='token pointer' id='tok-63-829'>to</span><span class='token pointer' id='tok-63-830'>modify</span><span class='token pointer' id='tok-63-831'>our</span><span class='token pointer' id='tok-63-832'>shellcode</span><span class='token pointer' id='tok-63-833'>to</span><span class='token pointer' id='tok-63-834'>make</span><span class='token pointer' id='tok-63-835'>it</span><span class='token pointer' id='tok-63-836'>work</span><span class='token pointer' id='tok-63-837'>again</span><span class='token pointer' id='tok-63-838'>slightly)Our</span><span class='token pointer' id='tok-63-839'>ROP</span><span class='token pointer' id='tok-63-840'>chain</span><span class='token pointer' id='tok-63-841'>will</span><span class='token pointer' id='tok-63-842'>do</span><span class='token pointer' id='tok-63-843'>the</span><span class='token pointer' id='tok-63-844'>following:</span></p>
<p id=p845><span class='token pointer' id='tok-63-845'>Read</span><span class='token pointer' id='tok-63-846'>the</span><span class='token pointer' id='tok-63-847'>contents</span><span class='token pointer' id='tok-63-848'>of</span><span class='token pointer' id='tok-63-849'>system</span><span class='token pointer' id='tok-63-850'>command</span><span class='token pointer' id='tok-63-851'>in</span><span class='token pointer' id='tok-63-852'>.dynamic</span><span class='token pointer' id='tok-63-853'>section.Pass</span><span class='token pointer' id='tok-63-854'>the</span><span class='token pointer' id='tok-63-855'>pointer</span><span class='token pointer' id='tok-63-856'>of</span><span class='token pointer' id='tok-63-857'>.dynamic</span><span class='token pointer' id='tok-63-858'>to</span><span class='token pointer' id='tok-63-859'>execve.</span></p>
<p id=p860><span class='token pointer' id='tok-63-860'>As</span><span class='token pointer' id='tok-63-861'>we</span><span class='token pointer' id='tok-63-862'>see</span><span class='token pointer' id='tok-63-863'>in</span><span class='token pointer' id='tok-63-864'>the</span><span class='token pointer' id='tok-63-865'>following</span><span class='token pointer' id='tok-63-866'>screenshot,</span><span class='token pointer' id='tok-63-867'>we</span><span class='token pointer' id='tok-63-868'>were</span><span class='token pointer' id='tok-63-869'>able</span><span class='token pointer' id='tok-63-870'>to</span><span class='token pointer' id='tok-63-871'>obtain</span><span class='token pointer' id='tok-63-872'>remote</span><span class='token pointer' id='tok-63-873'>shell</span><span class='token pointer' id='tok-63-874'>by</span><span class='token pointer' id='tok-63-875'>exploiting</span><span class='token pointer' id='tok-63-876'>final0</span><span class='token pointer' id='tok-63-877'>binary.</span></p>
<p id=p878><span class='token pointer' id='tok-63-878'></span><span class='token pointer' id='tok-63-879'></span><span class='token pointer' id='tok-63-880'></span><span class='token pointer' id='tok-63-881'>