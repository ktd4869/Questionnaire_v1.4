<p id=p0><span class='token pointer' id='tok-63-0'>In</span><span class='token pointer' id='tok-63-1'>this</span><span class='token pointer' id='tok-63-2'>article,</span><span class='token pointer' id='tok-63-3'>we</span><span class='token pointer' id='tok-63-4'>will</span><span class='token pointer' id='tok-63-5'>be</span><span class='token pointer' id='tok-63-6'>solving</span><span class='token pointer' id='tok-63-7'>all</span><span class='token pointer' id='tok-63-8'>networking</span><span class='token pointer' id='tok-63-9'>challenges</span><span class='token pointer' id='tok-63-10'>and</span><span class='token pointer' id='tok-63-11'>one</span><span class='token pointer' id='tok-63-12'>remote</span><span class='token pointer' id='tok-63-13'>buffer</span><span class='token pointer' id='tok-63-14'>overflow</span><span class='token pointer' id='tok-63-15'>challenge</span><span class='token pointer' id='tok-63-16'>of</span><span class='token pointer' id='tok-63-17'>Protostar.</span></p>
<p id=p18><span class='token pointer' id='tok-63-18'>IntroductionThese</span><span class='token pointer' id='tok-63-19'>levels</span><span class='token pointer' id='tok-63-20'>introduce</span><span class='token pointer' id='tok-63-21'>us</span><span class='token pointer' id='tok-63-22'>to</span><span class='token pointer' id='tok-63-23'>the</span><span class='token pointer' id='tok-63-24'>fundamental</span><span class='token pointer' id='tok-63-25'>concept</span><span class='token pointer' id='tok-63-26'>of</span><span class='token pointer' id='tok-63-27'>sending</span><span class='token pointer' id='tok-63-28'>and</span><span class='token pointer' id='tok-63-29'>receiving</span><span class='token pointer' id='tok-63-30'>data</span><span class='token pointer' id='tok-63-31'>over</span><span class='token pointer' id='tok-63-32'>a</span><span class='token pointer' id='tok-63-33'>network</span><span class='token pointer' id='tok-63-34'>in</span><span class='token pointer' id='tok-63-35'>a</span><span class='token pointer' id='tok-63-36'>different</span><span class='token pointer' id='tok-63-37'>format,</span><span class='token pointer' id='tok-63-38'>and</span><span class='token pointer' id='tok-63-39'>the</span><span class='token pointer' id='tok-63-40'>hurdles</span><span class='token pointer' id='tok-63-41'>of</span><span class='token pointer' id='tok-63-42'>debugging</span><span class='token pointer' id='tok-63-43'>and</span><span class='token pointer' id='tok-63-44'>developing</span><span class='token pointer' id='tok-63-45'>an</span><span class='token pointer' id='tok-63-46'>exploit</span><span class='token pointer' id='tok-63-47'>for</span><span class='token pointer' id='tok-63-48'>remote</span><span class='token pointer' id='tok-63-49'>stack</span><span class='token pointer' id='tok-63-50'>overflows.</span><span class='token pointer' id='tok-63-51'>We</span><span class='token pointer' id='tok-63-52'>will</span><span class='token pointer' id='tok-63-53'>have</span><span class='token pointer' id='tok-63-54'>a</span><span class='token pointer' id='tok-63-55'>look</span><span class='token pointer' id='tok-63-56'>at</span><span class='token pointer' id='tok-63-57'>how</span><span class='token pointer' id='tok-63-58'>we</span><span class='token pointer' id='tok-63-59'>can</span><span class='token pointer' id='tok-63-60'>debug</span><span class='token pointer' id='tok-63-61'>and</span><span class='token pointer' id='tok-63-62'>understand</span><span class='token pointer' id='tok-63-63'>what</span><span class='token pointer' id='tok-63-64'>inputs</span><span class='token pointer' id='tok-63-65'>the</span><span class='token pointer' id='tok-63-66'>program</span><span class='token pointer' id='tok-63-67'>expects</span><span class='token pointer' id='tok-63-68'>from</span><span class='token pointer' id='tok-63-69'>us.</span></p>
<p id=p70><span class='token pointer' id='tok-63-70'>DownloadsThe</span><span class='token pointer' id='tok-63-71'>VM</span><span class='token pointer' id='tok-63-72'>used</span><span class='token pointer' id='tok-63-73'>in</span><span class='token pointer' id='tok-63-74'>this</span><span class='token pointer' id='tok-63-75'>article</span><span class='token pointer' id='tok-63-76'>can</span><span class='token pointer' id='tok-63-77'>be</span><span class='token pointer' id='tok-63-78'>downloaded</span><span class='token pointer' id='tok-63-79'>from</span><span class='token pointer' id='tok-63-80'>here</span></p>
<p id=p81><span class='token pointer' id='tok-63-81'>Net</span><span class='token pointer' id='tok-63-82'>0The</span><span class='token pointer' id='tok-63-83'>following</span><span class='token pointer' id='tok-63-84'>assembly</span><span class='token pointer' id='tok-63-85'>code</span><span class='token pointer' id='tok-63-86'>is</span><span class='token pointer' id='tok-63-87'>obtained</span><span class='token pointer' id='tok-63-88'>after</span><span class='token pointer' id='tok-63-89'>disassembling</span><span class='token pointer' id='tok-63-90'>the</span><span class='token pointer' id='tok-63-91'>Net0</span><span class='token pointer' id='tok-63-92'>binary.</span><span class='token pointer' id='tok-63-93'>As</span><span class='token pointer' id='tok-63-94'>we</span><span class='token pointer' id='tok-63-95'>can</span><span class='token pointer' id='tok-63-96'>see,</span><span class='token pointer' id='tok-63-97'>the</span><span class='token pointer' id='tok-63-98'>application</span><span class='token pointer' id='tok-63-99'>executes</span><span class='token pointer' id='tok-63-100'>run</span><span class='token pointer' id='tok-63-101'>function</span><span class='token pointer' id='tok-63-102'>from</span><span class='token pointer' id='tok-63-103'>the</span><span class='token pointer' id='tok-63-104'>main</span><span class='token pointer' id='tok-63-105'>function.</span><span class='token pointer' id='tok-63-106'>The</span><span class='token pointer' id='tok-63-107'>run</span><span class='token pointer' id='tok-63-108'>function</span><span class='token pointer' id='tok-63-109'>generates</span><span class='token pointer' id='tok-63-110'>a</span><span class='token pointer' id='tok-63-111'>random</span><span class='token pointer' id='tok-63-112'>number</span><span class='token pointer' id='tok-63-113'>and</span><span class='token pointer' id='tok-63-114'>uses</span><span class='token pointer' id='tok-63-115'>printf</span><span class='token pointer' id='tok-63-116'>function</span><span class='token pointer' id='tok-63-117'>call</span><span class='token pointer' id='tok-63-118'>to</span><span class='token pointer' id='tok-63-119'>print</span><span class='token pointer' id='tok-63-120'>it</span><span class='token pointer' id='tok-63-121'>on</span><span class='token pointer' id='tok-63-122'>the</span><span class='token pointer' id='tok-63-123'>screen.</span><span class='token pointer' id='tok-63-124'>It</span><span class='token pointer' id='tok-63-125'>further</span><span class='token pointer' id='tok-63-126'>checks</span><span class='token pointer' id='tok-63-127'>whether</span><span class='token pointer' id='tok-63-128'>our</span><span class='token pointer' id='tok-63-129'>input</span><span class='token pointer' id='tok-63-130'>matches</span><span class='token pointer' id='tok-63-131'>to</span><span class='token pointer' id='tok-63-132'>the</span><span class='token pointer' id='tok-63-133'>random()</span><span class='token pointer' id='tok-63-134'>number</span><span class='token pointer' id='tok-63-135'>generated</span><span class='token pointer' id='tok-63-136'>by</span><span class='token pointer' id='tok-63-137'>comparing</span><span class='token pointer' id='tok-63-138'>our</span><span class='token pointer' id='tok-63-139'>raw</span><span class='token pointer' id='tok-63-140'>input</span><span class='token pointer' id='tok-63-141'>and</span><span class='token pointer' id='tok-63-142'>random</span><span class='token pointer' id='tok-63-143'>number</span><span class='token pointer' id='tok-63-144'>generated</span><span class='token pointer' id='tok-63-145'>previously.</span></p>
<p id=p146><span class='token pointer' id='tok-63-146'>Our</span><span class='token pointer' id='tok-63-147'>logic</span><span class='token pointer' id='tok-63-148'>for</span><span class='token pointer' id='tok-63-149'>solving</span><span class='token pointer' id='tok-63-150'>this</span><span class='token pointer' id='tok-63-151'>challenge</span><span class='token pointer' id='tok-63-152'>will</span><span class='token pointer' id='tok-63-153'>be</span><span class='token pointer' id='tok-63-154'>composed</span><span class='token pointer' id='tok-63-155'>of</span><span class='token pointer' id='tok-63-156'>following</span><span class='token pointer' id='tok-63-157'>steps:</span></p>
<p id=p158><span class='token pointer' id='tok-63-158'>Connect</span><span class='token pointer' id='tok-63-159'>to</span><span class='token pointer' id='tok-63-160'>serverRecv()</span><span class='token pointer' id='tok-63-161'>some</span><span class='token pointer' id='tok-63-162'>dataParse</span><span class='token pointer' id='tok-63-163'>the</span><span class='token pointer' id='tok-63-164'>data</span><span class='token pointer' id='tok-63-165'>and</span><span class='token pointer' id='tok-63-166'>take</span><span class='token pointer' id='tok-63-167'>out</span><span class='token pointer' id='tok-63-168'>the</span><span class='token pointer' id='tok-63-169'>random</span><span class='token pointer' id='tok-63-170'>number</span><span class='token pointer' id='tok-63-171'>ask</span><span class='token pointer' id='tok-63-172'>by</span><span class='token pointer' id='tok-63-173'>the</span><span class='token pointer' id='tok-63-174'>applicationPack</span><span class='token pointer' id='tok-63-175'>the</span><span class='token pointer' id='tok-63-176'>random</span><span class='token pointer' id='tok-63-177'>number</span><span class='token pointer' id='tok-63-178'>in</span><span class='token pointer' id='tok-63-179'>little-endian</span><span class='token pointer' id='tok-63-180'>format</span><span class='token pointer' id='tok-63-181'>and</span><span class='token pointer' id='tok-63-182'>send</span><span class='token pointer' id='tok-63-183'>it</span><span class='token pointer' id='tok-63-184'>back.Using</span><span class='token pointer' id='tok-63-185'>the</span><span class='token pointer' id='tok-63-186'>logic</span><span class='token pointer' id='tok-63-187'>listed</span><span class='token pointer' id='tok-63-188'>above,</span><span class='token pointer' id='tok-63-189'>we</span><span class='token pointer' id='tok-63-190'>came</span><span class='token pointer' id='tok-63-191'>up</span><span class='token pointer' id='tok-63-192'>with</span><span class='token pointer' id='tok-63-193'>the</span><span class='token pointer' id='tok-63-194'>following</span><span class='token pointer' id='tok-63-195'>piece</span><span class='token pointer' id='tok-63-196'>of</span><span class='token pointer' id='tok-63-197'>code</span><span class='token pointer' id='tok-63-198'>and</span><span class='token pointer' id='tok-63-199'>successfully</span><span class='token pointer' id='tok-63-200'>passed</span><span class='token pointer' id='tok-63-201'>this</span><span class='token pointer' id='tok-63-202'>challenge.</span></p>
<p id=p203><span class='token pointer' id='tok-63-203'>Net</span><span class='token pointer' id='tok-63-204'>1By</span><span class='token pointer' id='tok-63-205'>looking</span><span class='token pointer' id='tok-63-206'>at</span><span class='token pointer' id='tok-63-207'>the</span><span class='token pointer' id='tok-63-208'>disassembled</span><span class='token pointer' id='tok-63-209'>code</span><span class='token pointer' id='tok-63-210'>of</span><span class='token pointer' id='tok-63-211'>binary</span><span class='token pointer' id='tok-63-212'>Net1,</span><span class='token pointer' id='tok-63-213'>we</span><span class='token pointer' id='tok-63-214'>can</span><span class='token pointer' id='tok-63-215'>understand</span><span class='token pointer' id='tok-63-216'>following</span><span class='token pointer' id='tok-63-217'>things:</span></p>
<p id=p218><span class='token pointer' id='tok-63-218'>The</span><span class='token pointer' id='tok-63-219'>program</span><span class='token pointer' id='tok-63-220'>generates</span><span class='token pointer' id='tok-63-221'>a</span><span class='token pointer' id='tok-63-222'>random</span><span class='token pointer' id='tok-63-223'>number</span><span class='token pointer' id='tok-63-224'>and</span><span class='token pointer' id='tok-63-225'>stores</span><span class='token pointer' id='tok-63-226'>the</span><span class='token pointer' id='tok-63-227'>integer</span><span class='token pointer' id='tok-63-228'>as</span><span class='token pointer' id='tok-63-229'>a</span><span class='token pointer' id='tok-63-230'>string</span><span class='token pointer' id='tok-63-231'>at</span><span class='token pointer' id='tok-63-232'>ebp-0x24.It</span><span class='token pointer' id='tok-63-233'>then</span><span class='token pointer' id='tok-63-234'>writes</span><span class='token pointer' id='tok-63-235'>the</span><span class='token pointer' id='tok-63-236'>content</span><span class='token pointer' id='tok-63-237'>of</span><span class='token pointer' id='tok-63-238'>number</span><span class='token pointer' id='tok-63-239'>generated</span><span class='token pointer' id='tok-63-240'>to</span><span class='token pointer' id='tok-63-241'>stdout.It</span><span class='token pointer' id='tok-63-242'>then</span><span class='token pointer' id='tok-63-243'>takes</span><span class='token pointer' id='tok-63-244'>input</span><span class='token pointer' id='tok-63-245'>from</span><span class='token pointer' id='tok-63-246'>user</span><span class='token pointer' id='tok-63-247'>removes</span><span class='token pointer' id='tok-63-248'>CRLF</span><span class='token pointer' id='tok-63-249'>characters</span><span class='token pointer' id='tok-63-250'>and</span><span class='token pointer' id='tok-63-251'>compare</span><span class='token pointer' id='tok-63-252'>the</span><span class='token pointer' id='tok-63-253'>input</span><span class='token pointer' id='tok-63-254'>with</span><span class='token pointer' id='tok-63-255'>the</span><span class='token pointer' id='tok-63-256'>contents</span><span class='token pointer' id='tok-63-257'>of</span><span class='token pointer' id='tok-63-258'>ebp-0x24</span><span class='token pointer' id='tok-63-259'>variable</span><span class='token pointer' id='tok-63-260'>saved</span><span class='token pointer' id='tok-63-261'>earlier.As</span><span class='token pointer' id='tok-63-262'>in</span><span class='token pointer' id='tok-63-263'>this</span><span class='token pointer' id='tok-63-264'>case,</span><span class='token pointer' id='tok-63-265'>the</span><span class='token pointer' id='tok-63-266'>data</span><span class='token pointer' id='tok-63-267'>is</span><span class='token pointer' id='tok-63-268'>already</span><span class='token pointer' id='tok-63-269'>packed</span><span class='token pointer' id='tok-63-270'>in</span><span class='token pointer' id='tok-63-271'>32-bit</span><span class='token pointer' id='tok-63-272'>integers.</span><span class='token pointer' id='tok-63-273'>We</span><span class='token pointer' id='tok-63-274'>will</span><span class='token pointer' id='tok-63-275'>be</span><span class='token pointer' id='tok-63-276'>using</span><span class='token pointer' id='tok-63-277'>similar</span><span class='token pointer' id='tok-63-278'>logic</span><span class='token pointer' id='tok-63-279'>from</span><span class='token pointer' id='tok-63-280'>the</span><span class='token pointer' id='tok-63-281'>NET0</span><span class='token pointer' id='tok-63-282'>level</span><span class='token pointer' id='tok-63-283'>and</span><span class='token pointer' id='tok-63-284'>after</span><span class='token pointer' id='tok-63-285'>receiving</span><span class='token pointer' id='tok-63-286'>the</span><span class='token pointer' id='tok-63-287'>data</span><span class='token pointer' id='tok-63-288'>we</span><span class='token pointer' id='tok-63-289'>will</span><span class='token pointer' id='tok-63-290'>be</span><span class='token pointer' id='tok-63-291'>unpacking</span><span class='token pointer' id='tok-63-292'>it</span><span class='token pointer' id='tok-63-293'>to</span><span class='token pointer' id='tok-63-294'>32-bit</span><span class='token pointer' id='tok-63-295'>integer</span><span class='token pointer' id='tok-63-296'>and</span><span class='token pointer' id='tok-63-297'>send</span><span class='token pointer' id='tok-63-298'>the</span><span class='token pointer' id='tok-63-299'>unpacked</span><span class='token pointer' id='tok-63-300'>value</span><span class='token pointer' id='tok-63-301'>back</span><span class='token pointer' id='tok-63-302'>as</span><span class='token pointer' id='tok-63-303'>it</span><span class='token pointer' id='tok-63-304'>is.</span></p>
<p id=p305><span class='token pointer' id='tok-63-305'>Finally,</span><span class='token pointer' id='tok-63-306'>we</span><span class='token pointer' id='tok-63-307'>came</span><span class='token pointer' id='tok-63-308'>up</span><span class='token pointer' id='tok-63-309'>with</span><span class='token pointer' id='tok-63-310'>following</span><span class='token pointer' id='tok-63-311'>piece</span><span class='token pointer' id='tok-63-312'>of</span><span class='token pointer' id='tok-63-313'>code</span><span class='token pointer' id='tok-63-314'>that</span><span class='token pointer' id='tok-63-315'>will</span><span class='token pointer' id='tok-63-316'>solve</span><span class='token pointer' id='tok-63-317'>this</span><span class='token pointer' id='tok-63-318'>challenge.</span></p>
<p id=p319><span class='token pointer' id='tok-63-319'>Net</span><span class='token pointer' id='tok-63-320'>2By</span><span class='token pointer' id='tok-63-321'>looking</span><span class='token pointer' id='tok-63-322'>at</span><span class='token pointer' id='tok-63-323'>the</span><span class='token pointer' id='tok-63-324'>disassembled</span><span class='token pointer' id='tok-63-325'>code</span><span class='token pointer' id='tok-63-326'>of</span><span class='token pointer' id='tok-63-327'>binary</span><span class='token pointer' id='tok-63-328'>Net2,</span><span class='token pointer' id='tok-63-329'>we</span><span class='token pointer' id='tok-63-330'>can</span><span class='token pointer' id='tok-63-331'>understand</span><span class='token pointer' id='tok-63-332'>following</span><span class='token pointer' id='tok-63-333'>things:</span></p>
<p id=p334><span class='token pointer' id='tok-63-334'>The</span><span class='token pointer' id='tok-63-335'>application</span><span class='token pointer' id='tok-63-336'>generates</span><span class='token pointer' id='tok-63-337'>four</span><span class='token pointer' id='tok-63-338'>random</span><span class='token pointer' id='tok-63-339'>numbers</span><span class='token pointer' id='tok-63-340'>and</span><span class='token pointer' id='tok-63-341'>sends</span><span class='token pointer' id='tok-63-342'>in</span><span class='token pointer' id='tok-63-343'>four</span><span class='token pointer' id='tok-63-344'>iterations</span><span class='token pointer' id='tok-63-345'>using</span><span class='token pointer' id='tok-63-346'>write</span><span class='token pointer' id='tok-63-347'>().It</span><span class='token pointer' id='tok-63-348'>also</span><span class='token pointer' id='tok-63-349'>keeps</span><span class='token pointer' id='tok-63-350'>on</span><span class='token pointer' id='tok-63-351'>adding</span><span class='token pointer' id='tok-63-352'>them</span><span class='token pointer' id='tok-63-353'>and</span><span class='token pointer' id='tok-63-354'>stores</span><span class='token pointer' id='tok-63-355'>the</span><span class='token pointer' id='tok-63-356'>overall</span><span class='token pointer' id='tok-63-357'>result</span><span class='token pointer' id='tok-63-358'>at</span><span class='token pointer' id='tok-63-359'>ebp-0xc.As</span><span class='token pointer' id='tok-63-360'>a</span><span class='token pointer' id='tok-63-361'>result</span><span class='token pointer' id='tok-63-362'>might</span><span class='token pointer' id='tok-63-363'>overflow</span><span class='token pointer' id='tok-63-364'>its</span><span class='token pointer' id='tok-63-365'>limit,</span><span class='token pointer' id='tok-63-366'>it</span><span class='token pointer' id='tok-63-367'>will</span><span class='token pointer' id='tok-63-368'>wrap,</span><span class='token pointer' id='tok-63-369'>so</span><span class='token pointer' id='tok-63-370'>we</span><span class='token pointer' id='tok-63-371'>need</span><span class='token pointer' id='tok-63-372'>to</span><span class='token pointer' id='tok-63-373'>take</span><span class='token pointer' id='tok-63-374'>care</span><span class='token pointer' id='tok-63-375'>of</span><span class='token pointer' id='tok-63-376'>that</span><span class='token pointer' id='tok-63-377'>in</span><span class='token pointer' id='tok-63-378'>our</span><span class='token pointer' id='tok-63-379'>code</span><span class='token pointer' id='tok-63-380'>too.Finally,</span><span class='token pointer' id='tok-63-381'>it</span><span class='token pointer' id='tok-63-382'>checks</span><span class='token pointer' id='tok-63-383'>the</span><span class='token pointer' id='tok-63-384'>input</span><span class='token pointer' id='tok-63-385'>provided</span><span class='token pointer' id='tok-63-386'>by</span><span class='token pointer' id='tok-63-387'>the</span><span class='token pointer' id='tok-63-388'>user</span><span class='token pointer' id='tok-63-389'>matches</span><span class='token pointer' id='tok-63-390'>the</span><span class='token pointer' id='tok-63-391'>added</span><span class='token pointer' id='tok-63-392'>numbers,</span><span class='token pointer' id='tok-63-393'>so</span><span class='token pointer' id='tok-63-394'>we</span><span class='token pointer' id='tok-63-395'>need</span><span class='token pointer' id='tok-63-396'>to</span><span class='token pointer' id='tok-63-397'>pack</span><span class='token pointer' id='tok-63-398'>our</span><span class='token pointer' id='tok-63-399'>input</span><span class='token pointer' id='tok-63-400'>to</span><span class='token pointer' id='tok-63-401'>an</span><span class='token pointer' id='tok-63-402'>unsigned</span><span class='token pointer' id='tok-63-403'>int</span><span class='token pointer' id='tok-63-404'>to</span><span class='token pointer' id='tok-63-405'>take</span><span class='token pointer' id='tok-63-406'>care</span><span class='token pointer' id='tok-63-407'>of</span><span class='token pointer' id='tok-63-408'>that.</span></p>
<p id=p409><span class='token pointer' id='tok-63-409'>We</span><span class='token pointer' id='tok-63-410'>came</span><span class='token pointer' id='tok-63-411'>up</span><span class='token pointer' id='tok-63-412'>with</span><span class='token pointer' id='tok-63-413'>the</span><span class='token pointer' id='tok-63-414'>following</span><span class='token pointer' id='tok-63-415'>piece</span><span class='token pointer' id='tok-63-416'>of</span><span class='token pointer' id='tok-63-417'>code</span><span class='token pointer' id='tok-63-418'>to</span><span class='token pointer' id='tok-63-419'>solve</span><span class='token pointer' id='tok-63-420'>this</span><span class='token pointer' id='tok-63-421'>challenge</span><span class='token pointer' id='tok-63-422'>using</span><span class='token pointer' id='tok-63-423'>the</span><span class='token pointer' id='tok-63-424'>following</span><span class='token pointer' id='tok-63-425'>algorithm:</span></p>
<p id=p426><span class='token pointer' id='tok-63-426'>Connect</span><span class='token pointer' id='tok-63-427'>to</span><span class='token pointer' id='tok-63-428'>the</span><span class='token pointer' id='tok-63-429'>server.recv</span><span class='token pointer' id='tok-63-430'>()</span><span class='token pointer' id='tok-63-431'>four</span><span class='token pointer' id='tok-63-432'>bytes</span><span class='token pointer' id='tok-63-433'>of</span><span class='token pointer' id='tok-63-434'>data</span><span class='token pointer' id='tok-63-435'>from</span><span class='token pointer' id='tok-63-436'>the</span><span class='token pointer' id='tok-63-437'>server</span><span class='token pointer' id='tok-63-438'>iteratively</span><span class='token pointer' id='tok-63-439'>four</span><span class='token pointer' id='tok-63-440'>times</span><span class='token pointer' id='tok-63-441'>and</span><span class='token pointer' id='tok-63-442'>add</span><span class='token pointer' id='tok-63-443'>them.DO</span><span class='token pointer' id='tok-63-444'>an</span><span class='token pointer' id='tok-63-445'>AND</span><span class='token pointer' id='tok-63-446'>operation</span><span class='token pointer' id='tok-63-447'>with</span><span class='token pointer' id='tok-63-448'>the</span><span class='token pointer' id='tok-63-449'>final</span><span class='token pointer' id='tok-63-450'>sum,</span><span class='token pointer' id='tok-63-451'>so</span><span class='token pointer' id='tok-63-452'>the</span><span class='token pointer' id='tok-63-453'>result</span><span class='token pointer' id='tok-63-454'>stays</span><span class='token pointer' id='tok-63-455'>in</span><span class='token pointer' id='tok-63-456'>32</span><span class='token pointer' id='tok-63-457'>unsigned</span><span class='token pointer' id='tok-63-458'>int's</span><span class='token pointer' id='tok-63-459'>range.Pack</span><span class='token pointer' id='tok-63-460'>the</span><span class='token pointer' id='tok-63-461'>result</span><span class='token pointer' id='tok-63-462'>and</span><span class='token pointer' id='tok-63-463'>send</span><span class='token pointer' id='tok-63-464'>it</span><span class='token pointer' id='tok-63-465'>back</span><span class='token pointer' id='tok-63-466'>to</span><span class='token pointer' id='tok-63-467'>the</span><span class='token pointer' id='tok-63-468'>server.</span></p>
<p id=p469><span class='token pointer' id='tok-63-469'>This</span><span class='token pointer' id='tok-63-470'>level</span><span class='token pointer' id='tok-63-471'>takes</span><span class='token pointer' id='tok-63-472'>us</span><span class='token pointer' id='tok-63-473'>back</span><span class='token pointer' id='tok-63-474'>to</span><span class='token pointer' id='tok-63-475'>simple</span><span class='token pointer' id='tok-63-476'>stack</span><span class='token pointer' id='tok-63-477'>based</span><span class='token pointer' id='tok-63-478'>buffer</span><span class='token pointer' id='tok-63-479'>overflows</span><span class='token pointer' id='tok-63-480'>with</span><span class='token pointer' id='tok-63-481'>little</span><span class='token pointer' id='tok-63-482'>restrictions</span><span class='token pointer' id='tok-63-483'>added</span><span class='token pointer' id='tok-63-484'>here</span><span class='token pointer' id='tok-63-485'>and</span><span class='token pointer' id='tok-63-486'>there.</span><span class='token pointer' id='tok-63-487'>Let's</span><span class='token pointer' id='tok-63-488'>have</span><span class='token pointer' id='tok-63-489'>a</span><span class='token pointer' id='tok-63-490'>look</span><span class='token pointer' id='tok-63-491'>at</span><span class='token pointer' id='tok-63-492'>the</span><span class='token pointer' id='tok-63-493'>disassembled</span><span class='token pointer' id='tok-63-494'>code</span><span class='token pointer' id='tok-63-495'>for</span><span class='token pointer' id='tok-63-496'>this</span><span class='token pointer' id='tok-63-497'>level.</span><span class='token pointer' id='tok-63-498'>By</span><span class='token pointer' id='tok-63-499'>looking</span><span class='token pointer' id='tok-63-500'>at</span><span class='token pointer' id='tok-63-501'>the</span><span class='token pointer' id='tok-63-502'>code</span><span class='token pointer' id='tok-63-503'>we</span><span class='token pointer' id='tok-63-504'>can</span><span class='token pointer' id='tok-63-505'>quickly</span><span class='token pointer' id='tok-63-506'>figure</span><span class='token pointer' id='tok-63-507'>out</span><span class='token pointer' id='tok-63-508'>the</span><span class='token pointer' id='tok-63-509'>vulnerable</span><span class='token pointer' id='tok-63-510'>function</span><span class='token pointer' id='tok-63-511'>gets()</span><span class='token pointer' id='tok-63-512'>is</span><span class='token pointer' id='tok-63-513'>used</span><span class='token pointer' id='tok-63-514'>but</span><span class='token pointer' id='tok-63-515'>the</span><span class='token pointer' id='tok-63-516'>problem</span><span class='token pointer' id='tok-63-517'>is</span><span class='token pointer' id='tok-63-518'>our</span><span class='token pointer' id='tok-63-519'>input</span><span class='token pointer' id='tok-63-520'>gets</span><span class='token pointer' id='tok-63-521'>passed</span><span class='token pointer' id='tok-63-522'>through</span><span class='token pointer' id='tok-63-523'>the</span><span class='token pointer' id='tok-63-524'>for</span><span class='token pointer' id='tok-63-525'>loop</span><span class='token pointer' id='tok-63-526'>which</span><span class='token pointer' id='tok-63-527'>iterates</span><span class='token pointer' id='tok-63-528'>each</span><span class='token pointer' id='tok-63-529'>of</span><span class='token pointer' id='tok-63-530'>our</span><span class='token pointer' id='tok-63-531'>provided</span><span class='token pointer' id='tok-63-532'>bytes</span><span class='token pointer' id='tok-63-533'>thus</span><span class='token pointer' id='tok-63-534'>it</span><span class='token pointer' id='tok-63-535'>will</span><span class='token pointer' id='tok-63-536'>corrupt</span><span class='token pointer' id='tok-63-537'>any</span><span class='token pointer' id='tok-63-538'>non-alpha</span><span class='token pointer' id='tok-63-539'>uppercase</span><span class='token pointer' id='tok-63-540'>shellcode.</span></p>
<p id=p541><span class='token pointer' id='tok-63-541'>So,</span><span class='token pointer' id='tok-63-542'>let's</span><span class='token pointer' id='tok-63-543'>start</span><span class='token pointer' id='tok-63-544'>with</span><span class='token pointer' id='tok-63-545'>fuzzing</span><span class='token pointer' id='tok-63-546'>the</span><span class='token pointer' id='tok-63-547'>application</span><span class='token pointer' id='tok-63-548'>and</span><span class='token pointer' id='tok-63-549'>figuring</span><span class='token pointer' id='tok-63-550'>out</span><span class='token pointer' id='tok-63-551'>the</span><span class='token pointer' id='tok-63-552'>offset</span><span class='token pointer' id='tok-63-553'>to</span><span class='token pointer' id='tok-63-554'>EIP.</span><span class='token pointer' id='tok-63-555'>First,</span><span class='token pointer' id='tok-63-556'>we</span><span class='token pointer' id='tok-63-557'>use</span><span class='token pointer' id='tok-63-558'>Python's</span><span class='token pointer' id='tok-63-559'>pwntools</span><span class='token pointer' id='tok-63-560'>library</span><span class='token pointer' id='tok-63-561'>for</span><span class='token pointer' id='tok-63-562'>generating</span><span class='token pointer' id='tok-63-563'>a</span><span class='token pointer' id='tok-63-564'>cyclic</span><span class='token pointer' id='tok-63-565'>pattern</span><span class='token pointer' id='tok-63-566'>and</span><span class='token pointer' id='tok-63-567'>end</span><span class='token pointer' id='tok-63-568'>up</span><span class='token pointer' id='tok-63-569'>with</span><span class='token pointer' id='tok-63-570'>following</span><span class='token pointer' id='tok-63-571'>snippet</span><span class='token pointer' id='tok-63-572'>of</span><span class='token pointer' id='tok-63-573'>code.</span></p>
<p id=p574><span class='token pointer' id='tok-63-574'>An</span><span class='token pointer' id='tok-63-575'>observant</span><span class='token pointer' id='tok-63-576'>user</span><span class='token pointer' id='tok-63-577'>must</span><span class='token pointer' id='tok-63-578'>have</span><span class='token pointer' id='tok-63-579'>noticed</span><span class='token pointer' id='tok-63-580'>that</span><span class='token pointer' id='tok-63-581'>application</span><span class='token pointer' id='tok-63-582'>is</span><span class='token pointer' id='tok-63-583'>using</span><span class='token pointer' id='tok-63-584'>forking</span><span class='token pointer' id='tok-63-585'>technique</span><span class='token pointer' id='tok-63-586'>to</span><span class='token pointer' id='tok-63-587'>serve</span><span class='token pointer' id='tok-63-588'>connections</span><span class='token pointer' id='tok-63-589'>thus</span><span class='token pointer' id='tok-63-590'>debugging</span><span class='token pointer' id='tok-63-591'>using</span><span class='token pointer' id='tok-63-592'>process</span><span class='token pointer' id='tok-63-593'>id</span><span class='token pointer' id='tok-63-594'>will</span><span class='token pointer' id='tok-63-595'>not</span><span class='token pointer' id='tok-63-596'>work</span><span class='token pointer' id='tok-63-597'>for</span><span class='token pointer' id='tok-63-598'>runtime</span><span class='token pointer' id='tok-63-599'>analysis.</span><span class='token pointer' id='tok-63-600'>Therefore,</span><span class='token pointer' id='tok-63-601'>we</span><span class='token pointer' id='tok-63-602'>need</span><span class='token pointer' id='tok-63-603'>to</span><span class='token pointer' id='tok-63-604'>debug</span><span class='token pointer' id='tok-63-605'>child</span><span class='token pointer' id='tok-63-606'>process.</span><span class='token pointer' id='tok-63-607'>We</span><span class='token pointer' id='tok-63-608'>placed</span><span class='token pointer' id='tok-63-609'>a</span><span class='token pointer' id='tok-63-610'>breakpoint</span><span class='token pointer' id='tok-63-611'>after</span><span class='token pointer' id='tok-63-612'>strdup</span><span class='token pointer' id='tok-63-613'>(0x0804982a)</span><span class='token pointer' id='tok-63-614'>and</span><span class='token pointer' id='tok-63-615'>started</span><span class='token pointer' id='tok-63-616'>analyzing</span><span class='token pointer' id='tok-63-617'>the</span><span class='token pointer' id='tok-63-618'>state</span><span class='token pointer' id='tok-63-619'>of</span><span class='token pointer' id='tok-63-620'>the</span><span class='token pointer' id='tok-63-621'>process.</span></p>
<p id=p622><span class='token pointer' id='tok-63-622'>As</span><span class='token pointer' id='tok-63-623'>we</span><span class='token pointer' id='tok-63-624'>will</span><span class='token pointer' id='tok-63-625'>need</span><span class='token pointer' id='tok-63-626'>to</span><span class='token pointer' id='tok-63-627'>debug</span><span class='token pointer' id='tok-63-628'>the</span><span class='token pointer' id='tok-63-629'>same</span><span class='token pointer' id='tok-63-630'>process</span><span class='token pointer' id='tok-63-631'>multiple</span><span class='token pointer' id='tok-63-632'>times</span><span class='token pointer' id='tok-63-633'>so</span><span class='token pointer' id='tok-63-634'>it</span><span class='token pointer' id='tok-63-635'>will</span><span class='token pointer' id='tok-63-636'>be</span><span class='token pointer' id='tok-63-637'>a</span><span class='token pointer' id='tok-63-638'>bit</span><span class='token pointer' id='tok-63-639'>painful</span><span class='token pointer' id='tok-63-640'>to</span><span class='token pointer' id='tok-63-641'>set</span><span class='token pointer' id='tok-63-642'>gdb</span><span class='token pointer' id='tok-63-643'>commands</span><span class='token pointer' id='tok-63-644'>every</span><span class='token pointer' id='tok-63-645'>time,</span><span class='token pointer' id='tok-63-646'>therefore</span><span class='token pointer' id='tok-63-647'>we</span><span class='token pointer' id='tok-63-648'>will</span><span class='token pointer' id='tok-63-649'>be</span><span class='token pointer' id='tok-63-650'>using</span><span class='token pointer' id='tok-63-651'>the</span><span class='token pointer' id='tok-63-652'>.gdbinit</span><span class='token pointer' id='tok-63-653'>file</span><span class='token pointer' id='tok-63-654'>for</span><span class='token pointer' id='tok-63-655'>the</span><span class='token pointer' id='tok-63-656'>sake</span><span class='token pointer' id='tok-63-657'>of</span><span class='token pointer' id='tok-63-658'>automation.</span></p>
<p id=p659><span class='token pointer' id='tok-63-659'>After</span><span class='token pointer' id='tok-63-660'>editing</span><span class='token pointer' id='tok-63-661'>the</span><span class='token pointer' id='tok-63-662'>.gdbinit</span><span class='token pointer' id='tok-63-663'>file</span><span class='token pointer' id='tok-63-664'>and</span><span class='token pointer' id='tok-63-665'>sending</span><span class='token pointer' id='tok-63-666'>our</span><span class='token pointer' id='tok-63-667'>fuzz</span><span class='token pointer' id='tok-63-668'>string</span><span class='token pointer' id='tok-63-669'>we</span><span class='token pointer' id='tok-63-670'>got</span><span class='token pointer' id='tok-63-671'>an</span><span class='token pointer' id='tok-63-672'>$eip</span><span class='token pointer' id='tok-63-673'>overwrite</span><span class='token pointer' id='tok-63-674'>at</span><span class='token pointer' id='tok-63-675'>0x46414149,</span><span class='token pointer' id='tok-63-676'>our</span><span class='token pointer' id='tok-63-677'>input</span><span class='token pointer' id='tok-63-678'>is</span><span class='token pointer' id='tok-63-679'>placed</span><span class='token pointer' id='tok-63-680'>on</span><span class='token pointer' id='tok-63-681'>the</span><span class='token pointer' id='tok-63-682'>stack</span><span class='token pointer' id='tok-63-683'>and</span><span class='token pointer' id='tok-63-684'>$eax</span><span class='token pointer' id='tok-63-685'>points</span><span class='token pointer' id='tok-63-686'>to</span><span class='token pointer' id='tok-63-687'>some</span><span class='token pointer' id='tok-63-688'>part</span><span class='token pointer' id='tok-63-689'>of</span><span class='token pointer' id='tok-63-690'>our</span><span class='token pointer' id='tok-63-691'>shellcode</span><span class='token pointer' id='tok-63-692'>mainly</span><span class='token pointer' id='tok-63-693'>from</span><span class='token pointer' id='tok-63-694'>the</span><span class='token pointer' id='tok-63-695'>start</span><span class='token pointer' id='tok-63-696'>because</span><span class='token pointer' id='tok-63-697'>of</span><span class='token pointer' id='tok-63-698'>strdup()</span><span class='token pointer' id='tok-63-699'>function</span><span class='token pointer' id='tok-63-700'>which</span><span class='token pointer' id='tok-63-701'>returns</span><span class='token pointer' id='tok-63-702'>in</span><span class='token pointer' id='tok-63-703'>$eax.</span><span class='token pointer' id='tok-63-704'>We</span><span class='token pointer' id='tok-63-705'>further</span><span class='token pointer' id='tok-63-706'>used</span><span class='token pointer' id='tok-63-707'>cyclic_find</span><span class='token pointer' id='tok-63-708'>function</span><span class='token pointer' id='tok-63-709'>from</span><span class='token pointer' id='tok-63-710'>pwntools</span><span class='token pointer' id='tok-63-711'>to</span><span class='token pointer' id='tok-63-712'>get</span><span class='token pointer' id='tok-63-713'>offset</span><span class='token pointer' id='tok-63-714'>to</span><span class='token pointer' id='tok-63-715'>$eip</span><span class='token pointer' id='tok-63-716'>at</span><span class='token pointer' id='tok-63-717'>532.</span></p>
<p id=p718><span class='token pointer' id='tok-63-718'>Ethical</span><span class='token pointer' id='tok-63-719'>Hacking</span><span class='token pointer' id='tok-63-720'>Training</span><span class='token pointer' id='tok-63-721'>â€“</span><span class='token pointer' id='tok-63-722'>Resources</span><span class='token pointer' id='tok-63-723'>(InfoSec)</span></p>
<p id=p724><span class='token pointer' id='tok-63-724'>Now</span><span class='token pointer' id='tok-63-725'>there</span><span class='token pointer' id='tok-63-726'>are</span><span class='token pointer' id='tok-63-727'>multiple</span><span class='token pointer' id='tok-63-728'>options</span><span class='token pointer' id='tok-63-729'>for</span><span class='token pointer' id='tok-63-730'>writing</span><span class='token pointer' id='tok-63-731'>exploit</span><span class='token pointer' id='tok-63-732'>for</span><span class='token pointer' id='tok-63-733'>this</span><span class='token pointer' id='tok-63-734'>program:</span></p>
<p id=p735><span class='token pointer' id='tok-63-735'>Return</span><span class='token pointer' id='tok-63-736'>to</span><span class='token pointer' id='tok-63-737'>register:</span><span class='token pointer' id='tok-63-738'>call</span><span class='token pointer' id='tok-63-739'>eax</span><span class='token pointer' id='tok-63-740'>(required</span><span class='token pointer' id='tok-63-741'>Alpha</span><span class='token pointer' id='tok-63-742'>upper</span><span class='token pointer' id='tok-63-743'>shellcode)Jump</span><span class='token pointer' id='tok-63-744'>to</span><span class='token pointer' id='tok-63-745'>stack:</span><span class='token pointer' id='tok-63-746'>At</span><span class='token pointer' id='tok-63-747'>the</span><span class='token pointer' id='tok-63-748'>time</span><span class='token pointer' id='tok-63-749'>of</span><span class='token pointer' id='tok-63-750'>the</span><span class='token pointer' id='tok-63-751'>crash,</span><span class='token pointer' id='tok-63-752'>no</span><span class='token pointer' id='tok-63-753'>pointers</span><span class='token pointer' id='tok-63-754'>to</span><span class='token pointer' id='tok-63-755'>our</span><span class='token pointer' id='tok-63-756'>shellcode</span><span class='token pointer' id='tok-63-757'>were</span><span class='token pointer' id='tok-63-758'>present</span><span class='token pointer' id='tok-63-759'>on</span><span class='token pointer' id='tok-63-760'>the</span><span class='token pointer' id='tok-63-761'>stack</span><span class='token pointer' id='tok-63-762'>we</span><span class='token pointer' id='tok-63-763'>need</span><span class='token pointer' id='tok-63-764'>to</span><span class='token pointer' id='tok-63-765'>rely</span><span class='token pointer' id='tok-63-766'>on</span><span class='token pointer' id='tok-63-767'>the</span><span class='token pointer' id='tok-63-768'>hardcoded</span><span class='token pointer' id='tok-63-769'>address</span><span class='token pointer' id='tok-63-770'>(Not</span><span class='token pointer' id='tok-63-771'>a</span><span class='token pointer' id='tok-63-772'>reliable</span><span class='token pointer' id='tok-63-773'>way).</span><span class='token pointer' id='tok-63-774'>Also,</span><span class='token pointer' id='tok-63-775'>we</span><span class='token pointer' id='tok-63-776'>do</span><span class='token pointer' id='tok-63-777'>not</span><span class='token pointer' id='tok-63-778'>need</span><span class='token pointer' id='tok-63-779'>alphanumeric</span><span class='token pointer' id='tok-63-780'>shellcode</span><span class='token pointer' id='tok-63-781'>in</span><span class='token pointer' id='tok-63-782'>this</span><span class='token pointer' id='tok-63-783'>case</span><span class='token pointer' id='tok-63-784'>as</span><span class='token pointer' id='tok-63-785'>gets</span><span class='token pointer' id='tok-63-786'>will</span><span class='token pointer' id='tok-63-787'>copying</span><span class='token pointer' id='tok-63-788'>our</span><span class='token pointer' id='tok-63-789'>input</span><span class='token pointer' id='tok-63-790'>into</span><span class='token pointer' id='tok-63-791'>buffer</span><span class='token pointer' id='tok-63-792'>after</span><span class='token pointer' id='tok-63-793'>it</span><span class='token pointer' id='tok-63-794'>meets</span><span class='token pointer' id='tok-63-795'>a</span><span class='token pointer' id='tok-63-796'>null</span><span class='token pointer' id='tok-63-797'>bytes</span><span class='token pointer' id='tok-63-798'>(\x00).ROP</span><span class='token pointer' id='tok-63-799'>Chain</span><span class='token pointer' id='tok-63-800'>via</span><span class='token pointer' id='tok-63-801'>ret2libc:</span><span class='token pointer' id='tok-63-802'>As</span><span class='token pointer' id='tok-63-803'>there</span><span class='token pointer' id='tok-63-804'>is</span><span class='token pointer' id='tok-63-805'>no</span><span class='token pointer' id='tok-63-806'>ASLR</span><span class='token pointer' id='tok-63-807'>enabled</span><span class='token pointer' id='tok-63-808'>on</span><span class='token pointer' id='tok-63-809'>the</span><span class='token pointer' id='tok-63-810'>system</span><span class='token pointer' id='tok-63-811'>we</span><span class='token pointer' id='tok-63-812'>can</span><span class='token pointer' id='tok-63-813'>rely</span><span class='token pointer' id='tok-63-814'>on</span><span class='token pointer' id='tok-63-815'>the</span><span class='token pointer' id='tok-63-816'>PLT</span><span class='token pointer' id='tok-63-817'>address</span><span class='token pointer' id='tok-63-818'>from</span><span class='token pointer' id='tok-63-819'>the</span><span class='token pointer' id='tok-63-820'>executable</span><span class='token pointer' id='tok-63-821'>itself</span><span class='token pointer' id='tok-63-822'>construct</span><span class='token pointer' id='tok-63-823'>a</span><span class='token pointer' id='tok-63-824'>simple</span><span class='token pointer' id='tok-63-825'>ROP</span><span class='token pointer' id='tok-63-826'>chain.</span><span class='token pointer' id='tok-63-827'>(Reliable</span><span class='token pointer' id='tok-63-828'>unless</span><span class='token pointer' id='tok-63-829'>ASLR</span><span class='token pointer' id='tok-63-830'>is</span><span class='token pointer' id='tok-63-831'>enabled</span><span class='token pointer' id='tok-63-832'>even</span><span class='token pointer' id='tok-63-833'>in</span><span class='token pointer' id='tok-63-834'>that</span><span class='token pointer' id='tok-63-835'>case</span><span class='token pointer' id='tok-63-836'>we</span><span class='token pointer' id='tok-63-837'>need</span><span class='token pointer' id='tok-63-838'>to</span><span class='token pointer' id='tok-63-839'>modify</span><span class='token pointer' id='tok-63-840'>our</span><span class='token pointer' id='tok-63-841'>shellcode</span><span class='token pointer' id='tok-63-842'>to</span><span class='token pointer' id='tok-63-843'>make</span><span class='token pointer' id='tok-63-844'>it</span><span class='token pointer' id='tok-63-845'>work</span><span class='token pointer' id='tok-63-846'>again</span><span class='token pointer' id='tok-63-847'>slightly)Our</span><span class='token pointer' id='tok-63-848'>ROP</span><span class='token pointer' id='tok-63-849'>chain</span><span class='token pointer' id='tok-63-850'>will</span><span class='token pointer' id='tok-63-851'>do</span><span class='token pointer' id='tok-63-852'>the</span><span class='token pointer' id='tok-63-853'>following:</span></p>
<p id=p854><span class='token pointer' id='tok-63-854'>Read</span><span class='token pointer' id='tok-63-855'>the</span><span class='token pointer' id='tok-63-856'>contents</span><span class='token pointer' id='tok-63-857'>of</span><span class='token pointer' id='tok-63-858'>system</span><span class='token pointer' id='tok-63-859'>command</span><span class='token pointer' id='tok-63-860'>in</span><span class='token pointer' id='tok-63-861'>.dynamic</span><span class='token pointer' id='tok-63-862'>section.Pass</span><span class='token pointer' id='tok-63-863'>the</span><span class='token pointer' id='tok-63-864'>pointer</span><span class='token pointer' id='tok-63-865'>of</span><span class='token pointer' id='tok-63-866'>.dynamic</span><span class='token pointer' id='tok-63-867'>to</span><span class='token pointer' id='tok-63-868'>execve.</span></p>
<p id=p869><span class='token pointer' id='tok-63-869'>As</span><span class='token pointer' id='tok-63-870'>we</span><span class='token pointer' id='tok-63-871'>see</span><span class='token pointer' id='tok-63-872'>in</span><span class='token pointer' id='tok-63-873'>the</span><span class='token pointer' id='tok-63-874'>following</span><span class='token pointer' id='tok-63-875'>screenshot,</span><span class='token pointer' id='tok-63-876'>we</span><span class='token pointer' id='tok-63-877'>were</span><span class='token pointer' id='tok-63-878'>able</span><span class='token pointer' id='tok-63-879'>to</span><span class='token pointer' id='tok-63-880'>obtain</span><span class='token pointer' id='tok-63-881'>remote</span><span class='token pointer' id='tok-63-882'>shell</span><span class='token pointer' id='tok-63-883'>by</span><span class='token pointer' id='tok-63-884'>exploiting</span><span class='token pointer' id='tok-63-885'>final0</span><span class='token pointer' id='tok-63-886'>binary.</span></p>
<p id=p887><span class='token pointer' id='tok-63-887'></span><span class='token pointer' id='tok-63-888'></span><span class='token pointer' id='tok-63-889'></span><span class='token pointer' id='tok-63-890'>