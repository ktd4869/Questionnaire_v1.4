<p id=p0>From security cameras to traffic lights, an increasing amount of appliances we interact with on a daily basis are <span class='token pointer' id='tok-40-0' style='color:red'>internet connected.</span>device can be considered <span class='token pointer' id='tok-40-1' style='color:red'>IoT-enabled</span>when the <span class='token pointer' id='tok-40-2' style='color:red'>functionality</span>offered by its <span class='token pointer' id='tok-40-3' style='color:red'>Embedded System</span>exposed through an <span class='token pointer' id='tok-40-4' style='color:red'>API.</span></p><p id=p42><span class='token pointer' id='tok-40-5' style='color:red'>Internet-of-Things</span>technologies inherit many <span class='token pointer' id='tok-40-6' style='color:red'>attack vectors</span>appear in other <span class='token pointer' id='tok-40-7' style='color:red'>internet connected devices,</span>the <span class='token pointer' id='tok-40-8' style='color:red'>low-powered</span>hardware-centric nature of <span class='token pointer' id='tok-40-9' style='color:red'>embedded systems</span>them with unique security threats. Engineers building Internet-of-Things <span class='token pointer' id='tok-40-10' style='color:red'>devices</span>must take additional precautions to ensure they do not implement security <span class='token pointer' id='tok-40-11' style='color:red'>anti-patterns</span>when addressing new problems, this blog post will investigate four such anti-patterns that have been used by real Internet-of-Things devices. </p><p id=p105><span class='token pointer' id='tok-40-12' style='color:red'>Atmel ATMEGA8 Microcontroller</span>Commons - CC BY-SA 3.0 </p><p id=p114><span class='token pointer' id='tok-40-13' style='color:red'>HTTP Pub/SubEvery</span>your IoT-enabled alarm clock sounds, you may want it to tell your coffee machine to brew some coffee. In order to do this, your coffee machine may subscribe to messages published by your alarm clock. One such way of doing this is to implement the <span class='token pointer' id='tok-40-14' style='color:red'>Publish/Subscribe Pattern</span>the API of the <span class='token pointer' id='tok-40-15' style='color:red'>IoT</span>devices, for this example let's assume our alarm clock and coffee machine communicate through <span class='token pointer' id='tok-40-16' style='color:red'>HTTP.</span></p><p id=p185>In order to subscribe to messages from the alarm clock, the coffee machine sends a HTTP POST request to https://alarmclock/publish with the following body: </p><p id=p209>{"on":"alarmSound", "to":"https://coffeemachine/subscribe"} </p><p id=p211>This <span class='token pointer' id='tok-40-17' style='color:red'>JSON</span>request instructs the alarm clock on every "alarmSound" event to send a HTTP request to the coffee machine. Whilst this may seem a simple and effective way of <span class='token pointer' id='tok-40-18' style='color:red'>implementing</span>the Pub/Sub pattern in HTTP, this poses a significant </p><p id=p253>By not being able to validate if the receiver of the subscribed message wants the message or not, there is effectively a <span class='token pointer' id='tok-40-19' style='color:red'>DDOS</span>vulnerability. An attacker with the ability to set subscriptions on the alarm clock can effectively send HTTP messages to any device or <span class='token pointer' id='tok-40-20' style='color:red'>internet</span>property they want. If this is done across enough devices, a DDOS vulnerability is created. </p><p id=p314>Toast popping out of a toaster or a car driving across a road traffic sensor could be the trigger of a future large scale DDOS against a </p><p id=p343>For further reading, the limitation of Pub/Sub patterns in IoT within the context of the <span class='token pointer' id='tok-40-21' style='color:red'>MQTT</span>protocol are discussed in: Limitations of the Pub/Sub pattern for cloud based IoT and their implications - Happ, D. and Wolisz, A. (2016). </p><p id=p382>IoT Device <span class='token pointer' id='tok-40-22' style='color:red'>TLS ServerAs the</span>systems which power IoT devices have gained additional computational resources, more and more IoT <span class='token pointer' id='tok-40-23' style='color:red'>developers</span>have chosen to implement <span class='token pointer' id='tok-40-24' style='color:red'>TLS</span>to secure communications. Additionally <span class='token pointer' id='tok-40-25' style='color:red'>cryptography</span>libraries such <span class='token pointer' id='tok-40-26' style='color:red'>wolfSSL</span><span class='token pointer' id='tok-40-27' style='color:red'>as</span><span class='token pointer' id='tok-40-28' style='color:red'>mbedTLS,</span>better suited to the performance requirements for embedded systems, have removed many of the engineering and performance complexities of adding TLS support to embedded systems. </p><p id=p445>One anti-pattern in implementing TLS on IoT devices is running devices themselves as <span class='token pointer' id='tok-40-29' style='color:red'>web servers</span>using <span class='token pointer' id='tok-40-30' style='color:red'>self-signed</span><span class='token pointer' id='tok-40-31' style='color:red'>server-side certificates</span><span class='token pointer' id='tok-40-32' style='color:red'>encrypt</span>such requests. Aside from the performance overhead of running web servers on embedded systems, they also pose a severe security risk by failing to maintain </p><p id=p494>In place of this; IoT devices can communicate through <span class='token pointer' id='tok-40-33' style='color:red'>brokers;</span>such brokers can act as web servers with a signed TLS certificates installed server-side which can be <span class='token pointer' id='tok-40-34' style='color:red'>authenticated</span>with devices using <span class='token pointer' id='tok-40-35' style='color:red'>X.509 standard.</span>can be done effectively by simply using the HTTP protocol. Like other kinds of message brokers, they will receive messages, perform <span class='token pointer' id='tok-40-36' style='color:red'>validation,</span><span class='token pointer' id='tok-40-37' style='color:red'>transformation</span>and <span class='token pointer' id='tok-40-38' style='color:red'>routing</span>before sending them on by recipients. </p><p id=p560><span class='token pointer' id='tok-40-39' style='color:red'>Protocols</span>like <span class='token pointer' id='tok-40-40' style='color:red'>CoAP</span>are specifically designed for brokerless Machine-to-Machine communication in low power environments, in its current form CoAP uses <span class='token pointer' id='tok-40-41' style='color:red'>DTLS</span><span class='token pointer' id='tok-40-42' style='color:red'>(RFC 4347)</span>supports <span class='token pointer' id='tok-40-43' style='color:red'>pre-shared keys,</span></p><p id=p594><span class='token pointer' id='tok-40-44' style='color:red'>Unencrypted</span>BootloaderFar from being in a datacenter, IoT devices can be left in insecure environments - as such extra precautions need to be taken to protect the memory on such a device. </p><p id=p626>Take the example of an IoT traffic counting device, installed in a locked cabinet at a roadside. A <span class='token pointer' id='tok-40-45' style='color:red'>malicious</span>adversary can break into the cabinet and steal the device with physical force. With the device in their possession they can extract <span class='token pointer' id='tok-40-46' style='color:red'>software</span>from the embedded system chip on the device to obtain the software running on it. By <span class='token pointer' id='tok-40-47' style='color:red'>reverse engineering</span>software they can learn secrets in the memory of the onboard <span class='token pointer' id='tok-40-48' style='color:red'>microcontroller.</span></p><p id=p699>When IoT devices can contain sensitive data in memory, locking them away may not always be sufficient. One solution to this problem is to encrypt the bootloaders on such devices - this provides a degree of <span class='token pointer' id='tok-40-49' style='color:red'>cryptographic</span>assurance that the secrets on the device will remain secret. </p><p id=p746> Documentation from </p><p id=p753>There exists dedicated <span class='token pointer' id='tok-40-50' style='color:red'>integrated</span>Controller <span class='token pointer' id='tok-40-51' style='color:red'>chips</span>that allow for Hardware-based Key Storage at low cost; these chips can be used to prevent <span class='token pointer' id='tok-40-52' style='color:red'>cloning</span>and tampering of Embedded Systems. Examples include <span class='token pointer' id='tok-40-53' style='color:red'>CryptoAuthentication</span><span class='token pointer' id='tok-40-54' style='color:red'>Atmel's</span>and </p><p id=p791>Other precautions should of course be taken, ensuring that keys are unique to a device and that revocation systems are in place, should keys be disclosed for whatever reason. </p><p id=p820>It is not merely enough to leave your secrets <span class='token pointer' id='tok-40-55' style='color:red'>unencrypted</span>on an embedded system in the hope no one will attempt to reverse engineer it. Taking appropriate security steps for the secrets your IoT device will store is vital. </p><p id=p859><span class='token pointer' id='tok-40-56' style='color:red'>Database-as-IPCInstead</span>of communicating over an <span class='token pointer' id='tok-40-57' style='color:red'>abstract protocol</span>HTTP, developers may choose to use shortcuts by simply directly connecting to a <span class='token pointer' id='tok-40-58' style='color:red'>database</span>server to push data. Aside from being making permissions control harder, this opens up performance difficulties. </p><p id=p897>Lock <span class='token pointer' id='tok-40-59' style='color:red'>contention</span>is one such issue, when running UPDATE <span class='token pointer' id='tok-40-60' style='color:red'>queries</span>on rows other devices will end up waiting for locks on the database to be released before other queries can be done. Additionally, polling databases for changes can lead to IoT brokers becoming easily overloaded. </p><p id=p942>This <span class='token pointer' id='tok-40-61' style='color:red'>Anti-Pattern</span>can be mitigated by using a <span class='token pointer' id='tok-40-62' style='color:red'>message broker service,</span>by a HTTP API. <span class='token pointer' id='tok-40-63' style='color:red'>REST APIs</span>easier to <span class='token pointer' id='tok-40-64' style='color:red'>cache,</span>easier to scale and allow you to vary your database implementation independently of your API. </p><p id=p979>No matter how closed you think the usage of your IoT API is, take pride in it and seek to make it resilient to the forces of change later on. <span class='token pointer' id='tok-40-65' style='color:red'>Abstracting</span>your database away from your devices allows you to introduce a greater degree of security and also prevents other architectural headaches later on. </p><p id=p1033>As the technology that powers the internet matures, so will the attacks it faces. IoT devices are set to see a unique set of <span class='token pointer' id='tok-40-66' style='color:red'>security vulnerabilities,</span>to the set seen by other internet connected devices. As more IoT devices start to be unveiled, new security challenges will also unfold.
 </p>