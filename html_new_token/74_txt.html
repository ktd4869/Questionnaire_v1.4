<p id=p0><span id='tok'>In</span><span id='tok'>this</span><span id='tok'>article,</span><span id='tok'>we</span><span id='tok'>will</span><span id='tok'>a</span><span id='tok'>have</span><span id='tok'>a</span><span id='tok'>look</span><span id='tok'>at</span><span class='token pointer' id='tok-74-0' style='color:red'>automating</span><span id='tok'>certain</span><span id='tok'>tasks</span><span id='tok'>on</span><span id='tok'>windows</span><span id='tok'>to</span><span class='token pointer' id='tok-74-1' style='color:red'>escalate</span><span id='tok'>our</span><span class='token pointer' id='tok-74-2' style='color:red'>privileges</span><span id='tok'>and</span><span id='tok'>gain</span><span class='token pointer' id='tok-74-3' style='color:red'>access</span><span id='tok'>to</span><span id='tok'>the</span><span class='token pointer' id='tok-74-4' style='color:red'>system.</span></p><p id=p25><span id='tok'>Introduction:</span><span class='token pointer' id='tok-74-5' style='color:red'>Privilege</span><span class='token pointer' id='tok-74-6' style='color:red'>Escalation</span><span id='tok'>on</span><span id='tok'>any</span><span id='tok'>system</span><span id='tok'>mainly</span><span id='tok'>involves</span><span id='tok'>a</span><span id='tok'>lot</span><span id='tok'>of</span><span id='tok'>information</span><span id='tok'>gathering</span><span id='tok'>about</span><span id='tok'>the</span><span class='token pointer' id='tok-74-7' style='color:red'>host</span><span class='token pointer' id='tok-74-8' style='color:red'>target</span><span class='token pointer' id='tok-74-9' style='color:red'>further</span><span id='tok'>includes</span><span id='tok'>some</span><span id='tok'>of</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>set</span><span id='tok'>of</span><span id='tok'>questions</span><span id='tok'>that</span><span id='tok'>a</span><span class='token pointer' id='tok-74-10' style='color:red'>penetration</span><span class='token pointer' id='tok-74-11' style='color:red'>tester</span><span id='tok'>needs</span><span id='tok'>to</span><span id='tok'>cover:</span></p><p id=p59><span id='tok'>What</span><span class='token pointer' id='tok-74-12' style='color:red'>version</span><span id='tok'>of</span><span class='token pointer' id='tok-74-13' style='color:red'>operating</span><span id='tok'>system</span><span id='tok'>is</span><span id='tok'>being</span><span class='token pointer' id='tok-74-14' style='color:red'>installed</span><span id='tok'>on</span><span id='tok'>the</span><span class='token pointer' id='tok-74-15' style='color:red'>host?Is</span><span id='tok'>there</span><span id='tok'>any</span><span class='token pointer' id='tok-74-16' style='color:red'>vulnerable</span><span class='token pointer' id='tok-74-17' style='color:red'>package</span><span id='tok'>installed</span><span id='tok'>or</span><span class='token pointer' id='tok-74-18' style='color:red'>running?</span><span id='tok'>What</span><span id='tok'>type</span><span id='tok'>of</span><span class='token pointer' id='tok-74-19' style='color:red'>services</span><span id='tok'>are</span><span id='tok'>running</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>system</span><span id='tok'>and</span><span id='tok'>whether</span><span id='tok'>they</span><span id='tok'>are</span><span class='token pointer' id='tok-74-20' style='color:red'>configured</span><span id='tok'>properly</span><span id='tok'>or</span><span id='tok'>not</span><span id='tok'>from</span><span id='tok'>the</span><span class='token pointer' id='tok-74-21' style='color:red'>security</span><span id='tok'>point</span><span id='tok'>of</span><span id='tok'>view?</span><span id='tok'>How</span><span id='tok'>the</span><span class='token pointer' id='tok-74-22' style='color:red'>user</span><span id='tok'>roles</span><span id='tok'>are</span><span id='tok'>being</span><span class='token pointer' id='tok-74-23' style='color:red'>segregated?How</span><span id='tok'>the</span><span class='token pointer' id='tok-74-24' style='color:red'>permissions</span><span class='token pointer' id='tok-74-25' style='color:red'>file system</span><span id='tok'>being</span><span id='tok'>assigned</span><span id='tok'>to</span><span id='tok'>different</span><span class='token pointer' id='tok-74-26' style='color:red'>user roles?Is</span><span id='tok'>is</span><span id='tok'>any</span><span class='token pointer' id='tok-74-27' style='color:red'>configuration/password</span><span id='tok'>files</span><span id='tok'>stored</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>system?</span><span id='tok'>Is</span><span id='tok'>there</span><span id='tok'>any</span><span class='token pointer' id='tok-74-28' style='color:red'>misconfigured</span><span class='token pointer' id='tok-74-29' style='color:red'>CRON</span><span id='tok'>jobs/Scheduled</span><span id='tok'>Tasks</span><span id='tok'>running</span><span id='tok'>on</span><span id='tok'>the</span><span class='token pointer' id='tok-74-30' style='color:red'>system?By</span><span id='tok'>answering</span><span id='tok'>above</span><span id='tok'>and</span><span id='tok'>many</span><span id='tok'>other</span><span id='tok'>questions</span><span id='tok'>depending</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>situations</span><span id='tok'>and</span><span id='tok'>availability</span><span id='tok'>one</span><span id='tok'>can</span><span id='tok'>certainly</span><span id='tok'>escalate</span><span id='tok'>his/her</span><span id='tok'>privileges</span><span id='tok'>from</span><span id='tok'>a</span><span class='token pointer' id='tok-74-31' style='color:red'>normal user</span><span class='token pointer' id='tok-74-32' style='color:red'>privileged</span><span class='token pointer' id='tok-74-33' style='color:red'>high</span><span id='tok'>As</span><span id='tok'>we</span><span id='tok'>can</span><span id='tok'>see,</span><span id='tok'>there</span><span id='tok'>is</span><span id='tok'>a</span><span id='tok'>lot</span><span id='tok'>of</span><span id='tok'>information</span><span id='tok'>one</span><span id='tok'>needs</span><span id='tok'>to</span><span id='tok'>gather</span><span id='tok'>which</span><span id='tok'>directly</span><span id='tok'>means</span><span id='tok'>there</span><span id='tok'>are</span><span id='tok'>a</span><span id='tok'>lot</span><span id='tok'>of</span><span id='tok'>manual</span><span id='tok'>checks</span><span id='tok'>we</span><span id='tok'>need</span><span id='tok'>to</span><span id='tok'>perform</span><span id='tok'>to</span><span id='tok'>escalate</span><span id='tok'>our</span><span id='tok'>privileges</span><span id='tok'>successfully.</span><span id='tok'>So,</span><span id='tok'>automating</span><span id='tok'>certain</span><span id='tok'>tasks</span><span id='tok'>will</span><span id='tok'>save</span><span id='tok'>some</span><span id='tok'>time</span><span id='tok'>and</span><span id='tok'>give</span><span id='tok'>an</span><span id='tok'>added</span><span id='tok'>advantage</span><span id='tok'>to</span><span id='tok'>any</span><span id='tok'>penetration</span><span id='tok'>tester.</span></p><p id=p214><span id='tok'>The</span><span class='token pointer' id='tok-74-34' style='color:red'>test bed/software</span><span id='tok'>to</span><span id='tok'>test</span><span id='tok'>our</span><span class='token pointer' id='tok-74-35' style='color:red'>tool</span><span id='tok'>can</span><span id='tok'>be</span><span class='token pointer' id='tok-74-36' style='color:red'>downloaded</span><span id='tok'>from</span><span id='tok'>here.</span><span id='tok'>Also,</span><span id='tok'>the</span><span id='tok'>required</span><span id='tok'>package</span><span id='tok'>for</span><span class='token pointer' id='tok-74-37' style='color:red'>python</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>installed</span><span id='tok'>using</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>command:</span></p><p id=p240><span class='token pointer' id='tok-74-38' style='color:red'>pip</span><span class='token pointer' id='tok-74-39' style='color:red'>install</span><span class='token pointer' id='tok-74-40' style='color:red'>wmi</span></p><p id=p243><span class='token pointer' id='tok-74-41' style='color:red'>We</span><span id='tok'>will</span><span id='tok'>be</span><span id='tok'>automating</span><span id='tok'>following</span><span id='tok'>tasks</span><span id='tok'>using</span><span class='token pointer' id='tok-74-42' style='color:red'>Python</span></p><p id=p253><span id='tok'>Unquoted</span><span id='tok'>Service</span><span class='token pointer' id='tok-74-43' style='color:red'>Paths.Misconfigured</span><span class='token pointer' id='tok-74-44' style='color:red'>Permission</span><span id='tok'>for</span><span id='tok'>Service</span><span class='token pointer' id='tok-74-45' style='color:red'>Executables.Misconfigured</span><span class='token pointer' id='tok-74-46' style='color:red'>MSI</span><span class='token pointer' id='tok-74-47' style='color:red'>registry</span><span id='tok'>entries.Unquoted</span><span id='tok'>Service</span><span id='tok'>Paths:Before</span><span id='tok'>proceeding</span><span id='tok'>with</span><span id='tok'>understanding</span><span id='tok'>the</span><span class='token pointer' id='tok-74-48' style='color:red'>code</span><span id='tok'>use</span><span id='tok'>to</span><span id='tok'>automate</span><span id='tok'>this</span><span id='tok'>task,</span><span id='tok'>we</span><span id='tok'>need</span><span id='tok'>to</span><span id='tok'>understand</span><span id='tok'>how</span><span id='tok'>we</span><span id='tok'>can</span><span class='token pointer' id='tok-74-49' style='color:red'>exploit</span><span class='token pointer' id='tok-74-50' style='color:red'>unquoted</span><span class='token pointer' id='tok-74-51' style='color:red'>service</span><span class='token pointer' id='tok-74-52' style='color:red'>path</span><span class='token pointer' id='tok-74-53' style='color:red'>vulnerabilities.</span><span id='tok'>This</span><span id='tok'>mainly</span><span id='tok'>involves</span><span id='tok'>how</span><span class='token pointer' id='tok-74-54' style='color:red'>Windows</span><span class='token pointer' id='tok-74-55' style='color:red'>interpret</span><span id='tok'>the</span><span class='token pointer' id='tok-74-56' style='color:red'>executable</span><span id='tok'>path</span><span id='tok'>of</span><span id='tok'>service</span><span id='tok'>before</span><span id='tok'>starting</span><span id='tok'>it.</span><span id='tok'>For</span><span id='tok'>example:</span></p><p id=p303><span id='tok'>Let</span><span id='tok'>us</span><span class='token pointer' id='tok-74-57' style='color:red'>execute</span><span id='tok'>a</span><span id='tok'>test</span><span class='token pointer' id='tok-74-58' style='color:red'>program/script</span><span id='tok'>using</span><span id='tok'>command</span><span id='tok'>prompt</span><span id='tok'>by</span><span id='tok'>providing</span><span id='tok'>a</span><span id='tok'>path</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>executable.</span></p><p id=p319><span id='tok'>As</span><span id='tok'>we</span><span id='tok'>can</span><span id='tok'>see</span><span id='tok'>that</span><span id='tok'>our</span><span class='token pointer' id='tok-74-59' style='color:red'>helloworld</span><span class='token pointer' id='tok-74-60' style='color:red'>program</span><span id='tok'>executes</span><span id='tok'>successfully</span><span id='tok'>when</span><span id='tok'>placed</span><span id='tok'>in</span><span id='tok'>a</span><span id='tok'>folder</span><span id='tok'>without</span><span id='tok'>space.</span><span id='tok'>So,</span><span id='tok'>what</span><span id='tok'>happen</span><span id='tok'>with</span><span id='tok'>a</span><span id='tok'>folder</span><span id='tok'>with</span><span id='tok'>space?</span></p><p id=p344><span id='tok'>As</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>seen,</span><span id='tok'>there</span><span id='tok'>is</span><span id='tok'>a</span><span class='token pointer' id='tok-74-61' style='color:red'>helloworld.exe</span><span id='tok'>file</span><span id='tok'>in</span><span id='tok'>the</span><span id='tok'>folder</span><span id='tok'>with</span><span id='tok'>space.</span><span id='tok'>So,</span><span id='tok'>to</span><span id='tok'>execute</span><span id='tok'>that</span><span id='tok'>we</span><span id='tok'>simply</span><span id='tok'>change</span><span id='tok'>our</span><span id='tok'>directory</span><span id='tok'>by</span><span id='tok'>providing</span><span id='tok'>quotes</span><span id='tok'>around</span><span id='tok'>folder</span><span id='tok'>name.</span><span id='tok'>Now</span><span id='tok'>the</span><span id='tok'>question</span><span id='tok'>arises</span><span id='tok'>how</span><span id='tok'>we</span><span id='tok'>can</span><span id='tok'>exploit</span><span id='tok'>this</span><span id='tok'>behavior</span><span id='tok'>of</span><span id='tok'>Windows.</span></p><p id=p385><span id='tok'>As</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>seen,</span><span id='tok'>in</span><span id='tok'>first</span><span id='tok'>image</span><span id='tok'>window</span><span id='tok'>treats</span><span id='tok'>the</span><span id='tok'>folder</span><span id='tok'>name</span><span id='tok'>with</span><span id='tok'>space</span><span id='tok'>as</span><span id='tok'>an</span><span id='tok'>executable</span><span id='tok'>and</span><span id='tok'>throws</span><span id='tok'>us</span><span id='tok'>an</span><span id='tok'>error</span><span id='tok'>saying</span><span id='tok'>"folder</span><span id='tok'>is</span><span id='tok'>not</span><span class='token pointer' id='tok-74-62' style='color:red'>recognized</span><span id='tok'>as</span><span id='tok'>internal</span><span id='tok'>or</span><span id='tok'>external</span><span class='token pointer' id='tok-74-63' style='color:red'>command/executable/batch</span><span id='tok'>file."</span><span id='tok'>So,</span><span id='tok'>this</span><span id='tok'>means</span><span id='tok'>if</span><span id='tok'>we</span><span id='tok'>put</span><span id='tok'>an</span><span id='tok'>executable</span><span id='tok'>with</span><span id='tok'>the</span><span id='tok'>name</span><span id='tok'>as</span><span class='token pointer' id='tok-74-64' style='color:red'>folder.exe</span><span id='tok'>it</span><span id='tok'>should</span><span id='tok'>get</span><span id='tok'>execute</span><span id='tok'>when</span><span id='tok'>the</span><span id='tok'>user</span><span id='tok'>calls</span><span id='tok'>the</span><span id='tok'>program</span><span id='tok'>path</span><span id='tok'>without</span><span id='tok'>spaces.</span></p><p id=p444><span id='tok'>We</span><span id='tok'>first</span><span id='tok'>tried</span><span id='tok'>to</span><span id='tok'>execute</span><span id='tok'>our</span><span id='tok'>program</span><span id='tok'>without</span><span id='tok'>space.</span><span id='tok'>Further,</span><span id='tok'>we</span><span id='tok'>copied</span><span id='tok'>the</span><span id='tok'>same</span><span id='tok'>program</span><span id='tok'>to</span><span id='tok'>desktop</span><span id='tok'>folder</span><span id='tok'>with</span><span id='tok'>name</span><span id='tok'>folder.exe</span><span id='tok'>and</span><span id='tok'>deleted</span><span id='tok'>our</span><span id='tok'>program</span><span id='tok'>from</span><span id='tok'>the</span><span id='tok'>older</span><span id='tok'>path</span><span id='tok'>to</span><span id='tok'>be</span><span id='tok'>sure</span><span id='tok'>only</span><span id='tok'>planted</span><span id='tok'>binary</span><span id='tok'>gets</span><span id='tok'>executed.</span></p><p id=p481><span id='tok'>Windows</span><span class='token pointer' id='tok-74-65' style='color:red'>now</span><span id='tok'>execute</span><span id='tok'>our</span><span id='tok'>binary</span><span id='tok'>planted</span><span id='tok'>with</span><span id='tok'>the</span><span id='tok'>name</span><span id='tok'>of</span><span id='tok'>folder.exe.</span></p><p id=p492><span id='tok'>So,</span><span id='tok'>we</span><span id='tok'>will</span><span id='tok'>be</span><span id='tok'>automating</span><span id='tok'>this</span><span id='tok'>process</span><span id='tok'>by</span><span id='tok'>telling</span><span id='tok'>our</span><span id='tok'>program</span><span id='tok'>to</span><span class='token pointer' id='tok-74-66' style='color:red'>iterate</span><span id='tok'>over</span><span id='tok'>the</span><span class='token pointer' id='tok-74-67' style='color:red'>service paths</span><span id='tok'>show</span><span id='tok'>us</span><span id='tok'>which</span><span id='tok'>service</span><span id='tok'>paths</span><span id='tok'>are</span><span id='tok'>unquoted.</span></p><p id=p517><span id='tok'>In</span><span id='tok'>our</span><span id='tok'>code,</span><span id='tok'>we</span><span id='tok'>first</span><span id='tok'>defined</span><span id='tok'>a</span><span id='tok'>WMI</span><span id='tok'>object,</span><span id='tok'>select</span><span id='tok'>everything</span><span id='tok'>from</span><span class='token pointer' id='tok-74-68' style='color:red'>Win32_Service</span><span id='tok'>class</span><span id='tok'>and</span><span id='tok'>iterate</span><span id='tok'>over</span><span id='tok'>it</span><span id='tok'>to</span><span id='tok'>get</span><span id='tok'>all</span><span id='tok'>service</span><span id='tok'>paths.</span><span id='tok'>We</span><span id='tok'>further</span><span id='tok'>check</span><span id='tok'>if</span><span id='tok'>the</span><span id='tok'>path</span><span id='tok'>does</span><span id='tok'>not</span><span id='tok'>contain</span><span id='tok'>any</span><span id='tok'>quotes</span><span id='tok'>if</span><span id='tok'>our</span><span id='tok'>condition</span><span id='tok'>satisfies</span><span id='tok'>we</span><span id='tok'>add</span><span id='tok'>that</span><span id='tok'>path</span><span id='tok'>to</span><span id='tok'>our</span><span id='tok'>dictionary</span><span id='tok'>by</span><span id='tok'>keeping</span><span id='tok'>service</span><span id='tok'>name</span><span id='tok'>as</span><span id='tok'>a</span><span id='tok'>key</span><span id='tok'>name.</span></p><p id=p570><span id='tok'>We</span><span id='tok'>further</span><span id='tok'>check</span><span id='tok'>if</span><span id='tok'>there</span><span id='tok'>are</span><span id='tok'>any</span><span id='tok'>service</span><span id='tok'>paths</span><span id='tok'>identified</span><span id='tok'>and</span><span id='tok'>iterate</span><span id='tok'>over</span><span id='tok'>our</span><span id='tok'>dictionary</span><span id='tok'>to</span><span class='token pointer' id='tok-74-69' style='color:red'>display</span><span id='tok'>the</span><span class='token pointer' id='tok-74-70' style='color:red'>values.</span></p><p id=p589><span id='tok'>We</span><span id='tok'>will</span><span id='tok'>be</span><span id='tok'>adding</span><span id='tok'>the</span><span id='tok'>above</span><span id='tok'>code</span><span class='token pointer' id='tok-74-71' style='color:red'>snippets</span><span id='tok'>to</span><span id='tok'>our</span><span id='tok'>final</span><span id='tok'>program.</span></p><p id=p601><span class='token pointer' id='tok-74-72' style='color:red'>Misconfigured</span><span id='tok'>Permission</span><span id='tok'>for</span><span id='tok'>Service</span><span id='tok'>ExecutablesThe</span><span id='tok'>second</span><span id='tok'>part</span><span id='tok'>of</span><span id='tok'>the</span><span id='tok'>program</span><span id='tok'>includes</span><span id='tok'>checking</span><span id='tok'>the</span><span id='tok'>permission</span><span id='tok'>of</span><span class='token pointer' id='tok-74-73' style='color:red'>executables.</span><span class='token pointer' id='tok-74-74' style='color:red'>service</span><span id='tok'>means</span><span id='tok'>if</span><span id='tok'>any</span><span id='tok'>low</span><span id='tok'>privileged</span><span id='tok'>user</span><span id='tok'>can</span><span id='tok'>modify/write/replace</span><span id='tok'>the</span><span id='tok'>executable</span><span id='tok'>with</span><span id='tok'>his</span><span class='token pointer' id='tok-74-75' style='color:red'>code/executable.</span><span id='tok'>Next</span><span id='tok'>time</span><span id='tok'>when</span><span id='tok'>the</span><span id='tok'>service</span><span id='tok'>starts</span><span class='token pointer' id='tok-74-76' style='color:red'>malicious</span><span id='tok'>code</span><span id='tok'>will</span><span id='tok'>get</span><span id='tok'>executed</span><span id='tok'>as</span><span id='tok'>a</span><span id='tok'>system.</span></p><p id=p646><span id='tok'>In</span><span id='tok'>this</span><span id='tok'>case,</span><span id='tok'>we</span><span id='tok'>will</span><span id='tok'>be</span><span id='tok'>using</span><span class='token pointer' id='tok-74-77' style='color:red'>"icacls"</span><span class='token pointer' id='tok-74-78' style='color:red'>utility</span><span id='tok'>of</span><span id='tok'>windows</span><span id='tok'>to</span><span id='tok'>find</span><span id='tok'>out</span><span id='tok'>permission</span><span id='tok'>of</span><span id='tok'>all</span><span id='tok'>service</span><span id='tok'>executables.</span><span id='tok'>Moreover,</span><span id='tok'>list</span><span id='tok'>down</span><span id='tok'>the</span><span id='tok'>ones</span><span id='tok'>in</span><span id='tok'>which</span><span id='tok'>any</span><span id='tok'>user</span><span id='tok'>has</span><span id='tok'>full</span><span id='tok'>access</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>executable.</span></p><p id=p680><span id='tok'>As</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>seen,</span><span id='tok'>we</span><span id='tok'>have</span><span id='tok'>used</span><span id='tok'>the</span><span class='token pointer' id='tok-74-79' style='color:red'>output</span><span id='tok'>of</span><span class='token pointer' id='tok-74-80' style='color:red'>wmi query</span><span id='tok'>our</span><span id='tok'>previous</span><span id='tok'>section</span><span id='tok'>of</span><span id='tok'>code</span><span id='tok'>and</span><span id='tok'>added</span><span id='tok'>found</span><span id='tok'>executable</span><span id='tok'>files</span><span id='tok'>in</span><span id='tok'>a</span><span id='tok'>Python</span><span id='tok'>list.</span></p><p id=p707><span id='tok'>We</span><span id='tok'>will</span><span id='tok'>now</span><span id='tok'>feed</span><span id='tok'>the</span><span id='tok'>executable</span><span id='tok'>path</span><span id='tok'>to</span><span id='tok'>icacls</span><span id='tok'>utility</span><span id='tok'>to</span><span id='tok'>get</span><span id='tok'>the</span><span id='tok'>permission</span><span id='tok'>info</span><span id='tok'>of</span><span id='tok'>executable</span><span id='tok'>and</span><span id='tok'>parse</span><span id='tok'>the</span><span id='tok'>output</span><span id='tok'>using</span><span id='tok'>the</span><span class='token pointer' id='tok-74-81' style='color:red'>find_paths</span><span id='tok'>function.</span></p><p id=p732><span id='tok'>Ethical</span><span id='tok'>Hacking</span><span id='tok'>Training</span><span id='tok'>â€“</span><span id='tok'>Resources</span><span id='tok'>(InfoSec)</span></p><p id=p738><span id='tok'>The</span><span id='tok'>find_paths</span><span id='tok'>function</span><span id='tok'>match</span><span id='tok'>the</span><span id='tok'>permission</span><span id='tok'>info</span><span id='tok'>of</span><span id='tok'>executable</span><span id='tok'>with</span><span class='token pointer' id='tok-74-82' style='color:red'>predefined</span><span id='tok'>values</span><span id='tok'>and</span><span id='tok'>prints</span><span id='tok'>out</span><span id='tok'>if</span><span id='tok'>any</span><span id='tok'>match</span><span id='tok'>is</span><span id='tok'>found.</span></p><p id=p758><span id='tok'>Misconfigured</span><span id='tok'>MSI</span><span id='tok'>registry</span><span id='tok'>entriesWindows</span><span id='tok'>has</span><span id='tok'>this</span><span class='token pointer' id='tok-74-83' style='color:red'>configuration</span><span id='tok'>which</span><span id='tok'>if</span><span id='tok'>set</span><span id='tok'>allows</span><span id='tok'>any</span><span id='tok'>user</span><span id='tok'>to</span><span id='tok'>run</span><span id='tok'>MSI</span><span id='tok'>(Microsoft</span><span class='token pointer' id='tok-74-84' style='color:red'>Installers)</span><span id='tok'>with</span><span id='tok'>SYSTEM</span><span id='tok'>privileges.</span><span id='tok'>This</span><span id='tok'>involves</span><span id='tok'>checking</span><span id='tok'>the</span><span class='token pointer' id='tok-74-85' style='color:red'>true</span><span id='tok'>value</span><span id='tok'>for</span><span id='tok'>a</span><span class='token pointer' id='tok-74-86' style='color:red'>32-bit</span><span class='token pointer' id='tok-74-87' style='color:red'>dword</span><span id='tok'>named</span><span id='tok'>"AlwaysInstallElevated".</span></p><p id=p791><span id='tok'>This</span><span id='tok'>will</span><span id='tok'>be</span><span id='tok'>our</span><span id='tok'>last</span><span id='tok'>addition</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>program,</span><span id='tok'>in</span><span id='tok'>this</span><span id='tok'>case,</span><span id='tok'>we</span><span id='tok'>will</span><span id='tok'>be</span><span id='tok'>using</span><span id='tok'>inbuilt</span><span class='token pointer' id='tok-74-88' style='color:red'>python's</span><span id='tok'>module</span><span id='tok'>named</span><span class='token pointer' id='tok-74-89' style='color:red'>"_winreg"</span><span id='tok'>to</span><span id='tok'>fetch</span><span id='tok'>out</span><span id='tok'>the</span><span id='tok'>registry</span><span id='tok'>entries.</span></p><p id=p818><span id='tok'>We</span><span id='tok'>open</span><span id='tok'>the</span><span id='tok'>registry</span><span id='tok'>keys</span><span id='tok'>using</span><span class='token pointer' id='tok-74-90' style='color:red'>OpenKey</span><span id='tok'>function</span><span id='tok'>and</span><span id='tok'>enum</span><span id='tok'>the</span><span id='tok'>first</span><span id='tok'>dword</span><span id='tok'>value.</span><span id='tok'>We</span><span id='tok'>further</span><span id='tok'>verify</span><span id='tok'>whether</span><span id='tok'>both</span><span id='tok'>registry</span><span id='tok'>keys</span><span id='tok'>are</span><span id='tok'>set</span><span id='tok'>to</span><span id='tok'>true.</span></p><p id=p843><span id='tok'>If</span><span id='tok'>both</span><span id='tok'>registry</span><span id='tok'>keys</span><span id='tok'>exist</span><span id='tok'>and</span><span id='tok'>dword</span><span id='tok'>values</span><span id='tok'>are</span><span id='tok'>set,</span><span id='tok'>we</span><span id='tok'>display</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>message</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>user.</span></p><p id=p861><span id='tok'>Let's</span><span id='tok'>execute</span><span id='tok'>our</span><span id='tok'>complete</span><span id='tok'>script</span><span id='tok'>on</span><span id='tok'>a</span><span id='tok'>vulnerable</span><span id='tok'>machine.</span><span id='tok'>As</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>seen,</span><span id='tok'>our</span><span id='tok'>script</span><span id='tok'>is</span><span id='tok'>successfully</span><span id='tok'>able</span><span id='tok'>to</span><span id='tok'>determine</span><span id='tok'>the</span><span id='tok'>mentioned</span><span id='tok'>issues.</span><span id='tok'>As</span><span id='tok'>our</span><span id='tok'>machine</span><span id='tok'>is</span><span id='tok'>not</span><span id='tok'>vulnerable</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>third</span><span id='tok'>issue,</span><span id='tok'>I</span><span id='tok'>encourage</span><span id='tok'>a</span><span id='tok'>diligent</span><span id='tok'>reader</span><span id='tok'>to</span><span id='tok'>manually</span><span id='tok'>create</span><span id='tok'>those</span><span id='tok'>registry</span><span id='tok'>entries</span><span id='tok'>and</span><span id='tok'>execute</span><span id='tok'>their</span><span id='tok'>own</span><span id='tok'>MSI</span><span id='tok'>executable</span><span id='tok'>using</span><span class='token pointer' id='tok-74-91' style='color:red'>msiexec</span><span id='tok'>utility.</span></p><p id=p914><span id='tok'>Hint:</span><span id='tok'>We</span><span id='tok'>can</span><span id='tok'>generate</span><span class='token pointer' id='tok-74-92' style='color:red'>msi</span><span id='tok'>files</span><span id='tok'>using</span><span class='token pointer' id='tok-74-93' style='color:red'>msfvenom.
</span></p>