<p id=p0>This challenge includes a <span class='token pointer' id='tok-71-0' style='color:red'>application</span><span class='token pointer' id='tok-71-1' style='color:red'>web</span>designed for <span class='token pointer' id='tok-71-2' style='color:red'>image hosting.</span>application has a few <span class='token pointer' id='tok-71-3' style='color:red'>vulnerabilities.</span>The challenge is to exploit the <span class='token pointer' id='tok-71-4' style='color:red'>application's</span>vulnerability and find the hidden message for a date arrangement that Bob sent to Alice. </p><p id=p39><span class='token pointer' id='tok-71-5' style='color:red'>virtual</span><span class='token pointer' id='tok-71-6' style='color:red'>machine</span><span class='token pointer' id='tok-71-7' style='color:red'>Host the</span>let's start by identifying the target <span class='token pointer' id='tok-71-8' style='color:red'>IP.</span>We will run an <span class='token pointer' id='tok-71-9' style='color:red'>Nmap ping scan</span>detecting all live hosts. </p><p id=p63>As can be seen in above figure, <span class='token pointer' id='tok-71-10' style='color:red'>nmap</span>detected three hosts: The IP 192.168.0.1 is my router, the IP 192.168.0.100 is my system's IP, and the IP 192.168.0.103 is our target. Try to open this IP from browser. </p><p id=p101>There is an application that seems to be for image hosting. First, we will start <span class='token pointer' id='tok-71-11' style='color:red'>enumerating</span>the whole application try to find all possible URLs of this application. For <span class='token pointer' id='tok-71-12' style='color:red'>enumeration</span>we will use </p><p id=p138>After <span class='token pointer' id='tok-71-13' style='color:red'>spidering</span>the application, we now have some internal URLs for the application. We can see some <span class='token pointer' id='tok-71-14' style='color:red'>PHP</span>files over there. The upload.php file is used for file upload functionality, but what is that myphp.php file? Let's find out what is hidden in that page. Open the URL in the browser and add an id <span class='token pointer' id='tok-71-15' style='color:red'>parameter</span>with some integer value. For example, we added id=100 and the URL looks like this: http://192.168.0.103:8880/myphp?id=100 </p><p id=p210>The application is showing a message, it is giving us a hint that we should dig more. Let's try some more values in the id parameter; this time, we will pass 101 as the id parameter. </p><p id=p246>The PHP version disclosed some sensitive information. Try with another value, like 102: </p><p id=p259>No such information is showing, only a <span class='token pointer' id='tok-71-16' style='color:red'>"PHP Credits"</span>Change the id value to 104: </p><p id=p275>Now this time we have some juicy information; the full PHP configuration is disclosed. We can see all PHP functions that are disabled from configuration file. Again we changed the id value to 108. </p><p id=p309>Ethical <span class='token pointer' id='tok-71-17' style='color:red'>Hacking</span>Boot Camp â€” 93% Exam Pass Rate </p><p id=p318>This time we get the Apache <span class='token pointer' id='tok-71-18' style='color:red'>server</span>details, such as the server version, installed modules, etc. That is enough for our enumeration phase; we now have much information about our target. Now go back to the application home page and try out the application's functionality to see how it works? We can see that there is a file upload functionality there, so try to upload an image file. </p><p id=p386>For an example, we will upload an image named fishy.jpg. After successfully uploading the image, it will redirect to image.php which is showing our uploaded image. </p><p id=p412>Let's check out the <span class='token pointer' id='tok-71-19' style='color:red'>source code</span>the page from which the image comes. Right-click in the browser and select "View Source." </p><p id=p434>As can be seen above, the uploaded image is coming from the images directory and our uploaded image name is changed to some kind of hash value. We identified that this is a <span class='token pointer' id='tok-71-20' style='color:red'>MD5 Hash</span>it is 32 bytes long and contains only numbers and a-f characters. So let's verify that this MD5 hash value matches with our file name. First, we calculate the MD5 value for "fishy" and the output was "29c3a60c13d1e0eda25d65f65a761b47"; this value does not match the current value. Next, we use the full name of the file, "fishy.jpg," and calculate the MD5 hash value; the output is "e1a9d5f33b65b29243ca47bd3f5fd3af," which is the correct value. </p><p id=p541>fishy = 29c3a60c13d1e0eda25d65f65a761b47 fishy.jpg = e1a9d5f33b65b29243ca47bd3f5fd3af </p><p id=p547>It means the application calculates the MD5 hash with the full file name, including the extension. </p><p id=p563>Now we know where the application stores an uploaded file and the name it uses. Let's try to upload a PHP file. </p><p id=p585>It does not allow us to upload a PHP file. We tried some different techniques to bypass this restriction. Finally, we added a double file extension like this: "k.jpg.php" and tried to upload it. </p><p id=p619>The file is successfully uploaded. But we can't see any image. </p><p id=p630>We checked the source code and there is nothing: </p><p id=p639>But there is no need to worry. We know where our image is and the current name of the PHP file. We can access our PHP file by changing the file name into a MD5 hash. First, calculate the MD5 for k.jpg.php: </p><p id=p681>Now we have the MD5 hash; let's try to access our uploaded PHP file by calling. </p><p id=p697>Yes, our PHP file is successfully executed: It shows "www-data" because, in the PHP file, we used the "whoami" command. Now it is confirmed that we are able to execute a PHP file on the server. So let's upload another PHP file, but this time we will use execute all Unix commands on the server; that's why we have written this small piece of code: </p><p id=p762>Now upload this PHP file by using the same technique. Locate the file and access it from the URL. Whatever command we want to execute on the server, we just have to pass the command as a c parameter. For example, we want to check which directory we are currently in, so we passed "c=pwd." </p><p id=p817>And it shows that the current directory is images. We want to see all the files in this current directory with the file permissions, so we use this command: "ls -la ./ > dirlist.txt": </p><p id=p851>After executing the command we know that the result is in the dirlist.txt file so let's open the dirlist.txt file from images directory. </p><p id=p874>We can see the all files in the images directory. Here we can see there is nothing that will help us to find the hidden files. So we will now check the root directory files. Type in "ls -la /var/www > dirlist.txt": </p><p id=p916>Open the dirlist.txt from the same location as we previously did. </p><p id=p927>We can see the all the application files , but we are searching for a hidden file. What's the .proof file? Let's see type in "cat /var/www/.proof > proof.txt": </p><p id=p956>Access the proof.txt file from the images directory. </p><p id=p964>Yeah! We finally found something, a Secret code: TGglMUxecjJDSDclN1Ej , this code looks as if it's <span class='token pointer' id='tok-71-21' style='color:red'>Base64 encoded,</span>we decoded this; the output is "Lh%1L^r2CH7%7Q#." We can see there is a small conversation is between bob and an unknown person. Now who is bob? Is bob a user? Let's check the home directory: Type in "ls -la -R /home > bob.txt": </p><p id=p1026>After executing the command, open the bob.txt file to check out the home directory files. </p><p id=p1041>We can see that bob is a user on this server and we can see his all directories. There is a public_html folder, which means he has a web application. </p><p id=p1071>The application is asking for a Secret. We already have that secret code, we provided this code: Lh%1L^r2CH7%7Q# </p><p id=p1089>We can see there is a message if we write we write these number into Google Maps, we get the secret location: </p><p id=p1111>Coast Tombazis 7, Chania Crete, Greece.
 </p>