<p id=p0>Last week's devastating <span class='token pointer' id='tok-200-0' style='color:red'>NotPetya</span>attack might have been launched by the same threat group that previously used the <span class='token pointer' id='tok-200-1' style='color:red'>Russia-linked</span><span class='token pointer' id='tok-200-2' style='color:red'>BlackEnergy</span><span class='token pointer' id='tok-200-3' style='color:red'>malware</span>family in attacks against Ukraine, <span class='token pointer' id='tok-200-4' style='color:red'>security</span>researchers reveal. </p><p id=p29><span class='token pointer' id='tok-200-5' style='color:red'>Initially</span>believed to be a <span class='token pointer' id='tok-200-6' style='color:red'>ransomware</span>incident employing the same distribution tools as <span class='token pointer' id='tok-200-7' style='color:red'>WannaCry,</span>the NotPetya malware eventually proved to be a <span class='token pointer' id='tok-200-8' style='color:red'>disk</span><span class='token pointer' id='tok-200-9' style='color:red'>wiper</span>spreading with the sole purpose of damaging infected <span class='token pointer' id='tok-200-10' style='color:red'>computers.</span>Similar to WannaCry, NotPetya hit <span class='token pointer' id='tok-200-11' style='color:red'>Windows</span>7 <span class='token pointer' id='tok-200-12' style='color:red'>machines</span>the most. </p><p id=p72>The malware eventually hit <span class='token pointer' id='tok-200-13' style='color:red'>systems</span>in more than 65 countries, but most of its victims are <span class='token pointer' id='tok-200-14' style='color:red'>located</span>in Ukraine. Of a total of less than 20,000 machines infected by NotPetya (also referred to as PetrWrap, exPetr, GoldenEye, and <span class='token pointer' id='tok-200-15' style='color:red'>Diskcoder.C),</span>more than 70% are in Ukraine, <span class='token pointer' id='tok-200-16' style='color:red'>Microsoft</span>says. </p><p id=p119>Late last week, security researchers also discovered the reason why Ukraine was hit the most: the attack was apparently launched by the same threat group that initiated numerous other attacks against the country's power grid,Â mining and railway systems, and Ukrainian government organizations. </p><p id=p161>Dubbed <span class='token pointer' id='tok-200-17' style='color:red'>TeleBots,</span>the group was previously referred to as BlackEnergy or <span class='token pointer' id='tok-200-18' style='color:red'>Sandworm</span>Team. One of the tools associated with it is the <span class='token pointer' id='tok-200-19' style='color:red'>KillDisk</span>wiper that was packing ransomware capabilities in recent attacks, and which <span class='token pointer' id='tok-200-20' style='color:red'>demanded</span>a 222 <span class='token pointer' id='tok-200-21' style='color:red'>Bitcoin</span>ransom from its victims. </p><p id=p203>The NotPetya sample used in last week's attack includes a series of similarities with the BlackEnergy and KillDisk malware families, Kaspersky Lab and <span class='token pointer' id='tok-200-22' style='color:red'>ESET</span>security researchers have discovered. </p><p id=p231>The list of targeted file <span class='token pointer' id='tok-200-23' style='color:red'>extensions</span>in NotPetya shows similarities to the list in a wiper the group was using in 2015, Kaspersky Lab reveals. The lists are similar in composition and formatting (stored in the same dot-separated formats), which <span class='token pointer' id='tok-200-24' style='color:red'>suggests</span>a possible <span class='token pointer' id='tok-200-25' style='color:red'>link,</span>the security researchers say. </p><p id=p279><span class='token pointer' id='tok-200-26' style='color:red'>According</span>to Kaspersky, a Yara rule they created during analysis "fires on BlackEnergy and ExPetr samples only" when run on the company's extensive malware collection. The strings used to create the rule can generate false positives when used alone, but "when combined together in this fashion, they become very precise," the researchers say. </p><p id=p332>"Of course, this should not be considered a sign of a definitive link, but it does point to certain <span class='token pointer' id='tok-200-27' style='color:red'>code</span>design similarities between these malware families," Kaspersky says. </p><p id=p360>ESET, on the other hand, appears more confident of the connection between TeleBots and NotPetya, and even suggests that this was the third major attack the group launched this year against Ukraine. </p><p id=p392>The first, they say, was launched in March and had as final payload a ransomware family detected as <span class='token pointer' id='tok-200-28' style='color:red'>Filecoder.NKH.</span><span class='token pointer' id='tok-200-29' style='color:red'>Tools</span>used in the attack included the Python/TeleBot.A <span class='token pointer' id='tok-200-30' style='color:red'>backdoor,</span>a heavily obfuscated <span class='token pointer' id='tok-200-31' style='color:red'>VBS</span>backdoor, CredRaptor <span class='token pointer' id='tok-200-32' style='color:red'>(password</span>stealer), Plainpwd (modified <span class='token pointer' id='tok-200-33' style='color:red'>Mimikatz</span>to recover Windows credentials), and SysInternals' <span class='token pointer' id='tok-200-34' style='color:red'>PsExec</span>(used for lateral movement). A <span class='token pointer' id='tok-200-35' style='color:red'>Linux</span>ransomware was used on <span class='token pointer' id='tok-200-36' style='color:red'>non-Windows</span><span class='token pointer' id='tok-200-37' style='color:red'>servers.</span></p><p id=p450>In late May, the group launched a second large ransomware attack against Ukraine, this time using a piece of malware known as <span class='token pointer' id='tok-200-38' style='color:red'>XData</span>(detected as Filecoder.AESNI.C). Five days into the attack, and 96% of the <span class='token pointer' id='tok-200-39' style='color:red'>malware's</span>detections were in Ukraine, ESET was reporting on May 23. </p><p id=p496>The ransomware also packed code that allowed it to automatically move laterally within <span class='token pointer' id='tok-200-40' style='color:red'>compromised</span><span class='token pointer' id='tok-200-41' style='color:red'>networks:</span>it featured an embedded Mimikatz DLL to extract Windows credentials, as well as SysInternals' PsExec utility for spreading. </p><p id=p529>One month later, the group launched a third, more sophisticated ransomware attack against organizations in Ukraine. Borrowing code from last year's <span class='token pointer' id='tok-200-42' style='color:red'>Petya</span>ransomware, the actors created a wiper and started using <span class='token pointer' id='tok-200-43' style='color:red'>NSA-linked</span>SMB exploits to maximize spreading capabilities. </p><p id=p567>"However, unlike the original Petya ransomware, <span class='token pointer' id='tok-200-44' style='color:red'>Diskcoder.C's</span>authors modified the <span class='token pointer' id='tok-200-45' style='color:red'>MBR</span>code in such a way that recovery won't be possible. Specifically, the attacker cannot provide a <span class='token pointer' id='tok-200-46' style='color:red'>decryption</span>key and the decryption key cannot be typed in the ransom screen, because the generated key contains non-acceptable characters," ESET explains. </p><p id=p616>The <span class='token pointer' id='tok-200-47' style='color:red'>initial infection vector</span>the NotPetya incident was the Ukrainian accounting <span class='token pointer' id='tok-200-48' style='color:red'>software</span>called MEDoc, the same as in the case of the XData attack. For the March attack, the group compromised another software company in Ukraine (not related to M.E. Doc), and gained access to the internal networks of several financial institutions using VPN tunnels. </p><p id=p672>"[The] Diskcoder.C outbreak suggests that the attackers had access to the <span class='token pointer' id='tok-200-49' style='color:red'>update</span><span class='token pointer' id='tok-200-50' style='color:red'>server</span>of the legitimate software. Using access to this server, attackers pushed a <span class='token pointer' id='tok-200-51' style='color:red'>malicious</span>update that was applied automatically without user interaction. That's why so many systems in Ukraine were affected by this attack," ESET notes. </p><p id=p720>The security researchers also believe that M.E.Doc's server, where they discovered a malicious PHP backdoor medoc_online.php in a FTP directory, might have been used as infection vector for other malware as well. Using malicious updates, the group supposedly deployed their own nefarious tools "in a stealthy way to computer networks that belong to high-value targets." </p><p id=p775>TweetIonut Arghire is an international correspondent for SecurityWeek. 
 </p>