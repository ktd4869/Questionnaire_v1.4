<p id=p0>In a typical <span class='token pointer' id='tok-73-0' style='color:red'>scenario,</span>threat actors try to <span class='token pointer' id='tok-73-1' style='color:red'>gather</span>as much information as possible (such as <span class='token pointer' id='tok-73-2' style='color:red'>sensitive</span>documents like credit card numbers, <span class='token pointer' id='tok-73-3' style='color:red'>SSN details,</span>passwords stored in unprotected text files, etc.) about their targets after a <span class='token pointer' id='tok-73-4' style='color:red'>successful</span><span class='token pointer' id='tok-73-5' style='color:red'>exfiltration.</span></p><p id=p39>It is possible to detect such <span class='token pointer' id='tok-73-6' style='color:red'>malicious</span>attempts by <span class='token pointer' id='tok-73-7' style='color:red'>deploying</span>file <span class='token pointer' id='tok-73-8' style='color:red'>decoys</span>or baits on endpoints or <span class='token pointer' id='tok-73-9' style='color:red'>emails.</span>If an <span class='token pointer' id='tok-73-10' style='color:red'>attacker</span>tries to access such a <span class='token pointer' id='tok-73-11' style='color:red'>decoy,</span>an alert is <span class='token pointer' id='tok-73-12' style='color:red'>triggered</span>and logged into a <span class='token pointer' id='tok-73-13' style='color:red'>centralized</span>system. </p><p id=p76>In this document, we will be getting our hands dirty on creating the decoys using readily available tools at our disposal (PS: no macros). This document will cover the following: </p><p id=p106>How the decoys workCreating image <span class='token pointer' id='tok-73-14' style='color:red'>beacons</span>for decoys using <span class='token pointer' id='tok-73-15' style='color:red'>PythonCreating</span>file decoys and setting up unique <span class='token pointer' id='tok-73-16' style='color:red'>identifiersMonitoring</span>malicious <span class='token pointer' id='tok-73-17' style='color:red'>attemptsPerquisites:</span><span class='token pointer' id='tok-73-18' style='color:red'>Python</span>2.x, </p><p id=p132>Let's get started! </p><p id=p135>1. File Decoys – Understanding the <span class='token pointer' id='tok-73-19' style='color:red'>BackgroundSo,</span>to understand the working of file decoys, first, we need to understand how <span class='token pointer' id='tok-73-20' style='color:red'>HTTP</span>works. </p><p id=p157>In case of an HTTP <span class='token pointer' id='tok-73-21' style='color:red'>request/response</span>mode, a <span class='token pointer' id='tok-73-22' style='color:red'>web-browser</span>initiates a <span class='token pointer' id='tok-73-23' style='color:red'>request</span>for certain content. The web server locates the requested content and serves it as a part of response back to the <span class='token pointer' id='tok-73-24' style='color:red'>browser.</span>The browser then interprets the content and finally renders it. Initially, when the request reaches the web server, a log entry is made in the logs (e.g., access.log) depicting the origin, user-agent, timestamp, etc. </p><p id=p225>Similarly, in case of the workflow for decoys, a similar approach is followed. A word document is <span class='token pointer' id='tok-73-25' style='color:red'>embedded</span>with a linked image <span class='token pointer' id='tok-73-26' style='color:red'>which</span>is stored on the web server. Whenever the document is <span class='token pointer' id='tok-73-27' style='color:red'>accessed/opened;</span>the document tries to load the image from the remote location (i.e., web server), this, in turn, sends an HTTP request to the server. The server looks up for the image and delivers it to be embedded into the document. A log entry is created for this inbound request as well. In a real scenario, an adversary will try to get sensitive data from a system. A decoy will be placed with a lucrative name such as password-list.docx within the directory. Once the adversary tries to open the file, a request will be fired to the web server, and a log entry will be generated depicting that someone has <span class='token pointer' id='tok-73-28' style='color:red'>infiltrated</span>the system and is trying to steal away sensitive information. </p><p id=p379>2. Creating Image Beacons Using <span class='token pointer' id='tok-73-29' style='color:red'>PythonLet's</span>create an image <span class='token pointer' id='tok-73-30' style='color:red'>beacon</span>which will be linked in our decoys. The beacon will be <span class='token pointer' id='tok-73-31' style='color:red'>1×1</span><span class='token pointer' id='tok-73-32' style='color:red'>pixel</span>by size with full transparency. Due to the miniature size of <span class='token pointer' id='tok-73-33' style='color:red'>the pixel,</span>would not be easily spotted by the naked eye once the decoys are opened. </p><p id=p430>We will use python along with Python Image Library <span class='token pointer' id='tok-73-34' style='color:red'>(PIL)</span>module to generate a beacon: </p><p id=p445>from PIL import Image </p><p id=p449>img = Image.new('RGBA', (1,1), (0,0,0,0)) </p><p id=p454><span class='token pointer' id='tok-73-35' style='color:red'>img.save('beacon.gif',</span>"GIF", transparency=0) </p><p id=p457>This will create an image file <span class='token pointer' id='tok-73-36' style='color:red'>beacon.gif.</span>Save this file in the /var/www/ directory of your Linux web server. Now on the Linux box, start the apache service (service apache2 start) and check if the default page appears in the browser (http://localhost/). </p><p id=p499>Mobile Device <span class='token pointer' id='tok-73-37' style='color:red'>Penetration</span>Testing </p><p id=p503>3. Creating File Decoys and Setting Up Unique <span class='token pointer' id='tok-73-38' style='color:red'>IdentifiersOnce</span>the beacon is ready, we need to embed the remotely deployed beacon into the office document file. Following steps will walk you through linking beacons for <span class='token pointer' id='tok-73-39' style='color:red'>MS</span>Word 2013. </p><p id=p541>Step 1. Open a word document > Click Insert </p><p id=p550>Step 2. Select Quick Parts > Click Field… </p><p id=p558>Step 3. Select IncludePicture and enter the path for beacon > Check Data not stored with Document </p><p id=p575>Step 4. Click Okay. </p><p id=p579>In an organization where file decoys need to be placed at multiple endpoints like the CEO's computer, the CFO's laptop, etc. it can become tedious to identify the source of the attack just based on the IP address of the system. </p><p id=p620>To overcome this shortcoming, we can append unique identifiers to the URL path for the beacon in Step 3. Let's assume we need to add two systems – CEO's desktop and the Head of <span class='token pointer' id='tok-73-40' style='color:red'>Marketing's</span>laptop; we will introduce <span class='token pointer' id='tok-73-41' style='color:red'>distinct</span>identifiers in the URL path by including pseudo parameters. </p><p id=p669>So, when you run through the access logs looking for malicious attempts, it will be easier to differentiate as to whose system was infiltrated. After successfully embedding the beacon, it is time to fill up the document file with data which look lucrative for the adversary such as fake password details, credit card numbers, SSN, so on and so forth. It is mandatory that such data is entered to deceive the adversary. Additionally, rename the file such as password-list.docx or similar </p><p id=p750>to trick the adversary into believing that he has actually hit the <span class='token pointer' id='tok-73-42' style='color:red'>jackpot.</span></p><p id=p763>4. Monitoring Malicious AttemptsThis will be the last piece where we will monitor if an adversary has gained access to the system and tried to steal away and access our decoy. </p><p id=p794>Go to the <span class='token pointer' id='tok-73-43' style='color:red'>/var/log/apache2/</span>directory and open the access.log file using your favorite log viewer or text editor. </p><p id=p812>Deploy the decoys on the endpoint systems. Once the document is opened on the endpoint, it will send an HTTP request to our web server. You should be able to view an entry similar to the one below in the Apache's access log: </p><p id=p855>Where to deploy the decoys? The decoys can be deployed anywhere, ranging from laptops, servers, desktops, emails, mobile phones, etc. Generally, the decoys can be deployed on HVT's (High-Value Targets) systems. </p><p id=p886>    </p>