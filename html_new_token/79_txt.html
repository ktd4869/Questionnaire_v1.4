<p id=p0><span class='token pointer' id='tok-79-0' style='color:red'>Deobfuscator</span><span class='token pointer' id='tok-79-1' style='color:red'>Script</span>purpose of this <span class='token pointer' id='tok-79-2' style='color:red'>tool</span>is to help you perform <span class='token pointer' id='tok-79-3' style='color:red'>static</span><span class='token pointer' id='tok-79-4' style='color:red'>analysis</span>on <span class='token pointer' id='tok-79-5' style='color:red'>obfuscated</span><span class='token pointer' id='tok-79-6' style='color:red'>scripts.</span> It's often easier to <span class='token pointer' id='tok-79-7' style='color:red'>dynamically analyze</span>but there are times <span class='token pointer' id='tok-79-8' style='color:red'>when</span>you just don't know where to start or you just want a <span class='token pointer' id='tok-79-9' style='color:red'>high-level view</span>what's going on with the <span class='token pointer' id='tok-79-10' style='color:red'>script.</span> This tool may be able to help you.  </p><p id=p61>I already wrote a tool called <span class='token pointer' id='tok-79-11' style='color:red'>Decoder</span><span class='token pointer' id='tok-79-12' style='color:red'>PHP Script</span>this new version has been re-written in <span class='token pointer' id='tok-79-13' style='color:red'>.NET</span>with new <span class='token pointer' id='tok-79-14' style='color:red'>functionality</span>and <span class='token pointer' id='tok-79-15' style='color:red'>flexibility</span>in order to handle <span class='token pointer' id='tok-79-16' style='color:red'>PHP,</span><span class='token pointer' id='tok-79-17' style='color:red'>Javascript,</span><span class='token pointer' id='tok-79-18' style='color:red'>VBA,</span>and <span class='token pointer' id='tok-79-19' style='color:red'>VBS</span>scripts. </p><p id=p94>To explain how to use this tool, let me show you how to tackle seven different obfuscated scripts. </p><p id=p112>Example #1 Here's what the script looks like.  Looking at the script, you'll see an <span class='token pointer' id='tok-79-20' style='color:red'>array</span>of <span class='token pointer' id='tok-79-21' style='color:red'>base64-encoded</span><span class='token pointer' id='tok-79-22' style='color:red'>strings</span>at the top.  Following that are <span class='token pointer' id='tok-79-23' style='color:red'>references</span>to specific <span class='token pointer' id='tok-79-24' style='color:red'>elements</span>from the array. </p><p id=p146>Paste in the script sections like so.  The script you are trying to <span class='token pointer' id='tok-79-25' style='color:red'>deobfuscate</span>is at the top.  The array of base64-encoded strings separated by commas in the middle section.  I enter the <span class='token pointer' id='tok-79-26' style='color:red'>search</span><span class='token pointer' id='tok-79-27' style='color:red'>string</span><span class='token pointer' id='tok-79-28' style='color:red'>value</span>of <span class='token pointer' id='tok-79-29' style='color:red'>"_705650624(#)"</span>since that's how the script at the top references the elements from the array (note: the pound sign is a wildcard and must be present).  I select the <span class='token pointer' id='tok-79-30' style='color:red'>"Array"</span>method and click on the <span class='token pointer' id='tok-79-31' style='color:red'>"Convert"</span>button. </p><p id=p224>The results still show <span class='token pointer' id='tok-79-32' style='color:red'>encoded</span>strings so now I check the <span class='token pointer' id='tok-79-33' style='color:red'>"Base64</span><span class='token pointer' id='tok-79-34' style='color:red'>Decode",</span><span class='token pointer' id='tok-79-35' style='color:red'>"Concatenate",</span>and <span class='token pointer' id='tok-79-36' style='color:red'>"Keep Quotes"</span>and try again. </p><p id=p245>The script has been <span class='token pointer' id='tok-79-37' style='color:red'>deobfuscated</span>and much easier to read.  The script won't execute though because the strings are quoted (or <span class='token pointer' id='tok-79-38' style='color:red'>unquoted)</span>incorrectly. </p><p id=p269>Example # 2 Here's the script we'll be working on: </p><p id=p279>First we need to <span class='token pointer' id='tok-79-39' style='color:red'>unescape</span>it so click on the <span class='token pointer' id='tok-79-40' style='color:red'>"Unescape"</span>button.  If you <span class='token pointer' id='tok-79-41' style='color:red'>right-click</span>on the <span class='token pointer' id='tok-79-42' style='color:red'>Output box,</span>an option to save the results to <span class='token pointer' id='tok-79-43' style='color:red'>text file.</span>(You <span class='token pointer' id='tok-79-44' style='color:red'>can</span>right-click on the <span class='token pointer' id='tok-79-45' style='color:red'>Input box</span>read in a file too.) </p><p id=p324>Click on <span class='token pointer' id='tok-79-46' style='color:red'>"Copy Output to Input"</span>move the result to the top.  This script uses <span class='token pointer' id='tok-79-47' style='color:red'>randomize</span><span class='token pointer' id='tok-79-48' style='color:red'>variable</span>names and assigns a value to it.  The later portion references the value.  </p><p id=p358>The tool will <span class='token pointer' id='tok-79-49' style='color:red'>parse</span>the script and load each variable and associated value into an array.  It then does a search for the variable and replaces it with the value. </p><p id=p389>Choose the <span class='token pointer' id='tok-79-50' style='color:red'>"Random Vars 1"</span> The <span class='token pointer' id='tok-79-51' style='color:red'>delimiter</span>for this script is a semi-colon and for the search <span class='token pointer' id='tok-79-52' style='color:red'>string I</span><span class='token pointer' id='tok-79-53' style='color:red'>${"GLOBALS"}["#"]="*";</span>The pound sign is a <span class='token pointer' id='tok-79-54' style='color:red'>placeholder</span>for the variable name and the asterisk is the placeholder for the value. </p><p id=p433>Here's the result: </p><p id=p436>Example #3 This script also uses random variable names but in this version, the strings are base64-encoded.  The top portion defines the global <span class='token pointer' id='tok-79-55' style='color:red'>variables</span>while the lower section, beginning at <span class='token pointer' id='tok-79-56' style='color:red'>"session_start()",</span>references them. </p><p id=p470>Paste the script sections in the tool as follows then <span class='token pointer' id='tok-79-57' style='color:red'>choose</span>the <span class='token pointer' id='tok-79-58' style='color:red'>"Random Vars 2"</span>and the "Base64 Decode" and "Keep <span class='token pointer' id='tok-79-59' style='color:red'>Quotes"</span>options.  Note the search string has spaces in between so that it matches the script at the top. </p><p id=p512>Example #4 Here's what the script looks like (I highlighted the key): </p><p id=p524>This script references an element in an array to build the values for its variables.  The elements are based on the </p><p id=p551>The first step is to paste the entire script in the <span class='token pointer' id='tok-79-60' style='color:red'>input box</span>choose the <span class='token pointer' id='tok-79-61' style='color:red'>lookup option.</span>I use <span class='token pointer' id='tok-79-62' style='color:red'>$f9[#]</span>as the search string.  In the <span class='token pointer' id='tok-79-63' style='color:red'>Lookup Key box,</span>the key and remove the starting and ending quotes.  Also make sure the key you paste in has been properly escaped.  You can see there's <span class='token pointer' id='tok-79-64' style='color:red'>concatenation</span>going on so check the "Concatenate" option. </p><p id=p620>Example #5 In this example, we're just interested in <span class='token pointer' id='tok-79-65' style='color:red'>decoding</span>the <span class='token pointer' id='tok-79-66' style='color:red'>base64</span>strings. </p><p id=p633>Copy the entire script to the Input box, choose the "Base64" method as well as the "Base64 Decode", "Concatenate", and "Keep Quotes" options.  Make sure the delimiter and search string matches that of the script. </p><p id=p669>Example #6 This script is uses the Joomla exploit and contains decimal values making it tough to see immediately what this does. </p><p id=p691>Paste the script into the Input box and choose the <span class='token pointer' id='tok-79-67' style='color:red'>"ASCII"</span>method. </p><p id=p703>Almost but it's not <span class='token pointer' id='tok-79-68' style='color:red'>concatenated.</span>If you choose the "Concatenate" option, it won't clean up everything.  In the <span class='token pointer' id='tok-79-69' style='color:red'>"Output Options"</span>there's a <span class='token pointer' id='tok-79-70' style='color:red'>"Remove Chars" box.</span>Enter a period and try again. </p><p id=p737>Example #7 This last example is a VBA script. It does a simple math calculation then the result is convert to its ASCII character equivalent. </p><p id=p762>Paste the script in and choose the "Math" method. </p><p id=p771>The result shows decimal values but not the text equivalent. :( So <span class='token pointer' id='tok-79-71' style='color:red'>"chr("</span><span class='token pointer' id='tok-79-72' style='color:red'>enter</span>the <span class='token pointer' id='tok-79-73' style='color:red'>"Pre Str"</span>and a closing parenthesis in the <span class='token pointer' id='tok-79-74' style='color:red'>"Post Str"</span></p><p id=p799>Look familiar? Now we can use the "ASCII" method to get the characters. I also entered an <span class='token pointer' id='tok-79-75' style='color:red'>ampersand and space character</span>the "Remove <span class='token pointer' id='tok-79-76' style='color:red'>Chars"</span>box.  </p><p id=p826>The resulting deobfuscated script will probably error out if you try executing it. <span class='token pointer' id='tok-79-77' style='color:red'>Again,</span>all this tool will do is try to make the script readable so you can better understand it. You may need to use this tool on parts of the script then put them back together yourself to figure things out. </p><p id=p880>I tried to make the <span class='token pointer' id='tok-79-78' style='color:red'>functions</span>in this tool flexible and generic enough to handle whatever scripts come your way. However, if you encounter <span class='token pointer' id='tok-79-79' style='color:red'>something</span>new, please let me know. You can get the tool here. </p><p id=p916>Happy reversing!
 </p>