<p id=p0><span class='token pointer' id='tok-63-0'>In</span><span class='token pointer' id='tok-63-1'>this</span><span class='token pointer' id='tok-63-2'>article,</span><span class='token pointer' id='tok-63-3'>we</span><span class='token pointer' id='tok-63-4'>will</span><span class='token pointer' id='tok-63-5'>be</span><span class='token pointer' id='tok-63-6'>solving</span><span class='token pointer' id='tok-63-7'>all</span><span class='token pointer' id='tok-63-8' style='color:red'>networking</span><span class='token pointer' id='tok-63-9'>challenges</span><span class='token pointer' id='tok-63-10'>and</span><span class='token pointer' id='tok-63-11'>one</span><span class='token pointer' id='tok-63-12' style='color:red'>remote buffer overflow challenge</span><span class='token pointer' id='tok-63-13' style='color:red'>Protostar.</span></p><p id=p18><span class='token pointer' id='tok-63-14'>IntroductionThese</span><span class='token pointer' id='tok-63-15'>levels</span><span class='token pointer' id='tok-63-16'>introduce</span><span class='token pointer' id='tok-63-17'>us</span><span class='token pointer' id='tok-63-18'>to</span><span class='token pointer' id='tok-63-19'>the</span><span class='token pointer' id='tok-63-20'>fundamental</span><span class='token pointer' id='tok-63-21'>concept</span><span class='token pointer' id='tok-63-22'>of</span><span class='token pointer' id='tok-63-23'>sending</span><span class='token pointer' id='tok-63-24'>and</span><span class='token pointer' id='tok-63-25'>receiving</span><span class='token pointer' id='tok-63-26'>data</span><span class='token pointer' id='tok-63-27'>over</span><span class='token pointer' id='tok-63-28'>a</span><span class='token pointer' id='tok-63-29' style='color:red'>network</span><span class='token pointer' id='tok-63-30'>in</span><span class='token pointer' id='tok-63-31'>a</span><span class='token pointer' id='tok-63-32'>different</span><span class='token pointer' id='tok-63-33'>format,</span><span class='token pointer' id='tok-63-34'>and</span><span class='token pointer' id='tok-63-35'>the</span><span class='token pointer' id='tok-63-36'>hurdles</span><span class='token pointer' id='tok-63-37'>of</span><span class='token pointer' id='tok-63-38' style='color:red'>debugging</span><span class='token pointer' id='tok-63-39'>and</span><span class='token pointer' id='tok-63-40'>developing</span><span class='token pointer' id='tok-63-41'>an</span><span class='token pointer' id='tok-63-42' style='color:red'>exploit for remote stack overflows.</span><span class='token pointer' id='tok-63-43'>will</span><span class='token pointer' id='tok-63-44'>have</span><span class='token pointer' id='tok-63-45'>a</span><span class='token pointer' id='tok-63-46'>look</span><span class='token pointer' id='tok-63-47'>at</span><span class='token pointer' id='tok-63-48'>how</span><span class='token pointer' id='tok-63-49'>we</span><span class='token pointer' id='tok-63-50'>can</span><span class='token pointer' id='tok-63-51' style='color:red'>debug</span><span class='token pointer' id='tok-63-52'>and</span><span class='token pointer' id='tok-63-53'>understand</span><span class='token pointer' id='tok-63-54'>what</span><span class='token pointer' id='tok-63-55'>inputs</span><span class='token pointer' id='tok-63-56'>the</span><span class='token pointer' id='tok-63-57' style='color:red'>program</span><span class='token pointer' id='tok-63-58'>expects</span><span class='token pointer' id='tok-63-59'>from</span><span class='token pointer' id='tok-63-60'>us.</span></p><p id=p70><span class='token pointer' id='tok-63-61'>The</span><span class='token pointer' id='tok-63-62'>following</span><span class='token pointer' id='tok-63-63' style='color:red'>assembly code</span><span class='token pointer' id='tok-63-64'>obtained</span><span class='token pointer' id='tok-63-65'>after</span><span class='token pointer' id='tok-63-66'>disassembling</span><span class='token pointer' id='tok-63-67'>the</span><span class='token pointer' id='tok-63-68' style='color:red'>Net0</span><span class='token pointer' id='tok-63-69' style='color:red'>binary.</span><span class='token pointer' id='tok-63-70'>As</span><span class='token pointer' id='tok-63-71'>we</span><span class='token pointer' id='tok-63-72'>can</span><span class='token pointer' id='tok-63-73'>see,</span><span class='token pointer' id='tok-63-74'>the</span><span class='token pointer' id='tok-63-75'>application</span><span class='token pointer' id='tok-63-76'>executes</span><span class='token pointer' id='tok-63-77' style='color:red'>run function</span><span class='token pointer' id='tok-63-78'>the</span><span class='token pointer' id='tok-63-79'>main</span><span class='token pointer' id='tok-63-80'>function.</span><span class='token pointer' id='tok-63-81'>The</span><span class='token pointer' id='tok-63-82'>run</span><span class='token pointer' id='tok-63-83'>function</span><span class='token pointer' id='tok-63-84'>generates</span><span class='token pointer' id='tok-63-85'>a</span><span class='token pointer' id='tok-63-86'>random</span><span class='token pointer' id='tok-63-87'>number</span><span class='token pointer' id='tok-63-88'>and</span><span class='token pointer' id='tok-63-89'>uses</span><span class='token pointer' id='tok-63-90' style='color:red'>call to print</span><span class='token pointer' id='tok-63-91'>on</span><span class='token pointer' id='tok-63-92'>the</span><span class='token pointer' id='tok-63-93'>screen.</span><span class='token pointer' id='tok-63-94'>It</span><span class='token pointer' id='tok-63-95'>further</span><span class='token pointer' id='tok-63-96'>checks</span><span class='token pointer' id='tok-63-97'>whether</span><span class='token pointer' id='tok-63-98'>our</span><span class='token pointer' id='tok-63-99'>input</span><span class='token pointer' id='tok-63-100'>matches</span><span class='token pointer' id='tok-63-101'>to</span><span class='token pointer' id='tok-63-102'>the</span><span class='token pointer' id='tok-63-103'>random()</span><span class='token pointer' id='tok-63-104'>number</span><span class='token pointer' id='tok-63-105'>generated</span><span class='token pointer' id='tok-63-106'>by</span><span class='token pointer' id='tok-63-107'>comparing</span><span class='token pointer' id='tok-63-108'>our</span><span class='token pointer' id='tok-63-109' style='color:red'>raw input</span><span class='token pointer' id='tok-63-110'>random</span><span class='token pointer' id='tok-63-111'>number</span><span class='token pointer' id='tok-63-112'>generated</span><span class='token pointer' id='tok-63-113'>previously.</span></p><p id=p134><span class='token pointer' id='tok-63-114'>Our</span><span class='token pointer' id='tok-63-115'>logic</span><span class='token pointer' id='tok-63-116'>for</span><span class='token pointer' id='tok-63-117'>solving</span><span class='token pointer' id='tok-63-118'>this</span><span class='token pointer' id='tok-63-119'>challenge</span><span class='token pointer' id='tok-63-120'>will</span><span class='token pointer' id='tok-63-121'>be</span><span class='token pointer' id='tok-63-122'>composed</span><span class='token pointer' id='tok-63-123'>of</span><span class='token pointer' id='tok-63-124'>following</span><span class='token pointer' id='tok-63-125'>steps:</span></p><p id=p146><span class='token pointer' id='tok-63-126' style='color:red'>Connect to serverRecv()</span><span class='token pointer' id='tok-63-127' style='color:red'>dataParse</span><span class='token pointer' id='tok-63-128'>the</span><span class='token pointer' id='tok-63-129'>data</span><span class='token pointer' id='tok-63-130'>and</span><span class='token pointer' id='tok-63-131'>take</span><span class='token pointer' id='tok-63-132'>out</span><span class='token pointer' id='tok-63-133'>the</span><span class='token pointer' id='tok-63-134'>random</span><span class='token pointer' id='tok-63-135'>number</span><span class='token pointer' id='tok-63-136'>ask</span><span class='token pointer' id='tok-63-137'>by</span><span class='token pointer' id='tok-63-138'>the</span><span class='token pointer' id='tok-63-139' style='color:red'>applicationPack</span><span class='token pointer' id='tok-63-140'>the</span><span class='token pointer' id='tok-63-141'>random</span><span class='token pointer' id='tok-63-142'>number</span><span class='token pointer' id='tok-63-143'>in</span><span class='token pointer' id='tok-63-144' style='color:red'>little-endian format</span><span class='token pointer' id='tok-63-145'>send</span><span class='token pointer' id='tok-63-146'>it</span><span class='token pointer' id='tok-63-147'>back.Using</span><span class='token pointer' id='tok-63-148'>the</span><span class='token pointer' id='tok-63-149'>logic</span><span class='token pointer' id='tok-63-150'>listed</span><span class='token pointer' id='tok-63-151'>above,</span><span class='token pointer' id='tok-63-152'>we</span><span class='token pointer' id='tok-63-153'>came</span><span class='token pointer' id='tok-63-154'>up</span><span class='token pointer' id='tok-63-155'>with</span><span class='token pointer' id='tok-63-156'>the</span><span class='token pointer' id='tok-63-157'>following</span><span class='token pointer' id='tok-63-158'>piece</span><span class='token pointer' id='tok-63-159'>of</span><span class='token pointer' id='tok-63-160'>code</span><span class='token pointer' id='tok-63-161'>and</span><span class='token pointer' id='tok-63-162'>successfully</span><span class='token pointer' id='tok-63-163'>passed</span><span class='token pointer' id='tok-63-164'>this</span><span class='token pointer' id='tok-63-165'>challenge.</span></p><p id=p191><span class='token pointer' id='tok-63-166' style='color:red'>Net 1By</span><span class='token pointer' id='tok-63-167'>at</span><span class='token pointer' id='tok-63-168'>the</span><span class='token pointer' id='tok-63-169'>disassembled</span><span class='token pointer' id='tok-63-170'>code</span><span class='token pointer' id='tok-63-171'>of</span><span class='token pointer' id='tok-63-172' style='color:red'>binary Net1,</span><span class='token pointer' id='tok-63-173'>can</span><span class='token pointer' id='tok-63-174'>understand</span><span class='token pointer' id='tok-63-175'>following</span><span class='token pointer' id='tok-63-176'>things:</span></p><p id=p206><span class='token pointer' id='tok-63-177'>The</span><span class='token pointer' id='tok-63-178'>program</span><span class='token pointer' id='tok-63-179'>generates</span><span class='token pointer' id='tok-63-180'>a</span><span class='token pointer' id='tok-63-181'>random</span><span class='token pointer' id='tok-63-182'>number</span><span class='token pointer' id='tok-63-183'>and</span><span class='token pointer' id='tok-63-184'>stores</span><span class='token pointer' id='tok-63-185'>the</span><span class='token pointer' id='tok-63-186' style='color:red'>integer</span><span class='token pointer' id='tok-63-187'>as</span><span class='token pointer' id='tok-63-188'>a</span><span class='token pointer' id='tok-63-189'>string</span><span class='token pointer' id='tok-63-190'>at</span><span class='token pointer' id='tok-63-191' style='color:red'>ebp-0x24.It</span><span class='token pointer' id='tok-63-192'>then</span><span class='token pointer' id='tok-63-193'>writes</span><span class='token pointer' id='tok-63-194'>the</span><span class='token pointer' id='tok-63-195'>content</span><span class='token pointer' id='tok-63-196'>of</span><span class='token pointer' id='tok-63-197'>number</span><span class='token pointer' id='tok-63-198'>generated</span><span class='token pointer' id='tok-63-199'>to</span><span class='token pointer' id='tok-63-200' style='color:red'>stdout.It</span><span class='token pointer' id='tok-63-201'>then</span><span class='token pointer' id='tok-63-202'>takes</span><span class='token pointer' id='tok-63-203'>input</span><span class='token pointer' id='tok-63-204'>from</span><span class='token pointer' id='tok-63-205'>user</span><span class='token pointer' id='tok-63-206'>removes</span><span class='token pointer' id='tok-63-207' style='color:red'>CRLF characters</span><span class='token pointer' id='tok-63-208'>compare</span><span class='token pointer' id='tok-63-209'>the</span><span class='token pointer' id='tok-63-210'>input</span><span class='token pointer' id='tok-63-211'>with</span><span class='token pointer' id='tok-63-212'>the</span><span class='token pointer' id='tok-63-213'>contents</span><span class='token pointer' id='tok-63-214'>of</span><span class='token pointer' id='tok-63-215' style='color:red'>ebp-0x24</span><span class='token pointer' id='tok-63-216'>variable</span><span class='token pointer' id='tok-63-217'>saved</span><span class='token pointer' id='tok-63-218'>earlier.As</span><span class='token pointer' id='tok-63-219'>in</span><span class='token pointer' id='tok-63-220'>this</span><span class='token pointer' id='tok-63-221'>case,</span><span class='token pointer' id='tok-63-222'>the</span><span class='token pointer' id='tok-63-223' style='color:red'>data</span><span class='token pointer' id='tok-63-224'>is</span><span class='token pointer' id='tok-63-225'>already</span><span class='token pointer' id='tok-63-226'>packed</span><span class='token pointer' id='tok-63-227'>in</span><span class='token pointer' id='tok-63-228' style='color:red'>32-bit integers.</span><span class='token pointer' id='tok-63-229'>will</span><span class='token pointer' id='tok-63-230'>be</span><span class='token pointer' id='tok-63-231'>using</span><span class='token pointer' id='tok-63-232'>similar</span><span class='token pointer' id='tok-63-233'>logic</span><span class='token pointer' id='tok-63-234'>from</span><span class='token pointer' id='tok-63-235'>the</span><span class='token pointer' id='tok-63-236' style='color:red'>NET0</span><span class='token pointer' id='tok-63-237'>level</span><span class='token pointer' id='tok-63-238'>and</span><span class='token pointer' id='tok-63-239'>after</span><span class='token pointer' id='tok-63-240'>receiving</span><span class='token pointer' id='tok-63-241'>the</span><span class='token pointer' id='tok-63-242'>data</span><span class='token pointer' id='tok-63-243'>we</span><span class='token pointer' id='tok-63-244'>will</span><span class='token pointer' id='tok-63-245'>be</span><span class='token pointer' id='tok-63-246'>unpacking</span><span class='token pointer' id='tok-63-247'>it</span><span class='token pointer' id='tok-63-248'>to</span><span class='token pointer' id='tok-63-249'>32-bit</span><span class='token pointer' id='tok-63-250'>integer</span><span class='token pointer' id='tok-63-251'>and</span><span class='token pointer' id='tok-63-252'>send</span><span class='token pointer' id='tok-63-253'>the</span><span class='token pointer' id='tok-63-254'>unpacked</span><span class='token pointer' id='tok-63-255'>value</span><span class='token pointer' id='tok-63-256'>back</span><span class='token pointer' id='tok-63-257'>as</span><span class='token pointer' id='tok-63-258'>it</span><span class='token pointer' id='tok-63-259'>is.</span></p><p id=p293><span class='token pointer' id='tok-63-260'>Finally,</span><span class='token pointer' id='tok-63-261'>we</span><span class='token pointer' id='tok-63-262'>came</span><span class='token pointer' id='tok-63-263'>up</span><span class='token pointer' id='tok-63-264'>with</span><span class='token pointer' id='tok-63-265'>following</span><span class='token pointer' id='tok-63-266'>piece</span><span class='token pointer' id='tok-63-267'>of</span><span class='token pointer' id='tok-63-268'>code</span><span class='token pointer' id='tok-63-269'>that</span><span class='token pointer' id='tok-63-270'>will</span><span class='token pointer' id='tok-63-271'>solve</span><span class='token pointer' id='tok-63-272'>this</span><span class='token pointer' id='tok-63-273'>challenge.</span></p><p id=p307><span class='token pointer' id='tok-63-274' style='color:red'>Net 2By</span><span class='token pointer' id='tok-63-275'>at</span><span class='token pointer' id='tok-63-276'>the</span><span class='token pointer' id='tok-63-277'>disassembled</span><span class='token pointer' id='tok-63-278'>code</span><span class='token pointer' id='tok-63-279'>of</span><span class='token pointer' id='tok-63-280' style='color:red'>binary Net2,</span><span class='token pointer' id='tok-63-281'>can</span><span class='token pointer' id='tok-63-282'>understand</span><span class='token pointer' id='tok-63-283'>following</span><span class='token pointer' id='tok-63-284'>things:</span></p><p id=p322><span class='token pointer' id='tok-63-285'>The</span><span class='token pointer' id='tok-63-286'>application</span><span class='token pointer' id='tok-63-287'>generates</span><span class='token pointer' id='tok-63-288'>four</span><span class='token pointer' id='tok-63-289'>random</span><span class='token pointer' id='tok-63-290'>numbers</span><span class='token pointer' id='tok-63-291'>and</span><span class='token pointer' id='tok-63-292'>sends</span><span class='token pointer' id='tok-63-293'>in</span><span class='token pointer' id='tok-63-294'>four</span><span class='token pointer' id='tok-63-295' style='color:red'>iterations using</span><span class='token pointer' id='tok-63-296'>().</span><span class='token pointer' id='tok-63-297'>It</span><span class='token pointer' id='tok-63-298'>also</span><span class='token pointer' id='tok-63-299'>keeps</span><span class='token pointer' id='tok-63-300'>on</span><span class='token pointer' id='tok-63-301'>adding</span><span class='token pointer' id='tok-63-302'>them</span><span class='token pointer' id='tok-63-303'>and</span><span class='token pointer' id='tok-63-304'>stores</span><span class='token pointer' id='tok-63-305'>the</span><span class='token pointer' id='tok-63-306'>overall</span><span class='token pointer' id='tok-63-307'>result</span><span class='token pointer' id='tok-63-308'>at</span><span class='token pointer' id='tok-63-309' style='color:red'>ebp-0xc.</span><span class='token pointer' id='tok-63-310'>As</span><span class='token pointer' id='tok-63-311'>a</span><span class='token pointer' id='tok-63-312'>result</span><span class='token pointer' id='tok-63-313'>might</span><span class='token pointer' id='tok-63-314'>overflow</span><span class='token pointer' id='tok-63-315'>its</span><span class='token pointer' id='tok-63-316'>limit,</span><span class='token pointer' id='tok-63-317'>it</span><span class='token pointer' id='tok-63-318'>will</span><span class='token pointer' id='tok-63-319'>wrap,</span><span class='token pointer' id='tok-63-320'>so</span><span class='token pointer' id='tok-63-321'>we</span><span class='token pointer' id='tok-63-322'>need</span><span class='token pointer' id='tok-63-323'>to</span><span class='token pointer' id='tok-63-324'>take</span><span class='token pointer' id='tok-63-325'>care</span><span class='token pointer' id='tok-63-326'>of</span><span class='token pointer' id='tok-63-327'>that</span><span class='token pointer' id='tok-63-328'>in</span><span class='token pointer' id='tok-63-329'>our</span><span class='token pointer' id='tok-63-330'>code</span><span class='token pointer' id='tok-63-331'>too.</span><span class='token pointer' id='tok-63-332'>Finally,</span><span class='token pointer' id='tok-63-333'>it</span><span class='token pointer' id='tok-63-334'>checks</span><span class='token pointer' id='tok-63-335'>the</span><span class='token pointer' id='tok-63-336'>input</span><span class='token pointer' id='tok-63-337'>provided</span><span class='token pointer' id='tok-63-338'>by</span><span class='token pointer' id='tok-63-339'>the</span><span class='token pointer' id='tok-63-340'>user</span><span class='token pointer' id='tok-63-341'>matches</span><span class='token pointer' id='tok-63-342'>the</span><span class='token pointer' id='tok-63-343'>added</span><span class='token pointer' id='tok-63-344'>numbers,</span><span class='token pointer' id='tok-63-345'>so</span><span class='token pointer' id='tok-63-346'>we</span><span class='token pointer' id='tok-63-347'>need</span><span class='token pointer' id='tok-63-348'>to</span><span class='token pointer' id='tok-63-349'>pack</span><span class='token pointer' id='tok-63-350'>our</span><span class='token pointer' id='tok-63-351'>input</span><span class='token pointer' id='tok-63-352'>to</span><span class='token pointer' id='tok-63-353'>an</span><span class='token pointer' id='tok-63-354'>unsigned</span><span class='token pointer' id='tok-63-355'>int</span><span class='token pointer' id='tok-63-356'>to</span><span class='token pointer' id='tok-63-357'>take</span><span class='token pointer' id='tok-63-358'>care</span><span class='token pointer' id='tok-63-359'>of</span><span class='token pointer' id='tok-63-360'>that.</span></p><p id=p400><span class='token pointer' id='tok-63-361'>We</span><span class='token pointer' id='tok-63-362'>came</span><span class='token pointer' id='tok-63-363'>up</span><span class='token pointer' id='tok-63-364'>with</span><span class='token pointer' id='tok-63-365'>the</span><span class='token pointer' id='tok-63-366'>following</span><span class='token pointer' id='tok-63-367'>piece</span><span class='token pointer' id='tok-63-368'>of</span><span class='token pointer' id='tok-63-369'>code</span><span class='token pointer' id='tok-63-370'>to</span><span class='token pointer' id='tok-63-371'>solve</span><span class='token pointer' id='tok-63-372'>this</span><span class='token pointer' id='tok-63-373'>challenge</span><span class='token pointer' id='tok-63-374'>using</span><span class='token pointer' id='tok-63-375'>the</span><span class='token pointer' id='tok-63-376'>following</span><span class='token pointer' id='tok-63-377'>algorithm:</span></p><p id=p417><span class='token pointer' id='tok-63-378'>Connect</span><span class='token pointer' id='tok-63-379'>to</span><span class='token pointer' id='tok-63-380'>the</span><span class='token pointer' id='tok-63-381' style='color:red'>server.recv ()</span><span class='token pointer' id='tok-63-382' style='color:red'>bytes</span><span class='token pointer' id='tok-63-383'>of</span><span class='token pointer' id='tok-63-384'>data</span><span class='token pointer' id='tok-63-385'>from</span><span class='token pointer' id='tok-63-386'>the</span><span class='token pointer' id='tok-63-387'>server</span><span class='token pointer' id='tok-63-388'>iteratively</span><span class='token pointer' id='tok-63-389'>four</span><span class='token pointer' id='tok-63-390'>times</span><span class='token pointer' id='tok-63-391'>and</span><span class='token pointer' id='tok-63-392'>add</span><span class='token pointer' id='tok-63-393' style='color:red'>them.DO an AND operation</span><span class='token pointer' id='tok-63-394'>the</span><span class='token pointer' id='tok-63-395'>final</span><span class='token pointer' id='tok-63-396'>sum,</span><span class='token pointer' id='tok-63-397'>so</span><span class='token pointer' id='tok-63-398'>the</span><span class='token pointer' id='tok-63-399'>result</span><span class='token pointer' id='tok-63-400'>stays</span><span class='token pointer' id='tok-63-401'>in</span><span class='token pointer' id='tok-63-402' style='color:red'>32 unsigned int's range.Pack</span><span class='token pointer' id='tok-63-403'>result</span><span class='token pointer' id='tok-63-404'>and</span><span class='token pointer' id='tok-63-405'>send</span><span class='token pointer' id='tok-63-406'>it</span><span class='token pointer' id='tok-63-407'>back</span><span class='token pointer' id='tok-63-408'>to</span><span class='token pointer' id='tok-63-409'>the</span><span class='token pointer' id='tok-63-410'>server.</span></p><p id=p460><span class='token pointer' id='tok-63-411'>This</span><span class='token pointer' id='tok-63-412'>level</span><span class='token pointer' id='tok-63-413'>takes</span><span class='token pointer' id='tok-63-414'>us</span><span class='token pointer' id='tok-63-415'>back</span><span class='token pointer' id='tok-63-416'>to</span><span class='token pointer' id='tok-63-417' style='color:red'>simple stack based buffer overflows</span><span class='token pointer' id='tok-63-418'>little</span><span class='token pointer' id='tok-63-419'>restrictions</span><span class='token pointer' id='tok-63-420'>added</span><span class='token pointer' id='tok-63-421'>here</span><span class='token pointer' id='tok-63-422'>and</span><span class='token pointer' id='tok-63-423'>there.</span><span class='token pointer' id='tok-63-424'>Let's</span><span class='token pointer' id='tok-63-425'>have</span><span class='token pointer' id='tok-63-426'>a</span><span class='token pointer' id='tok-63-427'>look</span><span class='token pointer' id='tok-63-428'>at</span><span class='token pointer' id='tok-63-429'>the</span><span class='token pointer' id='tok-63-430'>disassembled</span><span class='token pointer' id='tok-63-431'>code</span><span class='token pointer' id='tok-63-432'>for</span><span class='token pointer' id='tok-63-433'>this</span><span class='token pointer' id='tok-63-434'>level.</span><span class='token pointer' id='tok-63-435'>By</span><span class='token pointer' id='tok-63-436'>looking</span><span class='token pointer' id='tok-63-437'>at</span><span class='token pointer' id='tok-63-438'>the</span><span class='token pointer' id='tok-63-439'>code</span><span class='token pointer' id='tok-63-440'>we</span><span class='token pointer' id='tok-63-441'>can</span><span class='token pointer' id='tok-63-442'>quickly</span><span class='token pointer' id='tok-63-443'>figure</span><span class='token pointer' id='tok-63-444'>out</span><span class='token pointer' id='tok-63-445'>the</span><span class='token pointer' id='tok-63-446'>vulnerable</span><span class='token pointer' id='tok-63-447' style='color:red'>function gets()</span><span class='token pointer' id='tok-63-448'>used</span><span class='token pointer' id='tok-63-449'>but</span><span class='token pointer' id='tok-63-450'>the</span><span class='token pointer' id='tok-63-451'>problem</span><span class='token pointer' id='tok-63-452'>is</span><span class='token pointer' id='tok-63-453'>our</span><span class='token pointer' id='tok-63-454'>input</span><span class='token pointer' id='tok-63-455'>gets</span><span class='token pointer' id='tok-63-456'>passed</span><span class='token pointer' id='tok-63-457'>through</span><span class='token pointer' id='tok-63-458'>the</span><span class='token pointer' id='tok-63-459'>for</span><span class='token pointer' id='tok-63-460'>loop</span><span class='token pointer' id='tok-63-461'>which</span><span class='token pointer' id='tok-63-462'>iterates</span><span class='token pointer' id='tok-63-463'>each</span><span class='token pointer' id='tok-63-464'>of</span><span class='token pointer' id='tok-63-465'>our</span><span class='token pointer' id='tok-63-466'>provided</span><span class='token pointer' id='tok-63-467'>bytes</span><span class='token pointer' id='tok-63-468'>thus</span><span class='token pointer' id='tok-63-469'>it</span><span class='token pointer' id='tok-63-470'>will</span><span class='token pointer' id='tok-63-471'>corrupt</span><span class='token pointer' id='tok-63-472'>any</span></p><p id=p532><span class='token pointer' id='tok-63-473'>So,</span><span class='token pointer' id='tok-63-474'>let's</span><span class='token pointer' id='tok-63-475'>start</span><span class='token pointer' id='tok-63-476'>with</span><span class='token pointer' id='tok-63-477'>fuzzing</span><span class='token pointer' id='tok-63-478'>the</span><span class='token pointer' id='tok-63-479'>application</span><span class='token pointer' id='tok-63-480'>and</span><span class='token pointer' id='tok-63-481'>figuring</span><span class='token pointer' id='tok-63-482'>out</span><span class='token pointer' id='tok-63-483'>the</span><span class='token pointer' id='tok-63-484' style='color:red'>offset to EIP.</span><span class='token pointer' id='tok-63-485'>we</span><span class='token pointer' id='tok-63-486'>use</span><span class='token pointer' id='tok-63-487' style='color:red'>Python's</span><span class='token pointer' id='tok-63-488' style='color:red'>pwntools library</span><span class='token pointer' id='tok-63-489'>generating</span><span class='token pointer' id='tok-63-490'>a</span><span class='token pointer' id='tok-63-491' style='color:red'>cyclic pattern</span><span class='token pointer' id='tok-63-492'>end</span><span class='token pointer' id='tok-63-493'>up</span><span class='token pointer' id='tok-63-494'>with</span><span class='token pointer' id='tok-63-495'>following</span><span class='token pointer' id='tok-63-496'>snippet</span><span class='token pointer' id='tok-63-497'>of</span><span class='token pointer' id='tok-63-498'>code.</span></p><p id=p565><span class='token pointer' id='tok-63-499'>An</span><span class='token pointer' id='tok-63-500'>observant</span><span class='token pointer' id='tok-63-501'>user</span><span class='token pointer' id='tok-63-502'>must</span><span class='token pointer' id='tok-63-503'>have</span><span class='token pointer' id='tok-63-504'>noticed</span><span class='token pointer' id='tok-63-505'>that</span><span class='token pointer' id='tok-63-506'>application</span><span class='token pointer' id='tok-63-507'>is</span><span class='token pointer' id='tok-63-508'>using</span><span class='token pointer' id='tok-63-509' style='color:red'>forking technique</span><span class='token pointer' id='tok-63-510'>serve</span><span class='token pointer' id='tok-63-511'>connections</span><span class='token pointer' id='tok-63-512'>thus</span><span class='token pointer' id='tok-63-513'>debugging</span><span class='token pointer' id='tok-63-514'>using</span><span class='token pointer' id='tok-63-515'>process</span><span class='token pointer' id='tok-63-516'>id</span><span class='token pointer' id='tok-63-517'>will</span><span class='token pointer' id='tok-63-518'>not</span><span class='token pointer' id='tok-63-519'>work</span><span class='token pointer' id='tok-63-520'>for</span><span class='token pointer' id='tok-63-521' style='color:red'>runtime analysis.</span><span class='token pointer' id='tok-63-522'>we</span><span class='token pointer' id='tok-63-523'>need</span><span class='token pointer' id='tok-63-524'>to</span><span class='token pointer' id='tok-63-525'>debug</span><span class='token pointer' id='tok-63-526' style='color:red'>child process.</span><span class='token pointer' id='tok-63-527'>placed</span><span class='token pointer' id='tok-63-528'>a</span><span class='token pointer' id='tok-63-529'>breakpoint</span><span class='token pointer' id='tok-63-530'>after</span><span class='token pointer' id='tok-63-531' style='color:red'>strdup (0x0804982a)</span><span class='token pointer' id='tok-63-532'>started</span><span class='token pointer' id='tok-63-533'>analyzing</span><span class='token pointer' id='tok-63-534'>the</span><span class='token pointer' id='tok-63-535'>state</span><span class='token pointer' id='tok-63-536'>of</span><span class='token pointer' id='tok-63-537'>the</span><span class='token pointer' id='tok-63-538'>process.</span></p><p id=p613><span class='token pointer' id='tok-63-539'>As</span><span class='token pointer' id='tok-63-540'>we</span><span class='token pointer' id='tok-63-541'>will</span><span class='token pointer' id='tok-63-542'>need</span><span class='token pointer' id='tok-63-543'>to</span><span class='token pointer' id='tok-63-544'>debug</span><span class='token pointer' id='tok-63-545'>the</span><span class='token pointer' id='tok-63-546'>same</span><span class='token pointer' id='tok-63-547'>process</span><span class='token pointer' id='tok-63-548'>multiple</span><span class='token pointer' id='tok-63-549'>times</span><span class='token pointer' id='tok-63-550'>so</span><span class='token pointer' id='tok-63-551'>it</span><span class='token pointer' id='tok-63-552'>will</span><span class='token pointer' id='tok-63-553'>be</span><span class='token pointer' id='tok-63-554'>a</span><span class='token pointer' id='tok-63-555'>bit</span><span class='token pointer' id='tok-63-556'>painful</span><span class='token pointer' id='tok-63-557'>to</span><span class='token pointer' id='tok-63-558'>set</span><span class='token pointer' id='tok-63-559' style='color:red'>gdb commands</span><span class='token pointer' id='tok-63-560'>time,</span><span class='token pointer' id='tok-63-561'>therefore</span><span class='token pointer' id='tok-63-562'>we</span><span class='token pointer' id='tok-63-563'>will</span><span class='token pointer' id='tok-63-564'>be</span><span class='token pointer' id='tok-63-565'>using</span><span class='token pointer' id='tok-63-566'>the</span><span class='token pointer' id='tok-63-567' style='color:red'>.gdbinit</span><span class='token pointer' id='tok-63-568'>file</span><span class='token pointer' id='tok-63-569'>for</span><span class='token pointer' id='tok-63-570'>the</span><span class='token pointer' id='tok-63-571'>sake</span><span class='token pointer' id='tok-63-572'>of</span><span class='token pointer' id='tok-63-573' style='color:red'>automation.</span></p><p id=p650><span class='token pointer' id='tok-63-574'>After</span><span class='token pointer' id='tok-63-575'>editing</span><span class='token pointer' id='tok-63-576'>the</span><span class='token pointer' id='tok-63-577' style='color:red'>.gdbinit file and</span><span class='token pointer' id='tok-63-578'>our</span><span class='token pointer' id='tok-63-579' style='color:red'>fuzz string</span><span class='token pointer' id='tok-63-580'>got</span><span class='token pointer' id='tok-63-581'>an</span><span class='token pointer' id='tok-63-582' style='color:red'>$eip overwrite</span><span class='token pointer' id='tok-63-583' style='color:red'>0x46414149,</span><span class='token pointer' id='tok-63-584'>our</span><span class='token pointer' id='tok-63-585'>input</span><span class='token pointer' id='tok-63-586'>is</span><span class='token pointer' id='tok-63-587'>placed</span><span class='token pointer' id='tok-63-588'>on</span><span class='token pointer' id='tok-63-589'>the</span><span class='token pointer' id='tok-63-590'>stack</span><span class='token pointer' id='tok-63-591'>and</span><span class='token pointer' id='tok-63-592' style='color:red'>$eax</span><span class='token pointer' id='tok-63-593'>points</span><span class='token pointer' id='tok-63-594'>to</span><span class='token pointer' id='tok-63-595'>some</span><span class='token pointer' id='tok-63-596'>part</span><span class='token pointer' id='tok-63-597'>of</span><span class='token pointer' id='tok-63-598'>our</span><span class='token pointer' id='tok-63-599'>shellcode</span><span class='token pointer' id='tok-63-600'>mainly</span><span class='token pointer' id='tok-63-601'>from</span><span class='token pointer' id='tok-63-602'>the</span><span class='token pointer' id='tok-63-603'>start</span><span class='token pointer' id='tok-63-604'>because</span><span class='token pointer' id='tok-63-605'>of</span><span class='token pointer' id='tok-63-606' style='color:red'>strdup() function</span><span class='token pointer' id='tok-63-607'>returns</span><span class='token pointer' id='tok-63-608'>in</span><span class='token pointer' id='tok-63-609'>$eax.</span><span class='token pointer' id='tok-63-610'>We</span><span class='token pointer' id='tok-63-611'>further</span><span class='token pointer' id='tok-63-612'>used</span><span class='token pointer' id='tok-63-613' style='color:red'>cyclic_find function</span><span class='token pointer' id='tok-63-614' style='color:red'>pwntools</span><span class='token pointer' id='tok-63-615'>to</span><span class='token pointer' id='tok-63-616'>get</span><span class='token pointer' id='tok-63-617'>offset</span><span class='token pointer' id='tok-63-618'>to</span><span class='token pointer' id='tok-63-619'>$eip</span><span class='token pointer' id='tok-63-620'>at</span><span class='token pointer' id='tok-63-621'>532.</span></p><p id=p709><span class='token pointer' id='tok-63-622'>Ethical</span><span class='token pointer' id='tok-63-623'>Hacking</span><span class='token pointer' id='tok-63-624'>Training</span><span class='token pointer' id='tok-63-625'>â€“</span><span class='token pointer' id='tok-63-626'>Resources</span><span class='token pointer' id='tok-63-627'>(InfoSec)</span></p><p id=p715><span class='token pointer' id='tok-63-628'>Now</span><span class='token pointer' id='tok-63-629'>there</span><span class='token pointer' id='tok-63-630'>are</span><span class='token pointer' id='tok-63-631'>multiple</span><span class='token pointer' id='tok-63-632'>options</span><span class='token pointer' id='tok-63-633'>for</span><span class='token pointer' id='tok-63-634'>writing</span><span class='token pointer' id='tok-63-635'>exploit</span><span class='token pointer' id='tok-63-636'>for</span><span class='token pointer' id='tok-63-637'>this</span><span class='token pointer' id='tok-63-638'>program:</span></p><p id=p726><span class='token pointer' id='tok-63-639' style='color:red'>Return to register: call eax</span><span class='token pointer' id='tok-63-640'>Alpha</span><span class='token pointer' id='tok-63-641'>upper</span><span class='token pointer' id='tok-63-642' style='color:red'>shellcode)Jump</span><span class='token pointer' id='tok-63-643'>to</span><span class='token pointer' id='tok-63-644'>stack:</span><span class='token pointer' id='tok-63-645'>At</span><span class='token pointer' id='tok-63-646'>the</span><span class='token pointer' id='tok-63-647'>time</span><span class='token pointer' id='tok-63-648'>of</span><span class='token pointer' id='tok-63-649'>the</span><span class='token pointer' id='tok-63-650'>crash,</span><span class='token pointer' id='tok-63-651'>no</span><span class='token pointer' id='tok-63-652'>pointers</span><span class='token pointer' id='tok-63-653'>to</span><span class='token pointer' id='tok-63-654'>our</span><span class='token pointer' id='tok-63-655'>shellcode</span><span class='token pointer' id='tok-63-656'>were</span><span class='token pointer' id='tok-63-657'>present</span><span class='token pointer' id='tok-63-658'>on</span><span class='token pointer' id='tok-63-659'>the</span><span class='token pointer' id='tok-63-660'>stack</span><span class='token pointer' id='tok-63-661'>we</span><span class='token pointer' id='tok-63-662'>need</span><span class='token pointer' id='tok-63-663'>to</span><span class='token pointer' id='tok-63-664'>rely</span><span class='token pointer' id='tok-63-665'>on</span><span class='token pointer' id='tok-63-666'>the</span><span class='token pointer' id='tok-63-667'>hardcoded</span><span class='token pointer' id='tok-63-668'>address</span><span class='token pointer' id='tok-63-669'>(Not</span><span class='token pointer' id='tok-63-670'>a</span><span class='token pointer' id='tok-63-671'>reliable</span><span class='token pointer' id='tok-63-672'>way).</span><span class='token pointer' id='tok-63-673'>Also,</span><span class='token pointer' id='tok-63-674'>we</span><span class='token pointer' id='tok-63-675'>do</span><span class='token pointer' id='tok-63-676'>not</span><span class='token pointer' id='tok-63-677'>need</span><span class='token pointer' id='tok-63-678'>alphanumeric</span><span class='token pointer' id='tok-63-679'>shellcode</span><span class='token pointer' id='tok-63-680'>in</span><span class='token pointer' id='tok-63-681'>this</span><span class='token pointer' id='tok-63-682'>case</span><span class='token pointer' id='tok-63-683'>as</span><span class='token pointer' id='tok-63-684'>gets</span><span class='token pointer' id='tok-63-685'>will</span><span class='token pointer' id='tok-63-686'>copying</span><span class='token pointer' id='tok-63-687'>our</span><span class='token pointer' id='tok-63-688'>input</span><span class='token pointer' id='tok-63-689'>into</span><span class='token pointer' id='tok-63-690' style='color:red'>buffer</span><span class='token pointer' id='tok-63-691'>after</span><span class='token pointer' id='tok-63-692'>it</span><span class='token pointer' id='tok-63-693'>meets</span><span class='token pointer' id='tok-63-694'>a</span><span class='token pointer' id='tok-63-695'>null</span><span class='token pointer' id='tok-63-696'>bytes</span><span class='token pointer' id='tok-63-697' style='color:red'>(\x00).ROP Chain via ret2libc:</span><span class='token pointer' id='tok-63-698'>there</span><span class='token pointer' id='tok-63-699'>is</span><span class='token pointer' id='tok-63-700'>no</span><span class='token pointer' id='tok-63-701' style='color:red'>ASLR</span><span class='token pointer' id='tok-63-702'>enabled</span><span class='token pointer' id='tok-63-703'>on</span><span class='token pointer' id='tok-63-704'>the</span><span class='token pointer' id='tok-63-705'>system</span><span class='token pointer' id='tok-63-706'>we</span><span class='token pointer' id='tok-63-707'>can</span><span class='token pointer' id='tok-63-708'>rely</span><span class='token pointer' id='tok-63-709'>on</span><span class='token pointer' id='tok-63-710'>the</span><span class='token pointer' id='tok-63-711'>PLT</span><span class='token pointer' id='tok-63-712'>address</span><span class='token pointer' id='tok-63-713'>from</span><span class='token pointer' id='tok-63-714'>the</span><span class='token pointer' id='tok-63-715'>executable</span><span class='token pointer' id='tok-63-716'>itself</span><span class='token pointer' id='tok-63-717'>construct</span><span class='token pointer' id='tok-63-718'>a</span><span class='token pointer' id='tok-63-719'>simple</span><span class='token pointer' id='tok-63-720'>ROP</span><span class='token pointer' id='tok-63-721'>chain.</span><span class='token pointer' id='tok-63-722'>(Reliable</span><span class='token pointer' id='tok-63-723'>unless</span><span class='token pointer' id='tok-63-724'>ASLR</span><span class='token pointer' id='tok-63-725'>is</span><span class='token pointer' id='tok-63-726'>enabled</span><span class='token pointer' id='tok-63-727'>even</span><span class='token pointer' id='tok-63-728'>in</span><span class='token pointer' id='tok-63-729'>that</span><span class='token pointer' id='tok-63-730'>case</span><span class='token pointer' id='tok-63-731'>we</span><span class='token pointer' id='tok-63-732'>need</span><span class='token pointer' id='tok-63-733'>to</span><span class='token pointer' id='tok-63-734'>modify</span><span class='token pointer' id='tok-63-735'>our</span><span class='token pointer' id='tok-63-736'>shellcode</span><span class='token pointer' id='tok-63-737'>to</span><span class='token pointer' id='tok-63-738'>make</span><span class='token pointer' id='tok-63-739'>it</span><span class='token pointer' id='tok-63-740'>work</span><span class='token pointer' id='tok-63-741'>again</span><span class='token pointer' id='tok-63-742'>slightly)Our</span><span class='token pointer' id='tok-63-743'>ROP</span><span class='token pointer' id='tok-63-744'>chain</span><span class='token pointer' id='tok-63-745'>will</span><span class='token pointer' id='tok-63-746'>do</span><span class='token pointer' id='tok-63-747'>the</span><span class='token pointer' id='tok-63-748'>following:</span></p><p id=p845><span class='token pointer' id='tok-63-749'>Read</span><span class='token pointer' id='tok-63-750'>the</span><span class='token pointer' id='tok-63-751'>contents</span><span class='token pointer' id='tok-63-752'>of</span><span class='token pointer' id='tok-63-753'>system</span><span class='token pointer' id='tok-63-754'>command</span><span class='token pointer' id='tok-63-755'>in</span><span class='token pointer' id='tok-63-756'>.dynamic</span><span class='token pointer' id='tok-63-757'>section.Pass</span><span class='token pointer' id='tok-63-758'>the</span><span class='token pointer' id='tok-63-759'>pointer</span><span class='token pointer' id='tok-63-760'>of</span><span class='token pointer' id='tok-63-761'>.dynamic</span><span class='token pointer' id='tok-63-762'>to</span><span class='token pointer' id='tok-63-763'>execve.</span></p><p id=p860><span class='token pointer' id='tok-63-764'>As</span><span class='token pointer' id='tok-63-765'>we</span><span class='token pointer' id='tok-63-766'>see</span><span class='token pointer' id='tok-63-767'>in</span><span class='token pointer' id='tok-63-768'>the</span><span class='token pointer' id='tok-63-769'>following</span><span class='token pointer' id='tok-63-770'>screenshot,</span><span class='token pointer' id='tok-63-771'>we</span><span class='token pointer' id='tok-63-772'>were</span><span class='token pointer' id='tok-63-773'>able</span><span class='token pointer' id='tok-63-774'>to</span><span class='token pointer' id='tok-63-775'>obtain</span><span class='token pointer' id='tok-63-776'>remote</span><span class='token pointer' id='tok-63-777'>shell</span><span class='token pointer' id='tok-63-778'>by</span><span class='token pointer' id='tok-63-779'>exploiting</span><span class='token pointer' id='tok-63-780'>final0</span><span class='token pointer' id='tok-63-781'>binary.</span></p><p id=p878><span class='token pointer' id='tok-63-782'></span><span class='token pointer' id='tok-63-783'></span><span class='token pointer' id='tok-63-784'></span><span class='token pointer' id='tok-63-785'></span></p>