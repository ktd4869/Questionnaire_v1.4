<p id=p0>Introduction: This is part 5 in the series of articles on learning <span class='token pointer' id='tok-75-0' style='color:red'>pentesting</span>with <span class='token pointer' id='tok-75-1' style='color:red'>Metasploitable3.</span>In the previous article, we discussed how <span class='token pointer' id='tok-75-2' style='color:red'>WebDAV</span>could be used to gain access to Metasploitable3. We used WebDAV <span class='token pointer' id='tok-75-3' style='color:red'>vulnerability</span>to obtain a <span class='token pointer' id='tok-75-4' style='color:red'>shell</span>both manually and using the <span class='token pointer' id='tok-75-5' style='color:red'>Metasploit</span><span class='token pointer' id='tok-75-6' style='color:red'>framework.</span>This article introduces another interesting vulnerability that can be used to gain access to Metasploitable3. </p><p id=p61>This article attempts to cover the fundamentals of pentesting a <span class='token pointer' id='tok-75-7' style='color:red'>WordPress</span><span class='token pointer' id='tok-75-8' style='color:red'>website</span>and eventually we will use those same techniques to gain access to Metasploitable3. </p><p id=p86>Following is the <span class='token pointer' id='tok-75-9' style='color:red'>nmap</span>output. </p><p id=p91>In the previous article, we noticed the presence of WordPress instance from the <span class='token pointer' id='tok-75-10' style='color:red'>preceding</span>figure. </p><p id=p106>Clicking on <span class='token pointer' id='tok-75-11' style='color:red'>wordpress</span>button under Your </p><p id=p112>Projects will show us the wordpress website running on the <span class='token pointer' id='tok-75-12' style='color:red'>target</span><span class='token pointer' id='tok-75-13' style='color:red'>server.</span></p><p id=p124>Information Gathering:Let's begin with gathering some information about the target wordpress <span class='token pointer' id='tok-75-14' style='color:red'>installation.</span></p><p id=p136>Identifying WordPress <span class='token pointer' id='tok-75-15' style='color:red'>version:WordPress</span>version can be found from a <span class='token pointer' id='tok-75-16' style='color:red'>readme.html</span><span class='token pointer' id='tok-75-17' style='color:red'>file</span>in the <span class='token pointer' id='tok-75-18' style='color:red'>root</span>of WordPress. This is shown in the preceding figure. </p><p id=p159>It is a good idea to check if the identified version has any known <span class='token pointer' id='tok-75-19' style='color:red'>vulnerabilities.</span></p><p id=p174><span class='token pointer' id='tok-75-20' style='color:red'>Directory</span>Listing:As you can see in the preceding figure, some of the directories are not protected from a <span class='token pointer' id='tok-75-21' style='color:red'>directory listing.</span>is a commonly seen issue with wordpress installations. </p><p id=p203>If directory listing is enabled, it can be useful for an <span class='token pointer' id='tok-75-22' style='color:red'>attacker</span>if it contains any <span class='token pointer' id='tok-75-23' style='color:red'>sensitive</span>files that are not normally <span class='token pointer' id='tok-75-24' style='color:red'>exposed</span>through the links. </p><p id=p229>Username <span class='token pointer' id='tok-75-25' style='color:red'>enumeration:</span>Let's see if <span class='token pointer' id='tok-75-26' style='color:red'>username</span>enumeration is possible. Username enumeration is a technique in which an attacker attempts to provide some common <span class='token pointer' id='tok-75-27' style='color:red'>usernames</span>and identifies valid usernames on the application based on the <span class='token pointer' id='tok-75-28' style='color:red'>responses/error messages</span>back from the server. </p><p id=p270>Let's begin by entering <span class='token pointer' id='tok-75-29' style='color:red'>administrator</span>in the username field and some <span class='token pointer' id='tok-75-30' style='color:red'>password</span>in the password field. </p><p id=p286>When we <span class='token pointer' id='tok-75-31' style='color:red'>click</span><span class='token pointer' id='tok-75-32' style='color:red'>Log In</span>the following is the <span class='token pointer' id='tok-75-33' style='color:red'>error message</span></p><p id=p299>This error confirms that the username administrator doesn't exist. </p><p id=p308>Now, let's try <span class='token pointer' id='tok-75-34' style='color:red'>admin</span>as username and any password. </p><p id=p317>Clicking Log In this time has shown a different error message. </p><p id=p328>From the error message, it is clear that the password entered is incorrect, but the username is valid. </p><p id=p346>Similarly, we can try other commonly used usernames and gather as many valid usernames as we can. </p><p id=p363><span class='token pointer' id='tok-75-35' style='color:red'>Enumerating</span><span class='token pointer' id='tok-75-36' style='color:red'>Plugins:Enumerating</span>installed <span class='token pointer' id='tok-75-37' style='color:red'>plugins</span>is an important test case to execute when assessing the security of a WordPress website. The installed plugins may have publicly known vulnerabilities. Manually <span class='token pointer' id='tok-75-38' style='color:red'>enumerating</span>plugins and identifying the <span class='token pointer' id='tok-75-39' style='color:red'>CVEs</span>registered against those plugins can be a <span class='token pointer' id='tok-75-40' style='color:red'>tedious</span>job. So, we can use automated scanners like <span class='token pointer' id='tok-75-41' style='color:red'>WPScan</span>for this. </p><p id=p416>WPScan is available in <span class='token pointer' id='tok-75-42' style='color:red'>Kali</span><span class='token pointer' id='tok-75-43' style='color:red'>Linux.</span>Launch a <span class='token pointer' id='tok-75-44' style='color:red'>terminal</span>and update WPScan database by running the following <span class='token pointer' id='tok-75-45' style='color:red'>command.</span></p><p id=p434>wpscan <span class='token pointer' id='tok-75-46' style='color:red'>–update</span></p><p id=p436>Run the following command after the update is complete. This command will enumerate the installed plugins. Additionally, it will check if those plugins have any known vulnerabilities. </p><p id=p463>We should see the details of the installed plugins and vulnerabilities (if any) after the enumeration is complete. </p><p id=p481>As we can see in the above figure, <span class='token pointer' id='tok-75-47' style='color:red'>Ninja</span></p><p id=p490><span class='token pointer' id='tok-75-48' style='color:red'>Forms plugin is</span>and it appears to have some critical vulnerabilities. Let's try to understand how WPScan is detecting the installed plugins before getting more details about the Ninja </p><p id=p520>Forms plugin vulnerabilities. </p><p id=p523>I have captured the packets using <span class='token pointer' id='tok-75-49' style='color:red'>Wireshark</span>while WPScan is running against Metasploitable3. The following figure shows an <span class='token pointer' id='tok-75-50' style='color:red'>HTTP request and response</span>with a plugin that's not installed on the target website. </p><p id=p556>As you can see in the above figure, WPScan has requested for <span class='token pointer' id='tok-75-51' style='color:red'>/timer-library/ plugin, and it got</span>as it's response since it is not installed. </p><p id=p582>Similarly, a request for <span class='token pointer' id='tok-75-52' style='color:red'>ninja-forms plugin</span>returned 200 OK since this plugin is installed. This is shown in the preceding figure. </p><p id=p604>Similarly, we can identify all the installed plugins. As mentioned earlier, it is time-consuming to do manually, and it is recommended to use WPScan. </p><p id=p628>Exploiting WordPress with Metasploit: Now that, WPScan reported a vulnerability in Ninja Forms, and it has also provided some useful links. A quick Google search for Ninja <span class='token pointer' id='tok-75-53' style='color:red'>Forms exploits</span>landed me at the following <span class='token pointer' id='tok-75-54' style='color:red'>Rapid7's</span>page. Ninja Forms has <span class='token pointer' id='tok-75-55' style='color:red'>Unauthenticated</span>File Upload vulnerability, and unsurprisingly, Metasploit has an exploit available for it. </p><p id=p681>When checking the module options, it is noticed that the module <span class='token pointer' id='tok-75-56' style='color:red'>requires</span>FORM_PATH as a <span class='token pointer' id='tok-75-57' style='color:red'>mandatory</span>parameter. So, I browsed the application a bit and found the following <span class='token pointer' id='tok-75-58' style='color:red'>URL.</span></p><p id=p710><span class='token pointer' id='tok-75-59' style='color:red'>http://172.28.128.3:8585/wordpress/index.php/king-of-hearts/</span></p><p id=p711>Now, let's launch Metasploit framework and run the commands shown in the preceding figure. </p><p id=p725>And then, you got a Meterpreter shell! </p><p id=p732>Exploiting WordPress without <span class='token pointer' id='tok-75-60' style='color:red'>Metasploit:Now,</span>let's see another way to exploit wordpress on Metasploitable3 and get a Meterpreter shell. </p><p id=p750>As we saw earlier, the application is prone to username enumeration. Let's use WPScan and see if we can get few more usernames. Launch a terminal and run the following command. </p><p id=p781>Interestingly, the above command has identified 3 more usernames. </p><p id=p790><span class='token pointer' id='tok-75-61' style='color:red'>Ethical Hacking Training</span>Resources <span class='token pointer' id='tok-75-62' style='color:red'>(InfoSec)</span></p><p id=p796>At this place, we can start <span class='token pointer' id='tok-75-63' style='color:red'>brute forcing</span>passwords using WPScan, but let's first manually see if the application has weak passwords. </p><p id=p819><span class='token pointer' id='tok-75-64' style='color:red'>admin:admin</span>– didn't work </p><p id=p823>vagrant:vagrant – worked </p><p id=p826>user:user – didn't work </p><p id=p830>manager:manager – worked </p><p id=p833><span class='token pointer' id='tok-75-65' style='color:red'>Logging in</span>manager account has shown very few menus as shown in the preceding figure. </p><p id=p849>Logging in with the vagrant account has more options than what we got with the manager. This is shown in the preceding figure. </p><p id=p872>We have logged in to the website, how to get a shell on the server now? </p><p id=p888>It is as simple as editing and </p><p id=p899>Let's first generate code to get <span class='token pointer' id='tok-75-66' style='color:red'>PHP meterpreter</span>using the following command. </p><p id=p912><span class='token pointer' id='tok-75-67' style='color:red'>shell.php</span></p><p id=p923>Now, open up your WordPress <span class='token pointer' id='tok-75-68' style='color:red'>dashboard</span>and navigate to </p><p id=p935>On the right side, select a <span class='token pointer' id='tok-75-69' style='color:red'>PHP file preferably header.php.</span>looks as follows. </p><p id=p949>Now, copy the <span class='token pointer' id='tok-75-70' style='color:red'>Meterpreter code</span>generated using <span class='token pointer' id='tok-75-71' style='color:red'>Msfvenom</span>and paste it at the top of the header.php code editor. This looks as follows. </p><p id=p973>The above code requires a minor modification. <span class='token pointer' id='tok-75-72' style='color:red'>Uncomment</span>at the beginning and add the <span class='token pointer' id='tok-75-73' style='color:red'>closing PHP tag</span>the end of the <span class='token pointer' id='tok-75-74' style='color:red'>meterpreter code.</span>is shown below. </p><p id=p1001>After <span class='token pointer' id='tok-75-75' style='color:red'>uncommenting</span>the beginning of your PHP code, it should look as follows. </p><p id=p1014>Similarly, add the closing PHP tag before the original theme header code. This looks as follows. </p><p id=p1030>Once these modifications are done, <span class='token pointer' id='tok-75-76' style='color:red'>save the header.php file</span>clicking Update File button. </p><p id=p1044>Now, launch Metasploit and start a <span class='token pointer' id='tok-75-77' style='color:red'>handler</span>as shown in the preceding figure. </p><p id=p1057>Go back to your browser and reload WordPress home page. </p><p id=p1067>Time to check your handler in Metasploit. </p><p id=p1074><span class='token pointer' id='tok-75-78' style='color:red'>Boom!</span>We got a reverse shell. </p><p id=p1080>Conclusion: In this article, we discussed how one could test WordPress websites for vulnerabilities. We have used Metasploitable3 as our target machine and <span class='token pointer' id='tok-75-79' style='color:red'>popped</span><span class='token pointer' id='tok-75-80' style='color:red'>shells</span>using the vulnerabilities we found. We have also seen multiple techniques that can be used against WordPress websites. These include WordPress version enumeration, plugin enumeration, username enumeration, etc. In the next article, we will discuss another way to exploit <span class='token pointer' id='tok-75-81' style='color:red'>Metaploitable3.
</span></p>