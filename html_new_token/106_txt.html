<p id=p0>In this <span class='token pointer' id='tok-106-0' style='color:red'>article,</span>we are going <span class='token pointer' id='tok-106-1' style='color:red'>to learn</span>a very <span class='token pointer' id='tok-106-2' style='color:red'>interesting</span>and powerful <span class='token pointer' id='tok-106-3' style='color:red'>technique</span>known as <span class='token pointer' id='tok-106-4' style='color:red'>Domain</span><span class='token pointer' id='tok-106-5' style='color:red'>Fronting</span>which is a <span class='token pointer' id='tok-106-6' style='color:red'>circumvention</span>technique based on <span class='token pointer' id='tok-106-7' style='color:red'>HTTPS</span><span class='token pointer' id='tok-106-8' style='color:red'>that hides the</span><span class='token pointer' id='tok-106-9' style='color:red'>destination</span>from the <span class='token pointer' id='tok-106-10' style='color:red'>censor.</span></p><p id=p35>What is Domain <span class='token pointer' id='tok-106-11' style='color:red'>Fronting?Domain</span><span class='token pointer' id='tok-106-12' style='color:red'>fronting</span>is a technique to <span class='token pointer' id='tok-106-13' style='color:red'>circumvent</span>the <span class='token pointer' id='tok-106-14' style='color:red'>censorship</span>employed for certain <span class='token pointer' id='tok-106-15' style='color:red'>domains(censorship</span>may be for <span class='token pointer' id='tok-106-16' style='color:red'>domains</span>not in line with company's policies or may be because of the bad reputation of <span class='token pointer' id='tok-106-17' style='color:red'>domains).Domain</span>fronting works at HTTPS layer and uses <span class='token pointer' id='tok-106-18' style='color:red'>different</span><span class='token pointer' id='tok-106-19' style='color:red'>domain</span>names at different <span class='token pointer' id='tok-106-20' style='color:red'>layers</span>of the <span class='token pointer' id='tok-106-21' style='color:red'>request(more</span>on this later).To the censors, it looks like the communication is happening between the client and an <span class='token pointer' id='tok-106-22' style='color:red'>allowed</span>domain whereas, in reality, the communication might be happening between the client and a blocked domain. </p><p id=p121>How Domain Fronting <span class='token pointer' id='tok-106-23' style='color:red'>WorksDomain Fronting works at HTTPS</span>and under these different requests for <span class='token pointer' id='tok-106-24' style='color:red'>hostname</span>will be different at different layers. In Domain Fronting, hostname <span class='token pointer' id='tok-106-25' style='color:red'>information</span>will be same for <span class='token pointer' id='tok-106-26' style='color:red'>DNS</span>request and <span class='token pointer' id='tok-106-27' style='color:red'>SNI</span>whereas <span class='token pointer' id='tok-106-28' style='color:red'>HTTP</span><span class='token pointer' id='tok-106-29' style='color:red'>host</span>header which is hidden from censors from HTTPS encryption will carry another hostname. The outside addresses will typically be those of a <span class='token pointer' id='tok-106-30' style='color:red'>CDN</span>that would have a large number of domains behind it (such as s3.amazonaws.com), and the host address would be a small <span class='token pointer' id='tok-106-31' style='color:red'>"reflector"</span>hosted on that CDN. </p><p id=p208>The reflector would be a small <span class='token pointer' id='tok-106-32' style='color:red'>application</span>that <span class='token pointer' id='tok-106-33' style='color:red'>forwards</span><span class='token pointer' id='tok-106-34' style='color:red'>traffic</span>in the HTTP request to wherever it <span class='token pointer' id='tok-106-35' style='color:red'>needs</span>to go and forwards the responses to the <span class='token pointer' id='tok-106-36' style='color:red'>client</span>through the HTTPS <span class='token pointer' id='tok-106-37' style='color:red'>tunnel.</span>Thus the initial DNS request and <span class='token pointer' id='tok-106-38' style='color:red'>Client</span><span class='token pointer' id='tok-106-39' style='color:red'>Hello</span>are sent in the clear and are visible in <span class='token pointer' id='tok-106-40' style='color:red'>packets,</span>but the inner HTTP traffic is sent through the <span class='token pointer' id='tok-106-41' style='color:red'>encrypted</span>tunnel. </p><p id=p268>What is <span class='token pointer' id='tok-106-42' style='color:red'>SNI?SNI</span>stands for <span class='token pointer' id='tok-106-43' style='color:red'>Server</span><span class='token pointer' id='tok-106-44' style='color:red'>name Indication</span>is an <span class='token pointer' id='tok-106-45' style='color:red'>extension</span>of <span class='token pointer' id='tok-106-46' style='color:red'>TLS</span><span class='token pointer' id='tok-106-47' style='color:red'>protocol</span>which <span class='token pointer' id='tok-106-48' style='color:red'>allows</span>a <span class='token pointer' id='tok-106-49' style='color:red'>server</span>to host multiple <span class='token pointer' id='tok-106-50' style='color:red'>hostnames</span>under the same <span class='token pointer' id='tok-106-51' style='color:red'>IP.</span> With this extension, <span class='token pointer' id='tok-106-52' style='color:red'>clients</span>can specify the domain they want to connect with in the initial TLS request which allows the server to select the appropriate <span class='token pointer' id='tok-106-53' style='color:red'>certificate</span>to negotiate with the client. </p><p id=p327>For example, <span class='token pointer' id='tok-106-54' style='color:red'>query</span><span class='token pointer' id='tok-106-55' style='color:red'>if we</span>using <span class='token pointer' id='tok-106-56' style='color:red'>OpenSSL</span>clients, we see that the returning certificate is not for the issued request. </p><p id=p348>Looking at the x509 certificate reveals more information about the <span class='token pointer' id='tok-106-57' style='color:red'>frontal</span>server and other <span class='token pointer' id='tok-106-58' style='color:red'>sites</span>under the same frontal. </p><p id=p367>As you can see in the above screenshot that, same frontal also accepts connections for <span class='token pointer' id='tok-106-59' style='color:red'>*.appspot.com</span>which is the domain issued for <span class='token pointer' id='tok-106-60' style='color:red'>apps</span>hosted on Google App Engine. </p><p id=p395>As you <span class='token pointer' id='tok-106-61' style='color:red'>might</span>have guessed that if *.appspot.com is blocked by censorship and if the frontal is not, then the request will succeed, and to the <span class='token pointer' id='tok-106-62' style='color:red'>monitoring</span>team, only a request for frontal will be seen. To see the actual destination, TLS should be broken to see what is inside HTTP header. </p><p id=p447>Ethical <span class='token pointer' id='tok-106-63' style='color:red'>Hacking</span>Training – Resources (InfoSec) </p><p id=p453>Meek – <span class='token pointer' id='tok-106-64' style='color:red'>Tor</span><span class='token pointer' id='tok-106-65' style='color:red'>Extension</span>As we know <span class='token pointer' id='tok-106-66' style='color:red'>TOR</span>is a <span class='token pointer' id='tok-106-67' style='color:red'>network</span>of <span class='token pointer' id='tok-106-68' style='color:red'>proxy</span><span class='token pointer' id='tok-106-69' style='color:red'>nodes,</span>that attempts to provide <span class='token pointer' id='tok-106-70' style='color:red'>anonymity</span>to users <span class='token pointer' id='tok-106-71' style='color:red'>accessing</span>the <span class='token pointer' id='tok-106-72' style='color:red'>internet.</span>However, analysts can find TOR communication by identifying communication with TOR <span class='token pointer' id='tok-106-73' style='color:red'>infrastructure.</span>Meek Extension is a <span class='token pointer' id='tok-106-74' style='color:red'>plugin</span>for TOR browser, and it acts like a client whereas the <span class='token pointer' id='tok-106-75' style='color:red'>meek</span><span class='token pointer' id='tok-106-76' style='color:red'>endpoint</span>in <span class='token pointer' id='tok-106-77' style='color:red'>CDNs</span>like Azure and Amazon will act as a meek server. Below are the underlying steps in meek <span class='token pointer' id='tok-106-78' style='color:red'>infrastructure/communication.</span></p><p id=p527>Tor is <span class='token pointer' id='tok-106-79' style='color:red'>configured</span>on the client with meek <span class='token pointer' id='tok-106-80' style='color:red'>plugin.The</span>client sends an HTTP request to the Tor <span class='token pointer' id='tok-106-81' style='color:red'>bridge</span><span class='token pointer' id='tok-106-82' style='color:red'>via</span><span class='token pointer' id='tok-106-83' style='color:red'>a CDN.</span>protects the bridge domain name from the censor by fronting it with an allowed name.Front <span class='token pointer' id='tok-106-84' style='color:red'>end</span>server (from CDN) decrypts the request and sends the request to the destination mentioned in the <span class='token pointer' id='tok-106-85' style='color:red'>HOST</span>header.Bridge sends the data back to the client in the HTTP <span class='token pointer' id='tok-106-86' style='color:red'>responseDomain</span>Fronting and meek works when CDN blocks some of the domains but not all of them. <span class='token pointer' id='tok-106-87' style='color:red'>Default</span>bridge lines can be found here, and the CDN can be changed by altering the front parameter while installing meek. Below are the some of the services that can be used with TOR: </p><p id=p644>Meek-amazonMeek-azureConsidering the way in which domain fronting works, it will not be feasible to block CDNs since popular domains like Microsoft Azure, Amazon AWS use it and blocking those domains will lead to monetary losses and possible business disruption due to the resources hosted by such services. There were no cases reported earlier where domain fronting technique is abused, but since now we know how it works, it can be easily abused. ON the same lines there was an <span class='token pointer' id='tok-106-88' style='color:red'>APT</span>named APT29 discovered using Domain Fronting. More details can be found here. So how will monitoring team defend against domain fronting? One way is to employ proper egress filtering and <span class='token pointer' id='tok-106-89' style='color:red'>configure</span>traffic all egress traffic to pass through that proxy and performing <span class='token pointer' id='tok-106-90' style='color:red'>SSL</span>man in the middle to decrypt the traffic, examine it and re-encrypting the traffic towards the destination. ON the response, the proxy will do the reverse. While examining, analysts must make sure that all the three indicators like DNS request, SNI server name, and HTTP Host header are same. If they are not same, then what is the actual destination under HTTP header. </p><p id=p830>So in this article, we have looked into a very clever technique to bypass censorship which is gaining popularity among APT authors as well.
 </p>