<p id=p0><span id='tok'>7zip</span><span id='tok'>is</span><span id='tok'>an</span><span id='tok'>awesome</span><span id='tok'>tool</span><span id='tok'>and</span><span class='token pointer' id='tok-83-0' style='color:red'>recently</span><span id='tok'>its</span><span id='tok'>new</span><span id='tok'>version</span><span id='tok'>(15.06</span><span id='tok'>beta)</span><span id='tok'>has</span><span id='tok'>been</span><span id='tok'>released.</span><span id='tok'>While</span><span id='tok'>most</span><span id='tok'>of</span><span id='tok'>us</span><span id='tok'>typically</span><span id='tok'>use</span><span id='tok'>it</span><span id='tok'>as</span><span id='tok'>a</span><span id='tok'>handy</span><span id='tok'>(and</span><span id='tok'>free)</span><span id='tok'>replacement</span><span id='tok'>for</span><span id='tok'>both</span><span id='tok'>free</span><span id='tok'>and</span><span class='token pointer' id='tok-83-1' style='color:red'>commercial</span><span class='token pointer' id='tok-83-2' style='color:red'>zip and rar compressors</span><span id='tok'>has</span><span id='tok'>a</span><span id='tok'>lot</span><span id='tok'>more</span><span id='tok'>to</span><span id='tok'>offer</span><span id='tok'>to</span><span id='tok'>file</span><span class='token pointer' id='tok-83-3' style='color:red'>carvers and reversers.</span><span id='tok'>this</span><span id='tok'>post</span><span id='tok'>I</span><span id='tok'>will</span><span id='tok'>demo</span><span id='tok'>a</span><span id='tok'>few</span><span id='tok'>things</span><span id='tok'>you</span><span id='tok'>can</span><span id='tok'>do</span><span id='tok'>with</span><span id='tok'>7z</span><span id='tok'>that</span><span id='tok'>you</span><span id='tok'>might</span><span id='tok'>have</span><span id='tok'>never</span><span id='tok'>heard</span><span id='tok'>of.</span></p><p id=p70><span id='tok'>If</span><span id='tok'>you</span><span id='tok'>are</span><span id='tok'>curious</span><span id='tok'>about</span><span id='tok'>the</span><span id='tok'>title,</span><span id='tok'>it's</span><span id='tok'>a</span><span id='tok'>reference</span><span id='tok'>to</span><span id='tok'>an</span><span id='tok'>old</span><span id='tok'>school</span><span id='tok'>song</span><span id='tok'>by</span><span class='token pointer' id='tok-83-4' style='color:red'>OMD.</span></p><p id=p87><span class='token pointer' id='tok-83-5' style='color:red'>files7Zip</span><span class='token pointer' id='tok-83-6' style='color:red'>PE</span><span class='token pointer' id='tok-83-7' style='color:red'>PE files</span><span class='token pointer' id='tok-83-8' style='color:red'>containers</span><span id='tok'>and</span><span id='tok'>allows</span><span id='tok'>us</span><span id='tok'>to</span><span id='tok'>extract</span><span id='tok'>parts</span><span id='tok'>of</span><span id='tok'>it,</span><span id='tok'>including:</span></p><p id=p103><span id='tok'>sections.tlscertificatesappended</span><span id='tok'>datathat</span><span id='tok'>is,</span><span id='tok'>if</span><span id='tok'>you</span><span id='tok'>want</span><span id='tok'>to</span><span id='tok'>extract</span><span id='tok'>a</span><span id='tok'>certificate</span><span id='tok'>(signature)</span><span id='tok'>from</span><span id='tok'>the</span><span id='tok'>PE</span><span id='tok'>file</span><span id='tok'>you</span><span id='tok'>just</span><span id='tok'>need</span><span id='tok'>to</span><span id='tok'>run:</span></p><p id=p123><span class='token pointer' id='tok-83-9' style='color:red'>7z x <filename> CERTIFICATEWhen</span><span id='tok'>extract</span><span id='tok'>certificate</span><span id='tok'>this</span><span id='tok'>way,</span><span id='tok'>you</span><span id='tok'>still</span><span id='tok'>need</span><span id='tok'>to</span><span id='tok'>strip</span><span id='tok'>first</span><span id='tok'>8</span><span id='tok'>bytes</span><span id='tok'>before</span><span id='tok'>it</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>parsed</span><span id='tok'>to</span><span id='tok'>produce</span><span id='tok'>meaningful</span><span class='token pointer' id='tok-83-10' style='color:red'>ASN output, but</span><span id='tok'>still</span><span id='tok'>very</span><span id='tok'>handy</span><span id='tok'>f.ex.</span><span id='tok'>for</span><span id='tok'>extracting</span><span id='tok'>strings</span><span id='tok'>from</span><span id='tok'>it.</span></p><p id=p161><span id='tok'>If</span><span id='tok'>you</span><span id='tok'>want</span><span id='tok'>to</span><span id='tok'>extract</span><span id='tok'>appended</span><span id='tok'>data,</span><span id='tok'>you</span><span id='tok'>need</span><span id='tok'>to</span><span id='tok'>type:</span></p><p id=p172><span id='tok'>7z</span><span id='tok'>x</span><span id='tok'><filename>Â </span><span id='tok'>[0]</span><span id='tok'>Another</span><span id='tok'>handy</span><span id='tok'>option</span><span id='tok'>is</span><span id='tok'>'l'</span><span id='tok'>which</span><span id='tok'>is</span><span id='tok'>listing</span><span id='tok'>objects</span><span id='tok'>that</span><span id='tok'>7z</span><span id='tok'>finds</span><span id='tok'>inside</span><span id='tok'>a</span><span id='tok'>given</span><span id='tok'>container.</span></p><p id=p192><span id='tok'>When</span><span id='tok'>used</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>PE</span><span id='tok'>file,</span><span id='tok'>it</span><span id='tok'>gives</span><span id='tok'>not</span><span id='tok'>only</span><span id='tok'>a</span><span id='tok'>list</span><span id='tok'>of</span><span id='tok'>whats</span><span id='tok'>inside</span><span id='tok'>(sections,</span><span id='tok'>etc.),</span><span id='tok'>but</span><span id='tok'>also</span><span id='tok'>produces</span><span id='tok'>some</span><span id='tok'>info</span><span id='tok'>about</span><span id='tok'>PE</span><span id='tok'>file</span><span id='tok'>characteristics</span><span id='tok'>f.ex.:</span></p><p id=p219><span id='tok'>Is</span><span id='tok'>it</span><span id='tok'>a</span><span class='token pointer' id='tok-83-11' style='color:red'>32- or 64- bit executableIs</span><span id='tok'>CLI</span><span id='tok'>or</span><span class='token pointer' id='tok-83-12' style='color:red'>alignmentsCode,</span><span class='token pointer' id='tok-83-13' style='color:red'>GUI executableSection and File</span><span id='tok'>sizeLinker</span><span id='tok'>versionOS</span><span id='tok'>version</span><span id='tok'>required</span><span id='tok'>to</span><span id='tok'>run</span><span id='tok'>the</span><span id='tok'>programVersion</span><span id='tok'>infoetc.This</span><span id='tok'>may</span><span id='tok'>come</span><span id='tok'>handy</span><span id='tok'>if</span><span id='tok'>you</span><span id='tok'>don't</span><span id='tok'>have</span><span id='tok'>access</span><span id='tok'>to</span><span id='tok'>some</span><span id='tok'>tools</span><span id='tok'>and</span><span id='tok'>7z</span><span id='tok'>is</span><span id='tok'>available</span><span id='tok'>(typical</span><span id='tok'>IR</span><span id='tok'>function</span><span id='tok'>in</span><span id='tok'>large</span><span id='tok'>companies</span><span id='tok'>:).</span></p><p id=p267><span id='tok'>The</span><span id='tok'>below</span><span id='tok'>is</span><span id='tok'>what</span><span id='tok'>it</span><span id='tok'>shows</span><span id='tok'>for</span><span id='tok'>notepad.exe</span><span id='tok'>(from</span><span id='tok'>Windows</span><span id='tok'>7):</span></p><p id=p278><span id='tok'>There</span><span id='tok'>is</span><span id='tok'>also</span><span id='tok'>an</span><span id='tok'>option</span><span id='tok'>'-slt'</span><span id='tok'>that</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>added</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>'l'</span><span id='tok'>command</span><span id='tok'>which</span><span id='tok'>will</span><span id='tok'>give</span><span id='tok'>more</span><span id='tok'>information</span><span id='tok'>about</span><span id='tok'>each</span><span id='tok'>object</span><span id='tok'>listed</span><span id='tok'>with</span><span id='tok'>'l'.</span></p><p id=p303><span class='token pointer' id='tok-83-14' style='color:red'>Nullsoft</span><span id='tok'>InstallersOne</span><span id='tok'>of</span><span id='tok'>the</span><span id='tok'>most</span><span id='tok'>interesting</span><span id='tok'>functions</span><span id='tok'>of</span><span id='tok'>7z</span><span id='tok'>is</span><span id='tok'>ability</span><span id='tok'>to</span><span id='tok'>unpack</span><span id='tok'>Nullsoft</span><span id='tok'>installers.</span><span id='tok'>This</span><span id='tok'>functionality</span><span id='tok'>was</span><span id='tok'>present</span><span id='tok'>in</span><span id='tok'>older</span><span id='tok'>versions</span><span id='tok'>of</span><span id='tok'>7zip,</span><span id='tok'>then</span><span id='tok'>if</span><span class='token pointer' id='tok-83-15' style='color:red'>memory</span><span id='tok'>serves</span><span id='tok'>me</span><span id='tok'>right</span><span id='tok'>was</span><span id='tok'>removed</span><span id='tok'>for</span><span id='tok'>quite</span><span id='tok'>some</span><span id='tok'>time.</span><span id='tok'>Now</span><span id='tok'>it</span><span id='tok'>seems</span><span id='tok'>to</span><span id='tok'>be</span><span id='tok'>back</span><span id='tok'>(although</span><span id='tok'>extraction</span><span id='tok'>of</span><span id='tok'>the</span><span id='tok'>script</span><span id='tok'>doesn't</span><span id='tok'>seem</span><span id='tok'>to</span><span id='tok'>be</span><span id='tok'>possible</span><span id='tok'>as</span><span id='tok'>it</span><span id='tok'>was</span><span id='tok'>in</span><span id='tok'>older</span><span id='tok'>versions).</span></p><p id=p361><span id='tok'>Running:</span></p><p id=p362><span class='token pointer' id='tok-83-16' style='color:red'>7z l Wireshark-win32-1.12.7.exe(on</span><span id='tok'>version</span><span id='tok'>of</span><span id='tok'>32-bit</span><span id='tok'>Nullsoft</span><span id='tok'>installer</span><span id='tok'>for</span><span id='tok'>Wireshark)</span></p><p id=p373><span id='tok'>can</span><span id='tok'>give</span><span id='tok'>us</span><span id='tok'>a</span><span id='tok'>nice</span><span id='tok'>list</span><span id='tok'>of</span><span id='tok'>files</span><span id='tok'>inside</span><span id='tok'>the</span><span id='tok'>installer.</span></p><p id=p384><span id='tok'>Running</span></p><p id=p385><span id='tok'>7z</span><span id='tok'>x</span><span class='token pointer' id='tok-83-17' style='color:red'>Wireshark-win32-1.12.7.exeextracts</span><span id='tok'>all</span><span id='tok'>the</span><span id='tok'>files,</span><span id='tok'>including</span><span id='tok'>Nullsoft</span><span id='tok'>plug-ins.</span></p><p id=p394><span id='tok'>This</span><span id='tok'>is</span><span id='tok'>actually</span><span id='tok'>very</span><span id='tok'>useful.</span><span id='tok'>Let's</span><span id='tok'>remember</span><span id='tok'>that</span><span id='tok'>some</span><span id='tok'>installers</span><span id='tok'>for</span><span id='tok'>malware</span><span id='tok'>include</span><span id='tok'>not</span><span id='tok'>only</span><span id='tok'>the</span><span id='tok'>payload,</span><span id='tok'>but</span><span id='tok'>also</span><span class='token pointer' id='tok-83-18' style='color:red'>malicious plug-ins.</span><span id='tok'>can't</span><span id='tok'>be</span><span id='tok'>found</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>file</span><span id='tok'>system</span><span id='tok'>after</span><span id='tok'>the</span><span id='tok'>installation</span><span id='tok'>as</span><span id='tok'>they</span><span id='tok'>are</span><span id='tok'>extracted</span><span id='tok'>to</span><span id='tok'>TEMP</span><span id='tok'>folder,</span><span id='tok'>loaded</span><span id='tok'>and</span><span id='tok'>immediately</span><span id='tok'>deleted</span><span id='tok'>after</span><span id='tok'>they</span><span id='tok'>are</span><span id='tok'>no</span><span id='tok'>longer</span><span id='tok'>needed.</span><span id='tok'>If</span><span id='tok'>you</span><span id='tok'>do</span><span id='tok'>manual</span><span id='tok'>analysis</span><span id='tok'>you</span><span id='tok'>need</span><span id='tok'>to</span><span id='tok'>'catch'</span><span id='tok'>them</span><span id='tok'>before</span><span id='tok'>they</span><span id='tok'>are</span><span id='tok'>deleted;</span><span id='tok'>with</span><span id='tok'>7z</span><span id='tok'>you</span><span id='tok'>can</span><span id='tok'>extract</span><span id='tok'>them</span><span id='tok'>directly</span><span id='tok'>from</span><span id='tok'>the</span><span id='tok'>installer</span><span id='tok'>and</span><span id='tok'>can</span><span id='tok'>do</span><span id='tok'>analysis.</span></p><p id=p471><span id='tok'>Calculating</span><span id='tok'>hashesAnother</span><span id='tok'>handy</span><span id='tok'>feature</span><span id='tok'>of</span><span id='tok'>7z</span><span id='tok'>is</span><span id='tok'>ability</span><span id='tok'>to</span><span id='tok'>calculate</span><span id='tok'>hashes</span><span id='tok'>of</span><span id='tok'>files.</span><span id='tok'>Again,</span><span id='tok'>may</span><span id='tok'>come</span><span id='tok'>useful</span><span id='tok'>in</span><span id='tok'>an</span><span id='tok'>environment</span><span id='tok'>where</span><span id='tok'>you</span><span id='tok'>can't</span><span id='tok'>use</span><span id='tok'>other</span><span id='tok'>tools.</span></p><p id=p497><span id='tok'>To</span><span id='tok'>calculate</span><span id='tok'>hashes</span><span id='tok'>of</span><span id='tok'>the</span><span id='tok'>file</span><span id='tok'>you</span><span id='tok'>need</span><span id='tok'>to</span><span id='tok'>run</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>command:</span></p><p id=p510><span id='tok'>7z</span><span id='tok'>h</span><span id='tok'>-scrc*</span><span id='tok'><filename></span></p><p id=p514><span id='tok'>The</span><span id='tok'>switch's</span><span id='tok'>name</span><span id='tok'>is</span><span id='tok'>a</span><span id='tok'>bit</span><span id='tok'>misleading</span><span id='tok'>(suggesting</span><span id='tok'>CRC),</span><span id='tok'>but</span><span id='tok'>it</span><span id='tok'>basically</span><span id='tok'>tells</span><span id='tok'>7z</span><span id='tok'>to</span><span id='tok'>calculate</span><span id='tok'>a</span><span class='token pointer' id='tok-83-19' style='color:red'>hash, or a checksum.</span><span id='tok'>default</span><span id='tok'>is</span><span id='tok'>CRC32,</span><span id='tok'>but</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>are</span><span id='tok'>available:</span></p><p id=p544><span id='tok'>CRC32SHA1SHA256CRC64BLAKE2spIf</span><span id='tok'>you</span><span id='tok'>use</span><span id='tok'>an</span><span id='tok'>asterisk,</span><span id='tok'>all</span><span id='tok'>of</span><span id='tok'>them</span><span id='tok'>will</span><span id='tok'>be</span><span id='tok'>included:</span></p><p id=p555><span id='tok'>Why</span><span id='tok'>Md5</span><span id='tok'>is</span><span id='tok'>not</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>list</span><span id='tok'>is</span><span id='tok'>a</span><span id='tok'>mystery</span><span id='tok'>to</span><span id='tok'>me.</span></p><p id=p567><span id='tok'>The</span><span id='tok'>list</span><span id='tok'>of</span><span id='tok'>all</span><span id='tok'>hash</span><span id='tok'>types,</span><span id='tok'>as</span><span id='tok'>well</span><span id='tok'>as</span><span id='tok'>file</span><span id='tok'>formats</span><span id='tok'>and</span><span id='tok'>codecs</span><span id='tok'>in</span><span id='tok'>your</span><span id='tok'>version</span><span id='tok'>of</span><span id='tok'>7z</span><span id='tok'>can</span><span id='tok'>be</span><span id='tok'>listed</span><span id='tok'>using</span><span id='tok'>the</span><span id='tok'>'7z</span><span id='tok'>i'</span><span id='tok'>command.</span></p><p id=p593><span id='tok'>Access</span><span id='tok'>to</span><span id='tok'>raw</span><span id='tok'>physical</span><span id='tok'>drive</span><span id='tok'>and</span><span id='tok'>volumesI</span><span id='tok'>left</span><span id='tok'>this</span><span id='tok'>one</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>end,</span><span id='tok'>as</span><span id='tok'>it</span><span id='tok'>is</span><span id='tok'>pretty</span><span id='tok'>cool,</span><span id='tok'>but</span><span id='tok'>has</span><span id='tok'>one</span><span id='tok'>caveat.</span></p><p id=p615><span id='tok'>According</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>documentation</span><span class='token pointer' id='tok-83-20' style='color:red'>7Zip Manager</span><span id='tok'>to</span><span id='tok'>view</span><span id='tok'>(and</span><span id='tok'>potentially</span><span id='tok'>even</span><span id='tok'>parse)</span><span id='tok'>raw</span><span id='tok'>volumes.</span></p><p id=p630><span id='tok'>To</span><span id='tok'>access</span><span id='tok'>this</span><span id='tok'>functionality</span><span id='tok'>one</span><span id='tok'>needs</span><span id='tok'>to</span><span id='tok'>open</span><span id='tok'>7Zip</span><span id='tok'>Manager</span><span id='tok'>as</span><span id='tok'>an</span><span id='tok'>admin</span><span id='tok'>and</span><span id='tok'>access</span><span id='tok'>the</span><span id='tok'>\\.Â </span><span id='tok'>folder.</span></p><p id=p648><span id='tok'>where</span><span id='tok'>you</span><span id='tok'>should</span><span id='tok'>see</span><span id='tok'>a</span><span id='tok'>list</span><span id='tok'>of</span><span id='tok'>drives</span><span id='tok'>+</span><span id='tok'>physical</span><span id='tok'>devices:</span></p><p id=p659><span id='tok'>Unfortunately,</span><span id='tok'>it</span><span id='tok'>doesn't</span><span id='tok'>work</span><span id='tok'>for</span><span id='tok'>C:</span><span id='tok'>and</span><span id='tok'>you</span><span id='tok'>will</span><span id='tok'>always</span><span id='tok'>receive</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>message:</span></p><p id=p673><span id='tok'>If</span><span id='tok'>this</span><span id='tok'>gets</span><span id='tok'>fixed</span><span id='tok'>at</span><span id='tok'>source</span><span id='tok'>it</span><span id='tok'>may</span><span id='tok'>become</span><span id='tok'>a</span><span id='tok'>handy</span><span id='tok'>raw</span><span id='tok'>file</span><span id='tok'>extractor.</span></p><p id=p687><span id='tok'>Still,</span><span id='tok'>it's</span><span id='tok'>pretty</span><span id='tok'>cool.</span></p><p id=p691><span id='tok'>Why?</span></p><p id=p692><span id='tok'>Couple</span><span id='tok'>of</span><span id='tok'>reasons.</span></p><p id=p695><span id='tok'>Reason</span><span id='tok'>#1Because</span><span id='tok'>it</span><span id='tok'>works</span><span id='tok'>for</span><span id='tok'>other</span><span id='tok'>drives</span><span id='tok'>which</span><span id='tok'>are</span><span id='tok'>not</span><span id='tok'>in</span><span id='tok'>use.Reason</span><span id='tok'>#2Because</span><span id='tok'>command</span><span id='tok'>line</span><span id='tok'>tool</span><span id='tok'>(7z)</span><span id='tok'>also</span><span id='tok'>supports</span><span id='tok'>it.Reason</span><span id='tok'>#3Because</span><span id='tok'>I</span><span id='tok'>will</span><span id='tok'>show</span><span id='tok'>you</span><span id='tok'>how</span><span id='tok'>to</span><span id='tok'>make</span><span id='tok'>it</span><span id='tok'>work</span><span id='tok'>with</span><span id='tok'>C:</span><span id='tok'>ðŸ™‚So,</span><span id='tok'>what</span><span id='tok'>can</span><span id='tok'>we</span><span id='tok'>do</span><span id='tok'>with</span><span id='tok'>it?</span></p><p id=p734><span id='tok'>Let's</span><span id='tok'>start</span><span id='tok'>with</span><span id='tok'>a</span><span id='tok'>demo</span><span id='tok'>for</span><span id='tok'>a</span><span id='tok'>drive</span><span id='tok'>NOT</span><span id='tok'>in</span><span id='tok'>use.</span></p><p id=p745><span id='tok'>We</span><span id='tok'>can</span><span id='tok'>f.ex.</span><span id='tok'>list</span><span id='tok'>the</span><span id='tok'>files</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>drive</span><span id='tok'>by</span><span id='tok'>using</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>command</span></p><p id=p759><span id='tok'>7z</span><span id='tok'>l</span><span id='tok'>\\.\k:This</span><span id='tok'>will</span><span id='tok'>give</span><span id='tok'>us</span><span id='tok'>a</span><span id='tok'>list</span><span id='tok'>of</span><span id='tok'>all</span><span id='tok'>files</span><span id='tok'>on</span><span id='tok'>that</span><span id='tok'>drive</span><span id='tok'>extracted</span><span id='tok'>directly</span><span id='tok'>from</span><span class='token pointer' id='tok-83-21' style='color:red'>$MFT:</span></p><p id=p777><span id='tok'>Using</span><span id='tok'>the</span><span id='tok'>file</span><span id='tok'>naming</span><span id='tok'>convention</span><span id='tok'>shown</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>screenshot,</span><span id='tok'>we</span><span id='tok'>can</span><span id='tok'>extract</span><span id='tok'>the</span><span id='tok'>$MFT</span><span id='tok'>file</span><span id='tok'>using</span><span id='tok'>the</span><span id='tok'>following</span><span id='tok'>command:</span></p><p id=p796><span id='tok'>7z</span><span id='tok'>x</span><span id='tok'>\\.\k:</span><span id='tok'>[SYSTEM]\$MFTPretty</span><span id='tok'>useful,</span><span id='tok'>isn't?</span></p><p id=p802><span id='tok'>Now,</span><span id='tok'>how</span><span id='tok'>to</span><span id='tok'>make</span><span id='tok'>it</span><span id='tok'>work</span><span id='tok'>for</span><span id='tok'>C:?</span></p><p id=p810><span id='tok'>Since</span><span id='tok'>it</span><span id='tok'>works</span><span id='tok'>for</span><span id='tok'>other</span><span id='tok'>volumes</span><span id='tok'>it</span><span id='tok'>should</span><span id='tok'>for</span><span id='tok'>C:</span><span id='tok'>a</span><span id='tok'>well</span><span id='tok'>(principles</span><span id='tok'>for</span><span id='tok'>all</span><span class='token pointer' id='tok-83-22' style='color:red'>live $MFT parsers</span><span id='tok'>similar).</span><span id='tok'>After</span><span id='tok'>quick</span><span id='tok'>analysis</span><span id='tok'>I</span><span id='tok'>discovered</span><span id='tok'>that</span><span id='tok'>the</span><span id='tok'>author(s)</span><span id='tok'>of</span><span id='tok'>7zip</span><span id='tok'>made</span><span id='tok'>a</span><span id='tok'>mistake</span><span id='tok'>in</span><span id='tok'>the</span><span id='tok'>way</span><span id='tok'>they</span><span id='tok'>open</span><span id='tok'>the</span><span id='tok'>volume.</span><span id='tok'>They</span><span id='tok'>call</span><span class='token pointer' id='tok-83-23' style='color:red'>CreateFile</span><span id='tok'>with</span><span id='tok'>the</span><span id='tok'>parameters</span><span id='tok'>that</span><span id='tok'>prevent</span><span id='tok'>other</span><span id='tok'>applications</span><span id='tok'>from</span><span id='tok'>accessing</span><span id='tok'>the</span><span id='tok'>volume</span><span id='tok'>for</span><span id='tok'>writing</span><span id='tok'>and</span><span id='tok'>this</span><span id='tok'>obviously</span><span id='tok'>causes</span><span id='tok'>a</span><span id='tok'>problem</span><span id='tok'>for</span><span id='tok'>C:</span><span id='tok'>drive</span><span id='tok'>which</span><span id='tok'>is</span><span id='tok'>constantly</span><span id='tok'>in</span><span id='tok'>use.</span></p><p id=p880><span id='tok'>The</span><span id='tok'>parameter</span><span id='tok'>in</span><span id='tok'>question</span><span id='tok'>is</span><span class='token pointer' id='tok-83-24' style='color:red'>dwShareMode of</span><span id='tok'>CreateFile</span><span id='tok'>function.</span><span id='tok'>In</span><span id='tok'>order</span><span id='tok'>to</span><span id='tok'>open</span><span id='tok'>a</span><span id='tok'>volume</span><span id='tok'>one</span><span id='tok'>has</span><span id='tok'>to</span><span id='tok'>specify</span><span id='tok'>both</span><span id='tok'>FILE_SHARE_READ</span><span id='tok'>and</span><span id='tok'>FILE_SHARE_WRITE,</span><span id='tok'>basically</span><span id='tok'>allowing</span><span id='tok'>other</span><span id='tok'>processes/system</span><span id='tok'>components</span><span id='tok'>to</span><span id='tok'>access</span><span id='tok'>the</span><span id='tok'>device.</span><span id='tok'>Authors(s)</span><span id='tok'>of</span><span id='tok'>7z</span><span id='tok'>only</span><span id='tok'>use</span><span id='tok'>FILE_SHARE_READ.</span></p><p id=p919><span id='tok'>Knowing</span><span id='tok'>what's</span><span id='tok'>wrong</span><span id='tok'>we</span><span id='tok'>can</span><span id='tok'>fix</span><span id='tok'>it.</span><span id='tok'>You</span><span id='tok'>can</span><span id='tok'>either</span><span id='tok'>recompile</span><span id='tok'>7z,</span><span id='tok'>or</span><span id='tok'>just</span><span id='tok'>do</span><span id='tok'>a</span><span id='tok'>quick</span></p><p id=p938><span id='tok'>I</span><span id='tok'>will</span><span id='tok'>show</span><span id='tok'>you</span><span id='tok'>the</span><span id='tok'>binary</span><span id='tok'>patch</span><span id='tok'>as</span><span id='tok'>it's</span><span id='tok'>really</span><span id='tok'>quick.</span></p><p id=p949><span id='tok'>FILE_SHARE_READ</span><span id='tok'>is</span><span id='tok'>equal</span><span id='tok'>to</span><span id='tok'>1</span><span id='tok'>and</span><span id='tok'>FILE_SHARE_WRITE</span><span id='tok'>is</span><span id='tok'>equal</span><span id='tok'>to</span><span id='tok'>2,</span><span id='tok'>so</span><span id='tok'>the</span><span id='tok'>proper</span><span id='tok'>argument</span><span id='tok'>for</span><span id='tok'>CreateFile</span><span id='tok'>needs</span><span id='tok'>to</span><span id='tok'>be</span><span id='tok'>a</span><span id='tok'>sum</span><span id='tok'>of</span><span id='tok'>them:Â FILE_SHARE_READ</span><span id='tok'>+</span><span id='tok'>FILE_SHARE_WRITE</span><span id='tok'>=</span><span id='tok'>3.</span></p><p id=p977><span id='tok'>To</span><span id='tok'>locate</span><span id='tok'>where</span><span id='tok'>the</span><span id='tok'>change</span><span id='tok'>the</span><span id='tok'>binary,</span><span id='tok'>the</span><span id='tok'>easiest</span><span id='tok'>is</span><span id='tok'>to</span><span id='tok'>make</span><span id='tok'>a</span><span class='token pointer' id='tok-83-25' style='color:red'>breakpoint</span><span id='tok'>on</span><span id='tok'>CreateFileW</span><span id='tok'>in</span><span id='tok'>ollydbg,</span><span id='tok'>then</span><span id='tok'>wait</span><span id='tok'>for</span><span id='tok'>it</span><span id='tok'>to</span><span id='tok'>hit</span><span id='tok'>on</span><span id='tok'>\\.\c:,</span><span id='tok'>and</span><span id='tok'>then</span><span id='tok'>step</span><span id='tok'>down</span><span id='tok'>to</span><span id='tok'>the</span><span id='tok'>procedure</span><span id='tok'>which</span><span id='tok'>actually</span><span id='tok'>sets</span><span id='tok'>the</span><span id='tok'>parameters</span><span id='tok'>for</span><span id='tok'>the</span><span id='tok'>function.</span></p><p id=p1018><span id='tok'>Then</span><span id='tok'>you</span><span id='tok'>can</span><span id='tok'>also</span><span id='tok'>go</span><span id='tok'>back</span><span id='tok'>to</span><span id='tok'>IDA</span><span id='tok'>Pro</span><span id='tok'>to</span><span id='tok'>see</span><span id='tok'>the</span><span id='tok'>actual</span><span id='tok'>code</span><span id='tok'>of</span><span id='tok'>the</span><span id='tok'>function</span><span id='tok'>which</span><span id='tok'>is</span><span id='tok'>shown</span><span id='tok'>below:</span></p><p id=p1039><span id='tok'>Patching</span></p><p id=p1040><span id='tok'>orÂ al,</span><span id='tok'>1</span><span id='tok'>;</span><span id='tok'></span><span id='tok'>FILE_SHARE_READlocated</span><span id='tok'>at</span><span id='tok'>00406839</span><span id='tok'>to</span></p><p id=p1048><span id='tok'>orÂ al,</span><span id='tok'>3</span><span id='tok'>;</span><span id='tok'></span><span id='tok'>FILE_SHARE_READ</span><span id='tok'>+</span><span id='tok'>FILE_SHARE_WRITEallows</span><span id='tok'>us</span><span id='tok'>to</span><span id='tok'>make</span><span id='tok'>it</span><span id='tok'>work</span><span id='tok'>for</span><span id='tok'>drive</span><span id='tok'>C:</span><span id='tok'>as</span><span id='tok'>seen</span><span id='tok'>on</span><span id='tok'>the</span><span id='tok'>below</span><span id='tok'>screenshot</span><span id='tok'>(taken</span><span id='tok'>from</span><span id='tok'>Windows</span><span id='tok'>XP):</span></p><p id=p1073><span id='tok'>You</span><span id='tok'>can</span><span id='tok'>follow</span><span id='tok'>the</span><span id='tok'>same</span><span id='tok'>process</span><span id='tok'>for</span><span id='tok'>64-bit</span><span id='tok'>binary.
</span></p>